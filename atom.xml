<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Fox Home</title>
  
  <subtitle>清疚</subtitle>
  <link href="https://foolishfox.cn/atom.xml" rel="self"/>
  
  <link href="https://foolishfox.cn/"/>
  <updated>2021-05-08T06:23:47.248Z</updated>
  <id>https://foolishfox.cn/</id>
  
  <author>
    <name>liuyihui</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Python模拟锁相放大器的工作过程</title>
    <link href="https://foolishfox.cn/posts/202105-amplifier.html"/>
    <id>https://foolishfox.cn/posts/202105-amplifier.html</id>
    <published>2021-05-07T14:02:44.000Z</published>
    <updated>2021-05-08T06:23:47.248Z</updated>
    
    <content type="html"><![CDATA[<style>  .Note {    width: 100%;    height: 7200px;    border: medium none;  }</style><!-- <iframe src="https://lastknightcoder.gitee.io/jupyter-for-iframe/numpy%E5%85%A5%E9%97%A8.html" class="Note"></iframe> -->        <h1 id="准备"   >          <a href="#准备" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#准备"></a> 准备</h1>      <p>  本篇笔记将使用python演示锁相放大器的基本原理。<br />  首先引入需要用到的package，使用<code>%matplotlib widget</code>可以产生交互式的图片。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy.fftpack <span class="keyword">import</span> fft</span><br><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> signal <span class="keyword">as</span> sg</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">%matplotlib widget</span><br></pre></td></tr></table></div></figure><p>  在本文中将会产生许多的图片，为了方便绘图编写一个展示信号的绘图函数。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw</span>(<span class="params">x, y, title=<span class="string">&#x27;&#x27;</span>, xlable=<span class="string">&#x27;time(s)&#x27;</span>, ylable=<span class="string">&#x27;amplitude&#x27;</span>, L=-<span class="number">3.8</span>, H=<span class="number">3.8</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    draw</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        x : numpy array</span></span><br><span class="line"><span class="string">            abscissa</span></span><br><span class="line"><span class="string">        y : numpy array</span></span><br><span class="line"><span class="string">            ordinate</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># canvas settings</span></span><br><span class="line">    plt.close()</span><br><span class="line">    <span class="keyword">if</span> L!=H:</span><br><span class="line">        plt.ylim(L, H)</span><br><span class="line">    plt.title(title)</span><br><span class="line">    plt.xlabel(xlable)</span><br><span class="line">    plt.ylabel(ylable)</span><br><span class="line"></span><br><span class="line">    plt.plot(x, y)</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></div></figure><p>  在本实验中将采用正弦波作为输入信号。另外，参考信号、噪声信号等都需要用到正弦信号，所以第一步将编写一个产生给定幅度、频率和相位的正弦信号的函数。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g_sin</span>(<span class="params">t=<span class="number">1</span>, amp=<span class="number">1</span>, f0=<span class="number">10</span>, fs=<span class="number">500</span>, phi=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    generate sinusoid</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        t   : float</span></span><br><span class="line"><span class="string">            time length of the generated sequence</span></span><br><span class="line"><span class="string">        amp : float</span></span><br><span class="line"><span class="string">            amplitude</span></span><br><span class="line"><span class="string">        f0  : float</span></span><br><span class="line"><span class="string">            frequency of sinusoid in Hz</span></span><br><span class="line"><span class="string">        fs  : float</span></span><br><span class="line"><span class="string">            sampling rate per second</span></span><br><span class="line"><span class="string">        phi : float</span></span><br><span class="line"><span class="string">            initial phase in deg</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">        anonymous : list[numpy array, numpy array]</span></span><br><span class="line"><span class="string">            [abscissa, a sinusoid signal]</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    T = <span class="number">1</span>/fs</span><br><span class="line">    N = t/T</span><br><span class="line">    x = <span class="number">2</span>*np.pi*np.arange(N)*T</span><br><span class="line">    <span class="keyword">return</span> [np.arange(<span class="number">0</span>, t, T), amp*np.sin(f0*x+phi*np.pi/<span class="number">180</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x, y = g_sin()</span><br><span class="line">draw(x, y)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_1.png"  alt="" />      </p><p>  参考信号可以使用正弦波、方波等。在本实验中将使用方波，而方波的傅里叶级数为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>4</mn><mi>π</mi></mfrac><munderover><mo>∑</mo><mrow><mi>n</mi><mo>=</mo><mn>0</mn></mrow><mi mathvariant="normal">∞</mi></munderover><mfrac><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mn>2</mn><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><msub><mi>ω</mi><mi>r</mi></msub><mi>t</mi><mo stretchy="false">]</mo></mrow><mrow><mn>2</mn><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">f(x)=\frac{4}{\pi}\sum\limits_{n=0}^{\infty}\frac{sin[(2n+1)\omega_rt]}{2n+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.9185100000000004em;vertical-align:-1.267113em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">π</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∞</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mopen">[</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">t</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>  所以我们可以利用上面的正弦波函数，产生一个近似的方波，方波的阶数（即K）越大近似效果越好，K=50时就有很好的效果。  (PS：此处方波均指占空比为50%，正负对称的方波)</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g_square_wave</span>(<span class="params">t=<span class="number">1</span>, amp=<span class="number">1</span>, f0=<span class="number">10</span>, fs=<span class="number">500</span>, K=<span class="number">50</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    generate square wave</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        t   : float</span></span><br><span class="line"><span class="string">            time length of the generated sequence</span></span><br><span class="line"><span class="string">        amp : float</span></span><br><span class="line"><span class="string">            amplitude</span></span><br><span class="line"><span class="string">        f0  : float</span></span><br><span class="line"><span class="string">            frequency of sinusoid in Hz</span></span><br><span class="line"><span class="string">        fs  : float</span></span><br><span class="line"><span class="string">            sampling rate per second</span></span><br><span class="line"><span class="string">        K   : int</span></span><br><span class="line"><span class="string">            order of fourier series</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">        anonymous : list[numpy array, numpy array]</span></span><br><span class="line"><span class="string">            [abscissa, a square wave]</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    T = <span class="number">1</span>/fs</span><br><span class="line">    N = t/T</span><br><span class="line">    x = <span class="number">2</span>*np.pi*np.arange(N)*T</span><br><span class="line"></span><br><span class="line">    y = np.zeros(<span class="built_in">len</span>(x))</span><br><span class="line">    k = <span class="number">2</span>*np.arange(<span class="number">1</span>, K)-<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">        y[i] = amp*np.<span class="built_in">sum</span>(np.sin(k*f0*x[i])/k)</span><br><span class="line">    <span class="keyword">return</span> [np.arange(<span class="number">0</span>, t, T), <span class="number">4</span>*y/np.pi]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x, y = g_square_wave()</span><br><span class="line">draw(x, y)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_2.png"  alt="" />      </p><p>  使用上述两个函数，可以叠加产生带有噪声的信号。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x, y1 = g_sin(amp=<span class="number">0.2</span>, f0=<span class="number">30</span>)</span><br><span class="line">x, y2 = g_sin(amp=<span class="number">0.35</span>, f0=<span class="number">3</span>, phi=<span class="number">45</span>)</span><br><span class="line">x, y3 = g_square_wave(amp=<span class="number">0.1</span>, f0=<span class="number">10</span>)</span><br><span class="line">draw(x, y1+y2+y3)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_3.png"  alt="" />      </p><p>  这些噪声在时域中难以分辨。不过信号与噪声不同，往往具有明显的频率特征，而噪声一般是与频率无关的，或者是在特定频率范围内的，所以在频域内可以很好的分辨出输入信号的各种成分。<br />  使用快速傅里叶变换（FFT）从时域转化到频域，并且对振幅谱进行取半归一化。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">FFT</span>(<span class="params">s, fs</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    fast fourier transform</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        s  : numpy array</span></span><br><span class="line"><span class="string">            signal</span></span><br><span class="line"><span class="string">        fs : float</span></span><br><span class="line"><span class="string">            sampling rate per second</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    X  = fft(s)</span><br><span class="line">    mX = np.<span class="built_in">abs</span>(X)   <span class="comment"># magnitude</span></span><br><span class="line">    pX = np.angle(X) <span class="comment"># phase</span></span><br><span class="line"></span><br><span class="line">    draw(np.arange(<span class="built_in">int</span>(fs/<span class="number">2</span>)), mX[<span class="built_in">range</span>(<span class="built_in">int</span>(fs/<span class="number">2</span>))]/fs, </span><br><span class="line">         <span class="string">&#x27;Input signal in frequency domain&#x27;</span>, <span class="string">&#x27;frequency(Hz)&#x27;</span>, <span class="string">&#x27;amplitude&#x27;</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">FFT(y1+y2+y3, <span class="number">500</span>)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_4.png"  alt="" />      </p><p>  上面的信号添加的噪声还是正弦信号，而现实中比较常见的噪声是白噪声。下面的函数可以根据输入信号产生一个特定信噪比的白噪声。<br />  信噪比的定义是：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>N</mi><mi>R</mi><mo stretchy="false">(</mo><mi>d</mi><mi>B</mi><mo stretchy="false">)</mo><mo>=</mo><mn>10</mn><mi>l</mi><mi>g</mi><mfrac><msub><mi>P</mi><mrow><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub><msub><mi>P</mi><mrow><mi>n</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></msub></mfrac><mo>=</mo><mn>20</mn><mi>l</mi><mi>g</mi><mfrac><msub><mi>A</mi><mrow><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub><msub><mi>A</mi><mrow><mi>n</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">SNR(dB)=10lg\frac{P_{signal}}{P_{noise}}=20lg\frac{A_{signal}}{A_{noise}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.19633em;vertical-align:-0.8360000000000001em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.19633em;vertical-align:-0.8360000000000001em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>  在本实验中，功率<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span></span></span></span>可以用功<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi><mo>=</mo><mo>∫</mo><mi>P</mi><mi>d</mi><mi>t</mi><mo>=</mo><mi>C</mi><mo>∫</mo><msup><mi>A</mi><mn>2</mn></msup><mi>d</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">W=\int Pdt=C\int A^2dt</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.11112em;vertical-align:-0.30612em;"></span><span class="mop op-symbol small-op" style="margin-right:0.19445em;position:relative;top:-0.0005599999999999772em;">∫</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.120228em;vertical-align:-0.30612em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol small-op" style="margin-right:0.19445em;position:relative;top:-0.0005599999999999772em;">∫</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span></span></span></span>代替，因为信号和噪声的积分时间是相同的。而信号的波形是采样得到的，所以<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span></span></span></span>可以用<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∑</mo><msubsup><mi>x</mi><mi>i</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\sum x_i^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.072772em;vertical-align:-0.258664em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span>代替，于是有：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>N</mi><mi>R</mi><mo>=</mo><mn>10</mn><mi>l</mi><mi>g</mi><mfrac><mrow><mo>∑</mo><msubsup><mi>s</mi><mi>i</mi><mn>2</mn></msubsup></mrow><mrow><mo>∑</mo><msubsup><mi>n</mi><mi>i</mi><mn>2</mn></msubsup></mrow></mfrac><mo>⟹</mo><mo>∑</mo><msubsup><mi>n</mi><mi>i</mi><mn>2</mn></msubsup><mo>=</mo><mfrac><mrow><mo>∑</mo><msubsup><mi>s</mi><mi>i</mi><mn>2</mn></msubsup></mrow><mrow><mn>1</mn><msup><mn>0</mn><mrow><mi>S</mi><mi>N</mi><mi>R</mi><mi mathvariant="normal">/</mi><mn>10</mn></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">SNR=10lg\frac{\sum s_i^2}{\sum n_i^2} \Longrightarrow \sum n_i^2= \frac{\sum s_i^2}{10^{SNR/10}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.4539720000000003em;vertical-align:-0.9628639999999999em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959080000000001em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.27686399999999994em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9628639999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.6000100000000002em;vertical-align:-0.55001em;"></span><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.1951080000000003em;vertical-align:-0.704em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.2960000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mord mtight">/</span><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.704em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wgn</span>(<span class="params">x, snr</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    generate Gauss white noise</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        x   : numpy array</span></span><br><span class="line"><span class="string">            signal</span></span><br><span class="line"><span class="string">        snr : float</span></span><br><span class="line"><span class="string">            signal-to-noise ratio</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">        anonymous : numpy array</span></span><br><span class="line"><span class="string">            Gauss white noise</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    snr    = <span class="number">10</span>**(snr/<span class="number">10.0</span>)</span><br><span class="line">    xpower = np.<span class="built_in">sum</span>(x**<span class="number">2</span>)/<span class="built_in">len</span>(x)</span><br><span class="line">    npower = xpower / snr</span><br><span class="line">    <span class="keyword">return</span> np.random.randn(<span class="built_in">len</span>(x)) * np.sqrt(npower)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">noise = wgn(np.sin(np.arange(<span class="number">0</span>, <span class="number">1000000</span>)*<span class="number">0.1</span>), <span class="number">6</span>)</span><br><span class="line">plt.close()</span><br><span class="line">plt.subplot(<span class="number">211</span>)</span><br><span class="line">plt.hist(noise, bins=<span class="number">100</span>)</span><br><span class="line">plt.subplot(<span class="number">212</span>)</span><br><span class="line">plt.psd(noise)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_5.png"  alt="" />      </p>        <h1 id="模拟"   >          <a href="#模拟" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#模拟"></a> 模拟</h1>      <p>  下面开始正式的模拟过程：</p><ol><li>获得输入信号，输入信号由10Hz的目标信号和其他频率的正弦噪声以及白噪声组成</li></ol><p>  A. 增加正弦部分</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x, y1  = g_sin(amp=<span class="number">0.1</span>)</span><br><span class="line">x, y2  = g_sin(amp=<span class="number">0.5</span>, f0=<span class="number">50</span>)</span><br><span class="line">x, y3  = g_sin(amp=<span class="number">0.8</span>, f0=<span class="number">3</span>)</span><br><span class="line">x, y4  = g_sin(amp=<span class="number">0.3</span>, f0=<span class="number">200</span>)</span><br><span class="line">signal = y1+y2+y3+y4</span><br></pre></td></tr></table></div></figure><p>  B. 增加白噪声部分</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">noise = wgn(signal, <span class="number">10</span>)</span><br><span class="line">sn    = signal+noise</span><br><span class="line">draw(x, sn)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_6.png"  alt="" />      <br />  C. 查看输入信号的频域信息</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FFT(sn, <span class="number">500</span>)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_7.png"  alt="" />      </p><ol start="2"><li>获得参考信号，方波频率与目标信号相同，为10Hz</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x, y   = g_square_wave(K=<span class="number">100</span>)</span><br><span class="line">square = y</span><br><span class="line">draw(x, square)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_8.png"  alt="" />      </p><ol start="3"><li>前置放大×2倍</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sn = sn*<span class="number">2</span></span><br><span class="line">draw(x, sn)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_9.png"  alt="" />      </p><ol start="4"><li>输入信号进行带通滤波，除去/抑制部分噪声，增强锁相放大器的性能（动态储备和输出动态范围）</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b, a = sg.butter(<span class="number">1</span>, [<span class="number">0.02</span>, <span class="number">0.12</span>], <span class="string">&#x27;bandpass&#x27;</span>) <span class="comment"># 5Hz - 30Hz</span></span><br><span class="line">snq  = sg.filtfilt(b, a, sn)</span><br><span class="line">draw(x, snq)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_10.png"  alt="" />      </p><ol start="5"><li>调谐放大输入信号×5，增大信噪比</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b, a = sg.butter(<span class="number">1</span>, [<span class="number">0.038</span>, <span class="number">0.042</span>], <span class="string">&#x27;bandpass&#x27;</span>) <span class="comment"># 9.5Hz - 10.5Hz</span></span><br><span class="line">sns  = sg.filtfilt(b, a, snq)</span><br><span class="line">snq  = sns*<span class="number">4</span>+snq</span><br><span class="line">draw(x, snq)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_11.png"  alt="" />      </p><ol start="6"><li>PSD（相敏检波器）处理输入与参考信号（本质为乘法器）</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">snqx = snq*square</span><br><span class="line">draw(x, snqx)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_12.png"  alt="" />      </p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FFT(snqx, <span class="number">500</span>)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_13.png"  alt="" />      </p><ol start="7"><li>低通滤波，减少其他信号对直流分量的影响（等效噪声宽度很小）</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b, a = sg.butter(<span class="number">3</span>, <span class="number">0.00004</span>, <span class="string">&#x27;lowpass&#x27;</span>) <span class="comment"># 0 - 0.01Hz</span></span><br><span class="line">sns  = sg.filtfilt(b, a, snqx)</span><br><span class="line">draw(x, sns)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_14.png"  alt="" />      </p><ol start="8"><li>直流放大×5</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sns = sns*<span class="number">5</span></span><br><span class="line">draw(x, sns)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_15.png"  alt="" />      </p>]]></content>
    
    
      
      
    <summary type="html">&lt;style&gt;
  .Note {
    width: 100%;
    height: 7200px;
    border: medium none;
  }
&lt;/style&gt;
&lt;!-- &lt;iframe src=&quot;https://lastknightcoder.gitee</summary>
      
    
    
    
    <category term="学习" scheme="https://foolishfox.cn/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Python" scheme="https://foolishfox.cn/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>建国以来土地政策的变化</title>
    <link href="https://foolishfox.cn/posts/202104-land.html"/>
    <id>https://foolishfox.cn/posts/202104-land.html</id>
    <published>2021-04-14T09:38:51.000Z</published>
    <updated>2021-04-17T12:01:02.420Z</updated>
    
    <content type="html"><![CDATA[<p>  我国在相当长的时间内是一个传统的农业国，哪怕工业化之后，农民仍然占据人口的大多数，土地依旧是百姓关注的焦点。而且土地还关系的粮食生产的多少，直接影响国家的安危。</p><span id="more"></span><p>  从土地革命战争到家庭联产承包制，中国共产党的土地政策在大半个世纪的时间里不断变化着。最初苏区主张“耕地农有”，即谁耕种的土地归谁所有；抗战时期为了巩固抗日民族统一战线在未进行土改的地区推行“减租减息”政策，即“地主减租减息，农民交租交息”；建国前后的几年内，在全国范围内进行了土改，实现“耕者有其田”的目标；社会主义改造后的土地归为劳动群众集体所有，直至改革开放，推行家庭联产承包责任制。</p><p>  在这些复杂、曲折的变化背后都能看出中国共产党的宏大目标。无论是实现中国农民千年来拥有土地的梦想，是集中力量发展工业建设国家，还是发展经济提高人民生活水平，无不反映出中共高层对国家民族繁荣富强理想的构建和对中国现实不断适应和调整的过程。下面主要介绍土改后我党土地政策的变化。</p><p>一．土地集体所有</p><p>  1953年开始了农业合作化的土地制度，是社会主义三大改造的一部分。农业合作化的实质是通过互助合作的形式将生产资料私有制为基础的小私有经济改造成生产资料公有为基础的合作经济的过程。农业合作化先后经历了具有社会主义萌芽的互助组、土地入股统一经营的初级阶段和土地、耕畜、农具等折价归集体所有的高级阶段。</p><p>  1956年基本完成农业社会主义改造，1958年3月中共中央通过了《关于把小型的农业合作社适当地合并为大社的意见》，鼓励“有条件的地方，把小型的农业合作社有计划地适当地合并为大型的合作社“，这是人民公社化的前奏。中共中央通过了《关于在农村建立人民公社问题的决议》，其本质特征是规模“巨型化”和实行“政社合一”的管理体制。</p><p>  总的来说，农业的社会主义改造和人民公社化解决了农村贫富分化现象重新出现、个体农业不能满足工业需求、个体农业难为工业提供资金等问题，人民公社20年，全国人口增长近2.8亿，为工业化、现代化提供了8000多亿的资金，修建了价值约180万亿的水利工程，功在当代，利在千秋。但是在这个过程也出现了浮夸风、共产风、一刀切和平均主义的隐患，为后来人民公社的取缔埋下了伏笔。</p><p>二．家庭联产承包责任制</p><p>  文革后的短时间内，全国经济不振，长期的平均主义政策抑制了农民的劳动积极性，致使农业生产长期停滞不前，农民生活质量得不到明显改善，再加上天灾不断，迫使中共对土地政策做出了调整。</p><p>  以安徽凤阳小岗村为代表的包产到户掀起了土地政策变革的大幕。1980年9月，中央下发《关于进一步加强和完善农业生产责任制的几个问题》的文件，明确在坚持土地集体所有的前提下，“可以包产到户，也可以包干到户”，在1982年颁布的中央1号文件中，中央强调，“包产到户”“包干到户”“都是建立在土地公有制基础上的，是社会主义农业经济的组成部分”。</p><p>  家庭联产承包责任制总体上而言，改变了我国农村旧的经营管理体制，解放了农村生产力，调动了广大农民的生产经营积极性。但是家庭分散经营，经营规模小、风险大，抗风险能力差，难以形成规模经济效益，而且农民不能自由处置土地，限制了农民的择业自由，另外分散化也导致农村基础设施难以建设，农业生产长期高成本。</p><p>三．90年代后的土地政策</p><p>  为打破这种制度上的障碍，推动农业发展走向规模化、现代化，提升农业的市场竞争力，中央在各地积极探索多种土地流转形式的基础上，开始从政策上积极鼓励、支持和引导承包农户进行土地流转。</p><p>  1992年邓小平同志“南巡讲话”后, 国家确立了建设社会主义市场经济的改革方针, 农业与农村经济发展掀起了新浪潮。2002年，党的十六大报告强调，有条件的地方，农民可以进行土地承包经营权流转；2003年，《农村土地承包法》明确规定，农民可以以出租、股份合作等形式进行土地承包经营权流转；2013年，党的十八届三中全会鼓励承包经营权“向专业大户、家庭农场、农民合作社、农业企业流转”，鼓励发展多种形式的规模经营。2016年10月，党中央颁布了《关于完善农村土地所有权承包权经营权分置办法的意见》，进一步明确了农村土地“三权分置”的改革思路和具体做法。2018年1月，在《关于实施乡村振兴战略的意见》中，党中央进一步明确，“完善农村承包地‘三权分置’制度”。</p><p>四．总结</p><p>  回顾土地政策的发展演变历史，土地政策的变革是毛泽东思想和中国特色社会主义的实践与证明。毛泽东指出：“当革命的形势己经改变的时候，革命的策略、革命的领导方式，也必须跟着改变。”邓小平思想中关于3个有利于的说法，也可以延伸出一个标准：是否有利于解放和发展生产力是衡量中国一切政党政策及其实践的根本标准。三个代表重要思想也提出“中国共产党始终代表中国先进生产力的发展要求，就是要不断地解放和发展生产力”。</p><div style="max-width: 900px;margin: 0 auto;">    <div id="food_container" style="max-width: 900px;height:400px;"></div></div><script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script><script type="text/javascript">    var food = echarts.init(document.getElementById('food_container'));    var base = new Date(), date = [];var data = [395.95, 395.95, 395.95, 395.95, 395.95, 443.93, 443.93, 443.93, 443.93, 443.93, 494.65, 494.65, 494.65, 684.31, 684.31, 684.31, 684.31, 684.31, 838.44, 838.44, 838.44, 838.44, 838.44, 1020.46, 1020.46, 1020.46, 1117.50, 1325.30, 1454.10, 1635.87, 1865.30, 2074.47, 2380.15, 2506.40, 2771.75, 3160.49, 3666.89, 4100.58, 4954.30, 5146.43, 5588.02, 6605.14, 9169.22, 11884.60, 13539.80, 13852.50, 14241.90, 14106.20, 13873.60, 14462.79, 14931.50, 14870.11, 18138.36, 19613.37, 21522.28, 24444.68, 27679.94, 29938.81, 35909.07, 40339.62, 44845.72, 48943.94, 51851.12, 54205.34, 55659.89, 58059.76, 61452.60, 66066.45];    var dyear = base.getFullYear(), dmonth = base.getMonth()+1;    var year = 1952;    while ( year<dyear ) {        date.push([year].join('/'));        year += 1;    }    var food_option = {        title: { text: '我国农业总产值', subtext: '自1952年起，数据来源国家统计局' },        tooltip: { trigger: 'axis' },        xAxis: { type: 'category', data: date },        yAxis: { type: 'value' },        dataZoom: [{}],        series: [{            type: 'line',            data: data        }]    };food.setOption(food_option);</script><p>  土地政策的变革证明：解放和发展生产力是制定和发展完善农村土地政策的必由之路。只要党的农村土地政策真正做到了解放生产力，发展生产力，农村就兴旺发达；忽略生产力的解放和发展，就会遇到坎坷和曲折。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;  我国在相当长的时间内是一个传统的农业国，哪怕工业化之后，农民仍然占据人口的大多数，土地依旧是百姓关注的焦点。而且土地还关系的粮食生产的多少，直接影响国家的安危。&lt;/p&gt;</summary>
    
    
    
    <category term="随记" scheme="https://foolishfox.cn/categories/%E9%9A%8F%E8%AE%B0/"/>
    
    
    <category term="马列毛邓" scheme="https://foolishfox.cn/tags/%E9%A9%AC%E5%88%97%E6%AF%9B%E9%82%93/"/>
    
  </entry>
  
  <entry>
    <title>宝塔Nginx反向代理导致css/js/png等重定向过多</title>
    <link href="https://foolishfox.cn/posts/202104-redirect.html"/>
    <id>https://foolishfox.cn/posts/202104-redirect.html</id>
    <published>2021-04-11T01:48:38.000Z</published>
    <updated>2021-04-12T12:58:40.647Z</updated>
    
    <content type="html"><![CDATA[        <h1 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>      <p>  在之前的文章<a href="/posts/move.html">博客服务器迁移过程</a>中介绍了<code>footprint</code>打造旅行地图，然后使用Nginx反向代理，将<code>ff.cn/travel</code>指向<code>127.0.0.1:886</code>，原本访问一切正常，但是昨天碰到了一个新的问题：css/js/png等文件请求301重定向过多，花了蛮久才解决问题，所以记下来提醒自己。</p><span id="more"></span>        <h1 id="复现"   >          <a href="#复现" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#复现"></a> 复现</h1>      <p>  在网站<code>/travel/</code>目录下创建<code>hello.js</code>文件，请求<code>ff.cn/travel/hello.js</code>，显示<code>ff.cn 将您重定向的次数过多</code>。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/04/20210412203604.png"  alt="" />      <br />  在开发者模式下查看网络请求，发现服务器将<code>ff.cn/travel/hello.js</code>重定向给自身，导致出现死循环。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/04/20210412203648.png"  alt="" />      </p>        <h1 id="解决"   >          <a href="#解决" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#解决"></a> 解决</h1>      <ol><li>浏览器提示清除cookie：</li></ol><blockquote><p>当相应网页尝试对您进行重定向的次数过多时，您就会看到这条错误消息。<br />有时，网页打不开是因为 Cookie 出问题了。要修正该错误，请尝试清除 Cookie。</p></blockquote>    <div class="note-plugin danger">      <span class="note-plugin__icon note-plugin__icon--danger">              <i class="fas fa-minus-circle"></i>            </span>      <p>无作用</p>    </div>  <ol start="2"><li>刷新DNS/更换DNS<br />  重定向过多可能发生了DNS劫持，可以刷新DNS或者换一个DNS地址。</li></ol>    <div class="note-plugin danger">      <span class="note-plugin__icon note-plugin__icon--danger">              <i class="fas fa-minus-circle"></i>            </span>      <p>无作用</p>    </div>  <ol start="3"><li>SSL证书问题<br />  如果开启了强制访问HTTPS或者SSL证书更换，可能导致前后端接口不一致，陷入反复跳转，造成重定向过多，可以重置SSL证书或者重启强制访问HTTPS。</li></ol>    <div class="note-plugin danger">      <span class="note-plugin__icon note-plugin__icon--danger">              <i class="fas fa-minus-circle"></i>            </span>      <p>无作用</p>    </div>          <h1 id="分析"   >          <a href="#分析" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#分析"></a> 分析</h1>      <p>  查看Nginx日志，发现浏览器发出请求<code>ff.cn/travel/hello.js</code>时，本应该转给<code>127.0.0.1:886/hello.js</code>，然而日志中显示回应请求的链接是<code>127.0.0.1:80/travel/hello.js</code>，怀疑是代理设置出现问题。<br />  查看<code>ff.cn</code>的配置文件如下：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">  listen 443 ssl http2;</span><br><span class="line">    server_name ff.cn;</span><br><span class="line">    index index.php index.html index.htm default.php default.htm default.html;</span><br><span class="line">    root &#x2F;ff.cn;</span><br><span class="line">    </span><br><span class="line">    #SSL-START SSL相关配置，请勿删除或修改下一行带注释的404规则</span><br><span class="line">    #error_page 404&#x2F;404.html;</span><br><span class="line">    #HTTP_TO_HTTPS_START</span><br><span class="line">    if ($server_port !~ 443)&#123;</span><br><span class="line">        rewrite ^(&#x2F;.*)$ https:&#x2F;&#x2F;$host$1 permanent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #SSL-END</span><br><span class="line">    </span><br><span class="line">    #ERROR-PAGE-START  错误页配置，可以注释、删除或修改</span><br><span class="line">    #error_page 404 &#x2F;404.html;</span><br><span class="line">    #error_page 502 &#x2F;502.html;</span><br><span class="line">    #ERROR-PAGE-END</span><br><span class="line">    </span><br><span class="line">    #PHP-INFO-START  PHP引用配置，可以注释或修改</span><br><span class="line">    #清理缓存规则</span><br><span class="line"></span><br><span class="line">    location ~ &#x2F;purge(&#x2F;.*) &#123;</span><br><span class="line">        proxy_cache_purge cache_one $host$1$is_args$args;</span><br><span class="line">        #access_log  &#x2F;www&#x2F;wwwlogs&#x2F;ff.cn_purge_cache.log;</span><br><span class="line">    &#125;</span><br><span class="line">    #引用反向代理规则，注释后配置的反向代理将无效</span><br><span class="line">    include &#x2F;www&#x2F;server&#x2F;panel&#x2F;vhost&#x2F;nginx&#x2F;proxy&#x2F;ff.cn&#x2F;*.conf;</span><br><span class="line"></span><br><span class="line">    include enable-php-00.conf;</span><br><span class="line">    #PHP-INFO-END</span><br><span class="line">    </span><br><span class="line">    #REWRITE-START URL重写规则引用,修改后将导致面板设置的伪静态规则失效</span><br><span class="line">    include &#x2F;www&#x2F;server&#x2F;panel&#x2F;vhost&#x2F;rewrite&#x2F;ff.cn.conf;</span><br><span class="line">    #REWRITE-END</span><br><span class="line">    </span><br><span class="line">    #禁止访问的文件或目录</span><br><span class="line">    location ~ ^&#x2F;(\.user.ini|\.htaccess|\.git|\.svn|\.project|LICENSE|README.md)</span><br><span class="line">    &#123;</span><br><span class="line">        return 404;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    #一键申请SSL证书验证目录相关设置</span><br><span class="line">    location ~ \.well-known&#123;</span><br><span class="line">        allow all;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    access_log  &#x2F;www&#x2F;wwwlogs&#x2F;ff.cn.log;</span><br><span class="line">    error_log  &#x2F;www&#x2F;wwwlogs&#x2F;ff.cn.error.log;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#PROXY-START&#x2F;travel&#x2F;</span><br><span class="line">location  ~* \.(php|jsp|js|css|png|cgi|asp|aspx)$</span><br><span class="line">&#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">&#125;</span><br><span class="line">location &#x2F;travel&#x2F;</span><br><span class="line">&#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1:886&#x2F;;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">    </span><br><span class="line">    add_header X-Cache $upstream_cache_status;</span><br><span class="line">    </span><br><span class="line">    #Set Nginx Cache</span><br><span class="line">    add_header Cache-Control no-cache;</span><br><span class="line">&#125;</span><br><span class="line">#PROXY-END&#x2F;travel&#x2F;</span><br></pre></td></tr></table></div></figure><p>  可以发现，问题出现在了代理配置中的<code>location ~* \.(php|jsp|js|css|png|cgi|asp|aspx)$</code>这一块。当接受到<code>ff.cn/travel/hello.js</code>请求时，根据代理配置进行转发，js/css/png等文件匹配上了第一条规则，于是请求被发往<code>127.0.0.1:80/travel/hello.js</code>，也就刚好是<code>ff.cn/travel/hello.js</code>自身，造成了死循环。将这一片段或者<code>js|css|png</code>删除即可解决</p>        <h1 id="后记"   >          <a href="#后记" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#后记"></a> 后记</h1>      <p>  宝塔确实有点诡异，上一秒还好好访问的，结果突然就重定向了。以后碰到问题多看日志，更容易发现问题所在的地方。</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h1&gt;
      
&lt;p&gt;  在之前的文章&lt;a href=&quot;/posts/move.html&quot;&gt;博客服务器迁移过程&lt;/a&gt;中介绍了&lt;code&gt;footprint&lt;/code&gt;打造旅行地图，然后使用Nginx反向代理，将&lt;code&gt;ff.cn/travel&lt;/code&gt;指向&lt;code&gt;127.0.0.1:886&lt;/code&gt;，原本访问一切正常，但是昨天碰到了一个新的问题：css/js/png等文件请求301重定向过多，花了蛮久才解决问题，所以记下来提醒自己。&lt;/p&gt;</summary>
    
    
    
    <category term="博客" scheme="https://foolishfox.cn/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    
    <category term="Nginx" scheme="https://foolishfox.cn/tags/Nginx/"/>
    
  </entry>
  
</feed>
