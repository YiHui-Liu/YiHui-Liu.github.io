<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Fox Home</title>
  
  <subtitle>清疚</subtitle>
  <link href="https://foolishfox.cn/atom.xml" rel="self"/>
  
  <link href="https://foolishfox.cn/"/>
  <updated>2021-05-22T03:14:46.854Z</updated>
  <id>https://foolishfox.cn/</id>
  
  <author>
    <name>liuyihui</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>博客成长日志 | 准实时访问统计</title>
    <link href="https://foolishfox.cn/posts/202105-visit.html"/>
    <id>https://foolishfox.cn/posts/202105-visit.html</id>
    <published>2021-05-19T16:09:37.000Z</published>
    <updated>2021-05-22T03:14:46.854Z</updated>
    
    <content type="html"><![CDATA[        <h2 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2>      <p>  通过百度统计、CNZZ等服务，我们可以记录站点的访问地图、访问量和来源，如果想要展示数据，可以选择直接导向服务商提供的公开页面，但是样式丑陋，所以本文通过百度统计API，使用Echarts制作站点访问准实时统计页面，效果可以参考<a href="/s/statistics/">统计</a>。</p><span id="more"></span><p>  之所以说是准实时统计，是因为为了解决跨域问题（CROS error），本文采用的方法是定时通过百度统计API将数据下载保存为json文件，放置在网站目录下（后续可能会发展为vercel api，挖坑）。不过作为个人博客，方式访问量不会很大，没有必要实时更新，目前本站设置是每隔6小时更新一次。</p>        <h2 id="数据获取"   >          <a href="#数据获取" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#数据获取"></a> 数据获取</h2>              <h3 id="百度统计"   >          <a href="#百度统计" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#百度统计"></a> 百度统计</h3>      <p>  在设置样式之前首先需要获取统计数据，使用百度账号登陆<span class="exturl"><a class="exturl__link"   href="https://tongji.baidu.com/web/welcome/login" >百度统计</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，根据<a href="#refer-4">参考资料4</a>进行操作，获取token与site_id，具体教程可以查看<a href="#refer-1">参考资料1</a>。</p>        <h3 id="下载文件"   >          <a href="#下载文件" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#下载文件"></a> 下载文件</h3>      <p>  通过6个链接，我们可以获取：一年内每日访问统计、访问地图数据、月度访问统计、来源分类统计、搜索引擎访问统计和外部链接访问统计；通过python或者nodejs都可以很方便的下载文件保存，以下为python的示例：</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time, datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始统计的日期</span></span><br><span class="line">start_date   = <span class="string">&#x27;20201218&#x27;</span></span><br><span class="line">date         = datetime.datetime.now()</span><br><span class="line"><span class="comment"># 结束统计的日期</span></span><br><span class="line">end_date     = <span class="built_in">str</span>(date.year) + (<span class="built_in">str</span>(date.month) <span class="keyword">if</span> date.month &gt; <span class="number">9</span> <span class="keyword">else</span> (<span class="string">&#x27;0&#x27;</span> + <span class="built_in">str</span>(date.month))) + (<span class="built_in">str</span>(date.day) <span class="keyword">if</span> date.day &gt; <span class="number">9</span> <span class="keyword">else</span> (<span class="string">&#x27;0&#x27;</span> + <span class="built_in">str</span>(date.day)))</span><br><span class="line"><span class="comment"># token和siteid</span></span><br><span class="line">access_token = <span class="string">&#x27;121.6e...&#x27;</span></span><br><span class="line">site_id      = <span class="string">&#x27;16******&#x27;</span></span><br><span class="line"><span class="comment"># 百度统计API</span></span><br><span class="line">dataUrl      = <span class="string">&#x27;https://openapi.baidu.com/rest/2.0/tongji/report/getData?access_token=&#x27;</span> + access_token + <span class="string">&#x27;&amp;site_id=&#x27;</span> + site_id</span><br><span class="line"><span class="comment"># 统计访问次数 PV 填写 &#x27;pv_count&#x27;，统计访客数 UV 填写 &#x27;visitor_count&#x27;，二选一</span></span><br><span class="line">metrics      = <span class="string">&#x27;pv_count&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downFile</span>(<span class="params">url, fileName, prefix=<span class="string">&#x27;/home/API/data/&#x27;</span></span>):</span></span><br><span class="line">    print(<span class="string">&#x27;downloading :&#x27;</span>, url)</span><br><span class="line">    down_res = requests.get(url)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(prefix+fileName, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(down_res.content)</span><br><span class="line">    print(<span class="string">&#x27;writing :&#x27;</span>, prefix+fileName)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访客地图</span></span><br><span class="line">downFile(dataUrl + <span class="string">&#x27;&amp;start_date=&#x27;</span> + start_date + <span class="string">&#x27;&amp;end_date=&#x27;</span> + end_date + <span class="string">&#x27;&amp;metrics=&#x27;</span> + metrics + <span class="string">&#x27;&amp;method=visit/district/a&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;map.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问趋势</span></span><br><span class="line">downFile(dataUrl + <span class="string">&#x27;&amp;start_date=&#x27;</span> + start_date + <span class="string">&#x27;&amp;end_date=&#x27;</span> + end_date + <span class="string">&#x27;&amp;metrics=&#x27;</span> + metrics + <span class="string">&#x27;&amp;method=trend/time/a&amp;gran=month&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;trends.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问来源</span></span><br><span class="line">downFile(dataUrl + <span class="string">&#x27;&amp;start_date=&#x27;</span> + start_date + <span class="string">&#x27;&amp;end_date=&#x27;</span> + end_date + <span class="string">&#x27;&amp;metrics=&#x27;</span> + metrics + <span class="string">&#x27;&amp;method=source/all/a&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;sources.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 搜索引擎</span></span><br><span class="line">downFile(dataUrl + <span class="string">&#x27;&amp;start_date=&#x27;</span> + start_date + <span class="string">&#x27;&amp;end_date=&#x27;</span> + end_date + <span class="string">&#x27;&amp;metrics=&#x27;</span> + metrics + <span class="string">&#x27;&amp;method=source/engine/a&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;engine.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 外部链接</span></span><br><span class="line">downFile(dataUrl + <span class="string">&#x27;&amp;start_date=&#x27;</span> + start_date + <span class="string">&#x27;&amp;end_date=&#x27;</span> + end_date + <span class="string">&#x27;&amp;metrics=&#x27;</span> + metrics + <span class="string">&#x27;&amp;method=source/link/a&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;link.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问日历</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">访问日历需要获取一年内的数据，按照一年365天计算，大概为52周多一点，所以前面有完整的52排，获取方式只要通过开始日期年份-1即可</span></span><br><span class="line"><span class="string">然后就是第53排的处理，python中的date.weekday()获取的星期几是0对应周一，所以通过(date.weekday()+1)%7即可转换到0对应周日</span></span><br><span class="line"><span class="string">于是在52周的基础上，减去星期数，就可以得到新的start_date</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">date       = datetime.datetime(date.year-<span class="number">1</span>, date.month, date.day)</span><br><span class="line">date       = datetime.datetime.fromtimestamp(date.timestamp()-<span class="number">3600</span>*<span class="number">24</span>*((date.weekday()+<span class="number">1</span>)%<span class="number">7</span>))</span><br><span class="line">start_date = <span class="built_in">str</span>(date.year) + (<span class="built_in">str</span>(date.month) <span class="keyword">if</span> date.month &gt; <span class="number">9</span> <span class="keyword">else</span> (<span class="string">&#x27;0&#x27;</span> + <span class="built_in">str</span>(date.month))) + (<span class="built_in">str</span>(date.day) <span class="keyword">if</span> date.day &gt; <span class="number">9</span> <span class="keyword">else</span> (<span class="string">&#x27;0&#x27;</span> + <span class="built_in">str</span>(date.day)))</span><br><span class="line">downFile(dataUrl + <span class="string">&#x27;&amp;method=overview/getTimeTrendRpt&#x27;</span> + <span class="string">&#x27;&amp;metrics=&#x27;</span> + metrics + <span class="string">&#x27;&amp;start_date=&#x27;</span> + start_date + <span class="string">&#x27;&amp;end_date=&#x27;</span> + end_date,</span><br><span class="line">    <span class="string">&#x27;calendar.json&#x27;</span>)</span><br></pre></td></tr></table></div></figure>        <h3 id="自动更新"   >          <a href="#自动更新" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#自动更新"></a> 自动更新</h3>      <p>  在Linux中可以通过<code>crontab</code>设置定时任务，以下为每整6小时的0点执行一次任务：</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0 0 * * * /usr/bin/python /home/API/data/get.py &gt;&gt; /home/API/data/get.log</span><br><span class="line">0 6 * * * /usr/bin/python /home/API/data/get.py &gt;&gt; /home/API/data/get.log</span><br><span class="line">0 12 * * * /usr/bin/python /home/API/data/get.py &gt;&gt; /home/API/data/get.log</span><br><span class="line">0 18 * * * /usr/bin/python /home/API/data/get.py &gt;&gt; /home/API/data/get.log</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">0 0,6,12,18 * * * /usr/bin/python /home/API/data/get.py &gt;&gt; /home/API/data/get.log</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">0 */6 * * * /usr/bin/python /home/API/data/get.py &gt;&gt; /home/API/data/get.log</span><br></pre></td></tr></table></div></figure>        <h2 id="数据展示"   >          <a href="#数据展示" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#数据展示"></a> 数据展示</h2>              <h3 id="统计图容器"   >          <a href="#统计图容器" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#统计图容器"></a> 统计图容器</h3>      <p>  在html代码中插入：</p><figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/echarts@4.7.0/dist/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/echarts@4.7.0/map/js/china.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 90%;margin: 0 auto;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;calendar_container&quot;</span> <span class="attr">class</span>=<span class="string">&quot;data-container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;map_container&quot;</span> <span class="attr">class</span>=<span class="string">&quot;data-container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 500px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;trends_container&quot;</span> <span class="attr">class</span>=<span class="string">&quot;data-container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 350px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;sources_container&quot;</span> <span class="attr">class</span>=<span class="string">&quot;data-container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 450px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/calendar.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/census.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></div></figure>        <h3 id="访问日历"   >          <a href="#访问日历" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#访问日历"></a> 访问日历</h3>      <p>  访问日历类似于Github贡献日历，有两种方法实现。</p><ol><li>源自于<span class="exturl"><a class="exturl__link"   href="https://zfe.space/post/hexo-githubcalendar.html" >hexo-githubcalendar 插件</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，由<span class="exturl"><a class="exturl__link"   href="https://blog.eurkon.com/" >Eurkon</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>修改，原文见<a href="#refer-3">参考资料3</a>。点击<span class="exturl"><a class="exturl__link"   href="https://github.com/YiHui-Liu/Fox-Home-CDN/blob/5eadc9f050b9d759dc14786085253b000049b7de/calendar.js" >链接</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>下载<code>calendar.js</code>文件，需要修改的地方有：</li></ol><figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 下面的链接是本站点的访问数据，需要修改为自己的，为了防止浏览器缓存的干扰，在url后添加了时间戳，可以进一步优化为时间的小时数对6取模</span></span><br><span class="line">fetch(<span class="string">&#x27;https://api.foolishfox.cn/data/calendar.json?date&#x27;</span>+<span class="keyword">new</span> <span class="built_in">Date</span>()).then(<span class="function"><span class="params">data</span> =&gt;</span> data.json()).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 统计访问次数 PV 填写 &#x27;pv_count&#x27;，统计访客数 UV 填写 &#x27;visitor_count&#x27;，二选一</span></span><br><span class="line">visit_calendar(<span class="string">&#x27;pv_count&#x27;</span>, visit_color);</span><br><span class="line">...</span><br></pre></td></tr></table></div></figure><p>  另外，需要更改容器id可以直接搜索替换即可。</p><ol start="2"><li>通过<span class="exturl"><a class="exturl__link"   href="https://cdn.jsdelivr.net/gh/YiHui-Liu/Fox-Home-CDN/census.js" >census.js</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>进行设置，包括后续的访问地图、访问趋势（访问次数）和访问来源都是基于此文件通过Echarts实现的。</li></ol><figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 统计访问次数 PV 填写 &#x27;pv_count&#x27;，统计访客数 UV 填写 &#x27;visitor_count&#x27;，二选一</span></span><br><span class="line"><span class="keyword">var</span> metrics     = <span class="string">&#x27;pv_count&#x27;</span></span><br><span class="line"><span class="keyword">var</span> metricsName = (metrics === <span class="string">&#x27;pv_count&#x27;</span> ? <span class="string">&#x27;访问次数&#x27;</span> : (metrics === <span class="string">&#x27;visitor_count&#x27;</span> ? <span class="string">&#x27;访客数&#x27;</span> : <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calChart</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">&quot;script&quot;</span>)</span><br><span class="line">    <span class="comment">// 下面的链接是本站点的访问数据，需要修改为自己的，为了防止浏览器缓存的干扰，在url后添加了时间戳，可以进一步优化为时间的小时数对6取模</span></span><br><span class="line">    fetch(<span class="string">&#x27;https://api.foolishfox.cn/data/calendar.json?date&#x27;</span>+<span class="keyword">new</span> <span class="built_in">Date</span>()).then(<span class="function"><span class="params">data</span> =&gt;</span> data.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// 颜色盒，用于设置不同数据的展示颜色，可更改</span></span><br><span class="line">        <span class="keyword">let</span> colorBox = [<span class="string">&#x27;#EBEDF0&#x27;</span>, <span class="string">&#x27;#FFE9BB&#x27;</span>, <span class="string">&#x27;#FFD1A7&#x27;</span>, <span class="string">&#x27;#FFBB95&#x27;</span>, <span class="string">&#x27;#FFA383&#x27;</span>, <span class="string">&#x27;#FF8D70&#x27;</span>, <span class="string">&#x27;#FF745C&#x27;</span>, <span class="string">&#x27;#FF5C4A&#x27;</span>, <span class="string">&#x27;#FF4638&#x27;</span>, <span class="string">&#x27;#FF2E26&#x27;</span>, <span class="string">&#x27;#FF1812&#x27;</span>];</span><br></pre></td></tr></table></div></figure>        <h3 id="访问地图"   >          <a href="#访问地图" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#访问地图"></a> 访问地图</h3>      <p>  最简单的就是访问地图，直接修改json文件的请求url即可：</p><figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 访问地图</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapChart</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">&quot;script&quot;</span>)</span><br><span class="line">    <span class="comment">// 下面的链接是本站点的访问数据，需要修改为自己的，为了防止浏览器缓存的干扰，在url后添加了时间戳，可以进一步优化为时间的小时数对6取模</span></span><br><span class="line">    fetch(<span class="string">&#x27;https://api.foolishfox.cn/data/map.json?date&#x27;</span>+<span class="keyword">new</span> <span class="built_in">Date</span>()).then(<span class="function"><span class="params">data</span> =&gt;</span> data.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br></pre></td></tr></table></div></figure>        <h3 id="访问趋势"   >          <a href="#访问趋势" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#访问趋势"></a> 访问趋势</h3>      <p>  访问趋势中按照年份，将12个月的数据展开，需要从json中获取到年份和月份信息，由于时间日期格式是固定的，所以可以直接截取。本部分代码以下列展示的为准：</p><figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取年份和月份</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_year</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">parseInt</span>(s.substr(<span class="number">0</span>, <span class="number">4</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_month</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">parseInt</span>(s.substr(<span class="number">5</span>, <span class="number">2</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 访问趋势</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trendsChart</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">&quot;script&quot;</span>)</span><br><span class="line">    <span class="comment">// 下面的链接是本站点的访问数据，需要修改为自己的，为了防止浏览器缓存的干扰，在url后添加了时间戳，可以进一步优化为时间的小时数对6取模</span></span><br><span class="line">    fetch(<span class="string">&#x27;https://api.foolishfox.cn/data/trends.json?date&#x27;</span>+<span class="keyword">new</span> <span class="built_in">Date</span>()).then(<span class="function"><span class="params">data</span> =&gt;</span> data.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="keyword">let</span> monthValueArr = &#123;&#125;;</span><br><span class="line">        <span class="keyword">let</span> monthName = data.result.items[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">let</span> monthValue = data.result.items[<span class="number">1</span>];</span><br><span class="line">        <span class="comment">// 2020是起始年份，改为你自己的</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i =<span class="number">2020</span>; i &lt;= date.getFullYear(); i++)   monthValueArr[<span class="built_in">String</span>(i)] = [ ,  ,  ,  ,  ,  ,  ,  ,  ,  ,  ,  ];</span><br><span class="line">        monthValueArr</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; monthName.length; i++) &#123;</span><br><span class="line">            <span class="keyword">let</span> year = get_year(monthName[i][<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">let</span> month = get_month(monthName[i][<span class="number">0</span>]);</span><br><span class="line">            monthValueArr[<span class="built_in">String</span>(year)][<span class="built_in">String</span>(month-<span class="number">1</span>)] = monthValue[i][<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 以后每过一年，需要手动添加以下legend和series</span></span><br><span class="line">        script.innerHTML = <span class="string">`</span></span><br><span class="line"><span class="string">        var trendsChart = echarts.init(document.getElementById(&#x27;trends_container&#x27;), &#x27;light&#x27;);</span></span><br><span class="line"><span class="string">        var trendsOption = &#123;</span></span><br><span class="line"><span class="string">            title: &#123; text: &#x27;访问趋势&#x27;, x: &#x27;center&#x27; &#125;,</span></span><br><span class="line"><span class="string">            tooltip: &#123; trigger: &#x27;axis&#x27; &#125;,</span></span><br><span class="line"><span class="string">            legend: &#123; data: [&#x27;2020&#x27;, &#x27;2021&#x27;], x: &#x27;right&#x27; &#125;,</span></span><br><span class="line"><span class="string">            xAxis: &#123;</span></span><br><span class="line"><span class="string">                name: &#x27;日期&#x27;, type: &#x27;category&#x27;, boundaryGap: false,</span></span><br><span class="line"><span class="string">                data: [&#x27;一月&#x27;, &#x27;二月&#x27;, &#x27;三月&#x27;, &#x27;四月&#x27;, &#x27;五月&#x27;, &#x27;六月&#x27;, &#x27;七月&#x27;, &#x27;八月&#x27;, &#x27;九月&#x27;, &#x27;十月&#x27;, &#x27;十一月&#x27;, &#x27;十二月&#x27;]</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">            yAxis: &#123; name: &#x27;<span class="subst">$&#123;metricsName&#125;</span>&#x27;, type: &#x27;value&#x27; &#125;,</span></span><br><span class="line"><span class="string">            series: [</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                    name: &#x27;2020&#x27;, type: &#x27;line&#x27;, smooth: true,</span></span><br><span class="line"><span class="string">                    data: [<span class="subst">$&#123;monthValueArr[<span class="string">&quot;2020&quot;</span>]&#125;</span>],</span></span><br><span class="line"><span class="string">                    markLine: &#123; data: [&#123;type: &#x27;average&#x27;, name: &#x27;平均值&#x27;&#125;] &#125;</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                    name: &#x27;2021&#x27;, type: &#x27;line&#x27;, smooth: true,</span></span><br><span class="line"><span class="string">                    data: [<span class="subst">$&#123;monthValueArr[<span class="string">&quot;2021&quot;</span>]&#125;</span>],</span></span><br><span class="line"><span class="string">                    markLine: &#123; data: [&#123;type: &#x27;average&#x27;, name: &#x27;平均值&#x27;&#125;] &#125;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            ]</span></span><br><span class="line"><span class="string">        &#125;;</span></span><br><span class="line"><span class="string">        trendsChart.setOption(trendsOption);</span></span><br><span class="line"><span class="string">        window.addEventListener(&quot;resize&quot;, () =&gt; &#123; </span></span><br><span class="line"><span class="string">            trendsChart.resize();</span></span><br><span class="line"><span class="string">        &#125;);`</span></span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">&#x27;trends_container&#x27;</span>).after(script);</span><br><span class="line">    &#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h3 id="访问来源"   >          <a href="#访问来源" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#访问来源"></a> 访问来源</h3>      <p>  留在最后的是最复杂的访问来源，实际上百度的全部来源(<code>source/all/a</code>)API可以将来源分为：直达、外部链接和搜索引擎三个部分，直接使用并不困难。但是百度统计会将必应（<code>cn.bing.com</code>和<code>www.bing.com</code>）的来源归类到外部链接而不是搜索引擎，而且我自己还想统计来自于Github、十年之约等网站的流量，所以需要获取多个数据文件。</p><figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 下面的链接是本站点的访问数据，需要修改为自己的，为了防止浏览器缓存的干扰，在url后添加了时间戳，可以进一步优化为时间的小时数对6取模</span></span><br><span class="line">fetch(<span class="string">&#x27;https://api.foolishfox.cn/data/sources.json?date&#x27;</span>+<span class="keyword">new</span> <span class="built_in">Date</span>()).then(<span class="function"><span class="params">data</span> =&gt;</span> data.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> sourcesName = data.result.items[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> sourcesValue = data.result.items[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">let</span> sourcesArr = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; sourcesName.length; i++)</span><br><span class="line">        sourcesArr.push(&#123; <span class="attr">name</span>: sourcesName[i][<span class="number">0</span>].name, <span class="attr">value</span>: sourcesValue[i][<span class="number">0</span>] &#125;);</span><br><span class="line">    <span class="comment">// 记录总体数据，方便后续调用（使用var定义在fetch外面）</span></span><br><span class="line">    link = sourcesArr[<span class="number">1</span>][<span class="string">&#x27;value&#x27;</span>] ;</span><br><span class="line">    search = sourcesArr[<span class="number">2</span>][<span class="string">&#x27;value&#x27;</span>];</span><br><span class="line">    direct = sourcesArr[<span class="number">0</span>][<span class="string">&#x27;value&#x27;</span>];</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 下面的链接是本站点的访问数据，需要修改为自己的，为了防止浏览器缓存的干扰，在url后添加了时间戳，可以进一步优化为时间的小时数对6取模</span></span><br><span class="line">fetch(<span class="string">&#x27;https://api.foolishfox.cn/data/link.json?date&#x27;</span>+<span class="keyword">new</span> <span class="built_in">Date</span>()).then(<span class="function"><span class="params">data</span> =&gt;</span> data.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> linksName = data.result.items[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> linksValue = data.result.items[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">let</span> linksArr = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; linksName.length; i++)</span><br><span class="line">        linksArr[linksName[i][<span class="number">0</span>].name] = linksValue[i][<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// 除必应外，其他的都是自己想要统计的网站，都是http链接</span></span><br><span class="line">    <span class="keyword">let</span> sum = data.result.sum[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> bing = linksArr[<span class="string">&#x27;http://cn.bing.com&#x27;</span>]+linksArr[<span class="string">&#x27;http://www.bing.com&#x27;</span>];</span><br><span class="line">    <span class="keyword">let</span> github = linksArr[<span class="string">&#x27;http://github.com&#x27;</span>];</span><br><span class="line">    <span class="keyword">let</span> travel = linksArr[<span class="string">&#x27;http://travellings.now.sh&#x27;</span>]+linksArr[<span class="string">&#x27;http://travellings.vercel.app&#x27;</span>]+linksArr[<span class="string">&#x27;http://www.foreverblog.cn&#x27;</span>];</span><br><span class="line">    innerHTML += <span class="string">`</span></span><br><span class="line"><span class="string">                    &#123;value: <span class="subst">$&#123;bing&#125;</span>, name: &#x27;必应&#x27;&#125;,</span></span><br><span class="line"><span class="string">                    &#123;value: <span class="subst">$&#123;direct&#125;</span>, name: &#x27;直达&#x27;&#125;,</span></span><br><span class="line"><span class="string">                    &#123;value: <span class="subst">$&#123;github&#125;</span>, name: &#x27;Github&#x27;&#125;,</span></span><br><span class="line"><span class="string">                    &#123;value: <span class="subst">$&#123;travel&#125;</span>, name: &#x27;开往/十年之约&#x27;&#125;,`</span>+</span><br><span class="line">                    <span class="comment">// 将来自于必应的访问减去</span></span><br><span class="line">                    <span class="string">`&#123;value: <span class="subst">$&#123;sum-bing-github-travel+<span class="number">65</span>&#125;</span>, name: &#x27;其他&#x27;&#125;</span></span><br><span class="line"><span class="string">                ]</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                name: &#x27;访问来源&#x27;, type: &#x27;pie&#x27;, selectedMode: &#x27;single&#x27;, radius: [0, &#x27;30%&#x27;],</span></span><br><span class="line"><span class="string">                label: &#123; position: &#x27;inner&#x27;, fontSize: 14&#125;,</span></span><br><span class="line"><span class="string">                labelLine: &#123; show: false &#125;,</span></span><br><span class="line"><span class="string">                data: [`</span>+</span><br><span class="line">                    <span class="comment">// 将来自于必应的访问从外链中减去，加入搜索中</span></span><br><span class="line">                    <span class="string">`&#123;value: <span class="subst">$&#123;search+bing&#125;</span>, name: &#x27;搜索&#x27;, itemStyle: &#123; color : &#x27;green&#x27; &#125;&#125;,</span></span><br><span class="line"><span class="string">                    &#123;value: <span class="subst">$&#123;direct&#125;</span>, name: &#x27;直达&#x27;, itemStyle: &#123; color : &#x27;#FFDB5C&#x27; &#125;&#125;,</span></span><br><span class="line"><span class="string">                    &#123;value: <span class="subst">$&#123;link-bing&#125;</span>, name: &#x27;外链&#x27;, itemStyle: &#123; color : &#x27;#32C5E9&#x27; &#125;&#125;</span></span><br><span class="line"><span class="string">                ]</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></div></figure>        <h2 id="qa"   >          <a href="#qa" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#qa"></a> Q&amp;A</h2>      <ol><li><p>不想使用python下载文件保存，想要实时统计<br />根据<a href="#refer-2">参考资料2</a>中4.3节——自建 Vercel API（可选）进行设置，替换上述文件中的url即可</p></li><li><p>依然出现跨域问题？<br />请务必保证通过2.2节获取的文件保存在博客的网站目录下，并通过url可以访问；如果想要向我一样通过其他域名（例如<code>api.foolishfox.cn/data/*.json</code>）访问，需要对服务器进行设置，以Nginx为例：</p></li></ol><figure class="highlight nginx"><figcaption><span>configuration</span></figcaption><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#data CROS</span></span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ ^/data/</span> &#123;</span><br><span class="line">    <span class="attribute">if</span> ($http_origin <span class="regexp">~* (http://localhost:4000|https://foolishfox.cn))</span> &#123;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="string">&quot;$http_origin&quot;</span>;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span> <span class="string">&#x27;GET, POST, OPTIONS&#x27;</span>;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span> <span class="string">&#x27;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ol start="3"><li><p>地图显示错误<br />务必注意，Echarts目前已经不提供地图js/json文件的下载，所以要通过npm获取到旧版本中的<code>China.js</code>文件，因此Echarts的版本最好也保持一致</p></li><li><p>Echarts绘制的访问日历无法自动适应窗口大小<br />正在积极解决中…</p></li></ol>        <h2 id="参考资料"   >          <a href="#参考资料" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h2>      <p><span id="refer-1">1. <span class="exturl"><a class="exturl__link"   href="https://blog.eurkon.com/post/ef1da941.html" >Hexo 博客访问统计图</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-2">2. <span class="exturl"><a class="exturl__link"   href="https://blog.eurkon.com/post/61763977.html" >Hexo 博客实时访问统计图</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-3">3. <span class="exturl"><a class="exturl__link"   href="https://blog.eurkon.com/post/1a169b5a.html" >Hexo 博客访问日历图</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-4">4. <span class="exturl"><a class="exturl__link"   href="https://tongji.baidu.com/api/manual/" >百度统计用户手册</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-5">5. <span class="exturl"><a class="exturl__link"   href="https://echarts.apache.org/examples/zh/index.html" >Echarts文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h2&gt;
      
&lt;p&gt;  通过百度统计、CNZZ等服务，我们可以记录站点的访问地图、访问量和来源，如果想要展示数据，可以选择直接导向服务商提供的公开页面，但是样式丑陋，所以本文通过百度统计API，使用Echarts制作站点访问准实时统计页面，效果可以参考&lt;a href=&quot;/s/statistics/&quot;&gt;统计&lt;/a&gt;。&lt;/p&gt;</summary>
    
    
    
    <category term="博客成长日志" scheme="https://foolishfox.cn/categories/%E5%8D%9A%E5%AE%A2%E6%88%90%E9%95%BF%E6%97%A5%E5%BF%97/"/>
    
    
    <category term="Hexo" scheme="https://foolishfox.cn/tags/Hexo/"/>
    
    <category term="Echarts" scheme="https://foolishfox.cn/tags/Echarts/"/>
    
    <category term="百度统计" scheme="https://foolishfox.cn/tags/%E7%99%BE%E5%BA%A6%E7%BB%9F%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>Yourls : 短链接生成器与短域名获取</title>
    <link href="https://foolishfox.cn/posts/202105-yourls.html"/>
    <id>https://foolishfox.cn/posts/202105-yourls.html</id>
    <published>2021-05-14T15:01:00.000Z</published>
    <updated>2021-05-20T10:05:14.142Z</updated>
    
    <content type="html"><![CDATA[        <h2 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2>      <p>  你是否遇到过这样的场景？你有一个链接，例如<code>https://arxiv.org/abs/2104.14228</code>，需要分享给朋友，这个链接长而且不好记忆，需要经常用到的时候也不方便，假设你需要发微博，由于字数限制，链接长度越短越好，这时候如果有一个链接<code>https://ffox.ml/grid02</code>经过重定向可以指向前文的网址，那边就会很美观且方便，而这就需要用到短链接生成技术。</p><span id="more"></span><p>  其实短链接的作用主要在于数据统计、控制访问、便于管理。另外相同的页面，短链接与原链接生成的二维码的复杂度也大大不同。目前市面上主要的短链接服务可以参考：<span class="exturl"><a class="exturl__link"   href="https://sina.lt/why.php" >短网址服务，我们该怎么选？</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，其中安照优先级介绍了部分优质的服务提供商。</p><p>  除了使用服务商提供的短链接生成服务外，我们其实还可以自己搭建一个这样的服务。原理很简单，通过某种算法将长链接<code>A</code>转化为一个短字符串<code>B</code>，浏览器结合域名<code>C</code>访问<code>C/B</code>，服务器响应跳转至<code>A</code>，并在过程中完成数据的统计。目前有很多开源的短链接服务，其中之一就是今天的主角<code>Yourls</code>。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/1621008545.png"  alt="" />      </p>        <h2 id="yourls"   >          <a href="#yourls" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#yourls"></a> Yourls</h2>      <blockquote><p>YOURLS stands for Your Own URL Shortener. It is a small set of PHP scripts that will allow you to run your own URL shortening service (a la TinyURL or Bitly).<br />Running your own URL shortener is fun, geeky and useful: you own your data and do not depend on third-party services. It is also a great way to add branding to your short URLs, instead of using the same public URL shortener everyone uses.</p></blockquote><p>  <code>Yourls</code>的特性是开源免费，可以管理、统计每一个短链接的数量，提供API接口，而且具有众多插件，便于进行二次开发，下面就一起搭建一个自己的软链接服务。</p>        <h3 id="准备"   >          <a href="#准备" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#准备"></a> 准备</h3>      <p>  <code>Yourls</code>是基于PHP和MySQL开发的，所以需要提前准备好：</p><ul><li>Apache（2.4版本及以上）或Nginx服务器</li><li>PHP（7.4版本及以上）</li><li>MySQL（5.0版本及以上）</li></ul><p>  另外如果需要使用API接口，还需要安装PHP <span class="exturl"><a class="exturl__link"   href="https://www.php.net/curl" >cURL</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>拓展。</p>        <h3 id="安装"   >          <a href="#安装" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#安装"></a> 安装</h3>              <h4 id="下载"   >          <a href="#下载" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#下载"></a> 下载</h4>      <p>  从<span class="exturl"><a class="exturl__link"   href="https://github.com/YOURLS/YOURLS/releases" >Releases</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>下载最新版本的安装包，目前使用的是1.8.1版本，并解压至工作目录</p>        <h4 id="配置文件"   >          <a href="#配置文件" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#配置文件"></a> 配置文件</h4>      <p>  将<code>user</code>目录下的<code>config-sample.php</code>复制备份命名为<code>config.php</code>，修改配置如下，更多设置请参考<span class="exturl"><a class="exturl__link"   href="https://yourls.org/#Config" >Config</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据库配置</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_DB_USER&#x27;</span>, <span class="string">&#x27;yourls&#x27;</span> );   <span class="comment">//用户名</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_DB_PASS&#x27;</span>, <span class="string">&#x27;xxxxxxxx&#x27;</span> );   <span class="comment">//密码</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_DB_NAME&#x27;</span>, <span class="string">&#x27;yourls&#x27;</span> );   <span class="comment">//数据库名</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_DB_HOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span> );   <span class="comment">//地址</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_DB_PREFIX&#x27;</span>, <span class="string">&#x27;yourls_&#x27;</span> );   <span class="comment">//表前缀</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 站点设置</span></span><br><span class="line"><span class="comment">#设置站点</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_SITE&#x27;</span>, <span class="string">&#x27;http://ozh.in&#x27;</span> );   <span class="comment">//域名</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_LANG&#x27;</span>, <span class="string">&#x27;&#x27;</span> );   <span class="comment">//语言</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_UNIQUE_URLS&#x27;</span>, <span class="literal">true</span> );   <span class="comment">//是否允许长链接对应多个短链接</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_HOURS_OFFSET&#x27;</span>, <span class="string">&#x27;-5&#x27;</span> );   <span class="comment">//时区偏移</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_PRIVATE&#x27;</span>, <span class="string">&#x27;true&#x27;</span> );   <span class="comment">//是否私有，如果私有的，则api接口需要传递用户名和密码，如果公开，则可以自由访问后台</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_COOKIEKEY&#x27;</span>, <span class="string">&#x27;modify this text with something random&#x27;</span> );   <span class="comment">//设置cookie，可访问http://yourls.org/cookie生成</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户设置</span></span><br><span class="line"><span class="variable">$yourls_user_passwords</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;password&#x27;</span>,   <span class="comment">//用户名=&gt;密码，可填多个，登录成功后这里的明文密码会被加密</span></span><br><span class="line">    );</span><br><span class="line">define( <span class="string">&#x27;YOURLS_DEBUG&#x27;</span>, <span class="literal">false</span> );   <span class="comment">//是否开启调试</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_URL_CONVERT&#x27;</span>, <span class="number">62</span> );   <span class="comment">//短链接字符串使用36进制或2进制，建议62进制</span></span><br><span class="line"><span class="variable">$yourls_reserved_URL</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;porn&#x27;</span>, <span class="string">&#x27;faggot&#x27;</span>, <span class="string">&#x27;sex&#x27;</span>, <span class="string">&#x27;nigger&#x27;</span>, <span class="string">&#x27;fuck&#x27;</span>, <span class="string">&#x27;cunt&#x27;</span>, <span class="string">&#x27;dick&#x27;</span>,   <span class="comment">//黑名单</span></span><br><span class="line">);</span><br></pre></td></tr></table></div></figure>        <h4 id="服务器设置"   >          <a href="#服务器设置" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#服务器设置"></a> 服务器设置</h4>      <ol><li>Apache<br />需要开启<code>mod_rewrite</code>模块，编辑<span class="exturl"><a class="exturl__link"   href="https://github.com/YOURLS/YOURLS/wiki/.htaccess" >.htaccess</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>文件：</li></ol><figure class="highlight apache"><figcaption><span>configuration</span></figcaption><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根目录http://yoursite/</span></span><br><span class="line"><span class="comment"># BEGIN YOURLS</span></span><br><span class="line"><span class="section">&lt;IfModule mod_rewrite.c&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteEngine</span></span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">RewriteBase</span> /</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;REQUEST_FILENAME&#125;</span> !-f</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;REQUEST_FILENAME&#125;</span> !-d</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteRule</span></span> ^.*$ /yourls-loader.php<span class="meta"> [L]</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br><span class="line"><span class="comment"># END YOURLS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 二级目录http://yoursite/somedir/</span></span><br><span class="line"><span class="comment"># BEGIN YOURLS</span></span><br><span class="line"><span class="section">&lt;IfModule mod_rewrite.c&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteEngine</span></span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">RewriteBase</span> /somedir/</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;REQUEST_FILENAME&#125;</span> !-f</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;REQUEST_FILENAME&#125;</span> !-d</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteRule</span></span> ^.*$ /somedir/yourls-loader.php<span class="meta"> [L]</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br><span class="line"><span class="comment"># END YOURLS</span></span><br></pre></td></tr></table></div></figure><ol start="2"><li>Nginx<br />请注意宝塔用户安照<span class="exturl"><a class="exturl__link"   href="https://github.com/YOURLS/YOURLS/wiki/Nginx-configuration" >文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>中的操作可能无效，可以更改为：</li></ol><figure class="highlight nginx"><figcaption><span>configuration</span></figcaption><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># HTTP over IPv4 &amp; IPv6</span></span><br><span class="line">  <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">  <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># HTTPS over IPv4 &amp; IPv6</span></span><br><span class="line">  <span class="comment"># MUST BE EDITED TO REFLECT YOUR CONFIGURATION</span></span><br><span class="line">  <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">  <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl;</span><br><span class="line">  <span class="attribute">ssl_certificate</span>     example.com.crt;</span><br><span class="line">  <span class="attribute">ssl_certificate_key</span> example.com.key;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Server names</span></span><br><span class="line">  <span class="comment"># MUST BE EDITED TO REFLECT YOUR CONFIGURATION</span></span><br><span class="line">  <span class="attribute">server_name</span> example.com www.example.com;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Root directory</span></span><br><span class="line">  <span class="comment"># MUST BE EDITED TO REFLECT YOUR CONFIGURATION</span></span><br><span class="line">  <span class="attribute">root</span> /path/to/yourls/files;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 更改部分在这里！！！</span></span><br><span class="line">  <span class="comment"># 更改部分在这里！！！</span></span><br><span class="line">  <span class="comment"># 更改部分在这里！！！</span></span><br><span class="line">  <span class="attribute">location</span> /  </span><br><span class="line">  &#123;  </span><br><span class="line">    <span class="attribute">if</span> (!-f $request_filename)&#123;</span><br><span class="line">      <span class="attribute">set</span> $rule_0 <span class="number">1</span>$rule_0;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">if</span> (!-d $request_filename)&#123;</span><br><span class="line">      <span class="attribute">set</span> $rule_0 <span class="number">2</span>$rule_0;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">if</span> ($rule_0 = <span class="string">&quot;21&quot;</span>)&#123;</span><br><span class="line">      <span class="attribute">rewrite</span><span class="regexp"> ^/.*$</span> /yourls-loader.php <span class="literal">last</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># PHP engine</span></span><br><span class="line">  <span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">    <span class="attribute">include</span> fastcgi.conf;</span><br><span class="line">    <span class="comment"># OR</span></span><br><span class="line">    <span class="comment"># include fastcgi_params;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># MUST BE EDITED TO REFLECT YOUR CONFIGURATION</span></span><br><span class="line">    <span class="attribute">fastcgi_pass</span> unix:/var/run/php/php7.2-fpm.sock;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="安装-2"   >          <a href="#安装-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#安装-2"></a> 安装</h4>      <p>  访问<code>http://domain.com/admin</code>完成初安装，输入配置文件设置的账号、密码登陆后台。如果安装出错，可能是PHP或者MySQL版本不符合要求，或者是数据库初始化失败，可以按照<a href="#refer-3">参考资料3</a>进行解决。</p>        <h2 id="短域名"   >          <a href="#短域名" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#短域名"></a> 短域名</h2>      <p>  短链接最重要的还是根域名要短，但是以<code>.com</code>、<code>.cn</code>、<code>.org</code>、<code>.top</code>、<code>.xyz</code>等常见一级域名的短域名基本已经抢注完成，剩下的价格也很昂贵。为了减小这个问题带来的影响，有两种解决方案。</p>        <h3 id="付费域名"   >          <a href="#付费域名" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#付费域名"></a> 付费域名</h3>      <p>  在我国的<code>.cn</code>域名下有一类特殊的二级域名：按照国家各个省级行政区划分的行政区划域名，例如<code>bj.cn</code>代表北京，<code>sh.cn</code>代表上海等。这些域名注册比较少，一些比较短的域名（例如<code>fox.hn.cn</code>，湖南）很有可能没有被注册，而且价格很便宜。目前<span class="exturl"><a class="exturl__link"   href="https://www.west.cn/" >西部数码</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="https://www.diymysite.com/" >域趣网络</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>等都提供这一类域名的注册。</p>        <h3 id="免费域名"   >          <a href="#免费域名" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#免费域名"></a> 免费域名</h3>      <p>  <span class="exturl"><a class="exturl__link"   href="https://www.freenom.com/" >Freenom</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>是国际著名的免费域名提供商，可以提供<code>.tk</code>（托克劳）、<code>.ml</code>（马里）、<code>.ga</code>（加蓬）、<code>.cf</code>（中非共和国）、<code>.gq</code>（赤道几内亚）等国家一级域名，除特殊域名（少于4个字母，特殊含义等）外均可免费获取。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/20210515005206.png"  alt="" />      <br />  在Freenom获取免费域名有几个需要注意的地方：</p><ol><li>需要科学上网</li><li>注册账号时，填写的地址信息一定要与科学上网后的IP地址保持一致，最好在美国!最好在美国!最好在美国!</li><li>点击上图的<code>现在获取</code>会显示不可用，此时你只需要在搜索框中输入<code>ffox.ga</code>就可以解决，自动帮你添加购物车<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/1621011489-1-.png"  alt="" />      <br />  更多的教程与介绍可以查看下面的视频。</li></ol><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;">    <iframe src="//player.bilibili.com/player.html?aid=80621564&bvid=BV1zJ411W7p3&cid=137972479&page=1&high_quality=1"  scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; left: 0; top: 0;"></iframe></div>        <h2 id="拓展与配置"   >          <a href="#拓展与配置" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#拓展与配置"></a> 拓展与配置</h2>      <p>  <code>Yourls</code>具有丰富的插件和主题，还有各种语言的翻译包，所有的插件都能在<span class="exturl"><a class="exturl__link"   href="https://github.com/YOURLS/awesome-yourls" >awesome-yourls</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>找到介绍与项目地址。下面介绍一些我使用的拓展。</p>        <h3 id="插件"   >          <a href="#插件" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#插件"></a> 插件</h3>      <ol><li><p>Allow Hyphens in Short URLs<br />  自带的插件，允许短链接中出现连字符</p></li><li><p>Random ShortURLs<br />  默认情况下，短链接按照顺序生成，从1开始，但是更好的方式是使用时间戳或随机字符串，这一个插件就可以随机生成短链接字符串，还可以设置字符串的长度。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/1621045278-1-.png"  alt="" />      </p></li><li><p>Cache stat pages<br />  后台查看统计报表的数据都是实时统计的，此插件可以将缓存统计报表，加快访问速度</p></li><li><p>YOURLS Static Titles<br />  当你输入一个长链接生成短链时，YOURLS会抓取长链接对应页面的标题信息，所以创建短链接的速度会受到页面访问速度的影响，此插件可以经过设置跳过抓取标题，加快生成速度。除了这一种方案以外，还可以根据<a href="#refer-4">参考资料4</a>进行配置。</p></li></ol>        <h3 id="翻译"   >          <a href="#翻译" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#翻译"></a> 翻译</h3>      <p>  下载<span class="exturl"><a class="exturl__link"   href="https://github.com/ZvonimirSun/YOURLS-zh_CN" >汉化包</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>中的<code>zh_CN.mo</code>文件，移动至<code>/user/languages</code>文件夹下，设置配置文件中的语言为<code>zh_CN</code>即可。</p>        <h3 id="主题"   >          <a href="#主题" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#主题"></a> 主题</h3>      <p>  目前官方页面的<span class="exturl"><a class="exturl__link"   href="https://github.com/YOURLS/awesome-yourls#themes-" >主题</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>只有3个，大家可以搜寻比较好看的。我使用的主题是<span class="exturl"><a class="exturl__link"   href="https://github.com/Flynntes/Sleeky" >Sleeky</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，不仅很好看而且还会添加前端首页。</p><ol><li>下载文件</li><li>移动<code>sleeky-frontend</code>文件夹到网站根目录下</li><li>配置<code>frontend/config.php</code></li><li>移动<code>sleeky-backend</code>文件夹至<code>user/plugins/</code>目录</li><li>在后台管理中<code>example.com/admin/plugins.php</code>启用插件<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/1621046193-1-.png"  alt="" />      </li></ol>        <h2 id="其他"   >          <a href="#其他" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#其他"></a> 其他</h2>      <p>  查看统计数据，可以在后台的管理界面中数据统计查看，也可以在短链接后面添加<code>+</code>查看，例如<code>https://ffox.ml/LL+</code>，包括访问量、地区和来源等。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/1621046295-1-.jpg"  alt="" />      <br />  最后欢迎大家来玩–&gt;<span class="exturl"><a class="exturl__link"   href="https://ffox.ml/" >FF的短链接生成器</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h2 id="参考资料"   >          <a href="#参考资料" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h2>      <p><span id="refer-1">1. <span class="exturl"><a class="exturl__link"   href="https://yourls.org/" >YOURLS: Your Own URL Shortener</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-2">2. <span class="exturl"><a class="exturl__link"   href="https://github.com/YOURLS/YOURLS/wiki" >YOURLS Wiki</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-3">3. <span class="exturl"><a class="exturl__link"   href="https://www.cnblogs.com/myIvan/p/10582849.html" >用yourls 搭建短链接地址服务</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-4">4. <span class="exturl"><a class="exturl__link"   href="https://blog.csdn.net/hfut_wowo/article/details/108734217" >关于yourls生成短链耗时太长问题解决</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-5">5. <span class="exturl"><a class="exturl__link"   href="https://hongcyu.cn/posts/hexo-bilibili.html" >HEXO博客引用B站视频并自动适配</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h2&gt;
      
&lt;p&gt;  你是否遇到过这样的场景？你有一个链接，例如&lt;code&gt;https://arxiv.org/abs/2104.14228&lt;/code&gt;，需要分享给朋友，这个链接长而且不好记忆，需要经常用到的时候也不方便，假设你需要发微博，由于字数限制，链接长度越短越好，这时候如果有一个链接&lt;code&gt;https://ffox.ml/grid02&lt;/code&gt;经过重定向可以指向前文的网址，那边就会很美观且方便，而这就需要用到短链接生成技术。&lt;/p&gt;</summary>
    
    
    
    <category term="软件/程序" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/"/>
    
    
    <category term="安装" scheme="https://foolishfox.cn/tags/%E5%AE%89%E8%A3%85/"/>
    
    <category term="Nginx" scheme="https://foolishfox.cn/tags/Nginx/"/>
    
    <category term="PHP" scheme="https://foolishfox.cn/tags/PHP/"/>
    
    <category term="域名" scheme="https://foolishfox.cn/tags/%E5%9F%9F%E5%90%8D/"/>
    
  </entry>
  
  <entry>
    <title>Python模拟锁相放大器的工作过程</title>
    <link href="https://foolishfox.cn/posts/202105-amplifier.html"/>
    <id>https://foolishfox.cn/posts/202105-amplifier.html</id>
    <published>2021-05-07T14:02:44.000Z</published>
    <updated>2021-05-19T16:33:25.752Z</updated>
    
    <content type="html"><![CDATA[<style>  .Note {    width: 100%;    height: 7200px;    border: medium none;  }</style><!-- <iframe src="https://lastknightcoder.gitee.io/jupyter-for-iframe/numpy%E5%85%A5%E9%97%A8.html" class="Note"></iframe> -->        <h2 id="准备"   >          <a href="#准备" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#准备"></a> 准备</h2>      <p>  本篇笔记将使用python演示锁相放大器的基本原理。<br />  首先引入需要用到的package，使用<code>%matplotlib widget</code>可以产生交互式的图片。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy.fftpack <span class="keyword">import</span> fft</span><br><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> signal <span class="keyword">as</span> sg</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">%matplotlib widget</span><br></pre></td></tr></table></div></figure><span id="more"></span>        <h3 id="绘图"   >          <a href="#绘图" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#绘图"></a> 绘图</h3>      <p>  在本文中将会产生许多的图片，为了方便绘图编写一个展示信号的绘图函数。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw</span>(<span class="params">x, y, title=<span class="string">&#x27;&#x27;</span>, xlable=<span class="string">&#x27;time(s)&#x27;</span>, ylable=<span class="string">&#x27;amplitude&#x27;</span>, L=-<span class="number">3.8</span>, H=<span class="number">3.8</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    draw</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        x : numpy array</span></span><br><span class="line"><span class="string">            abscissa</span></span><br><span class="line"><span class="string">        y : numpy array</span></span><br><span class="line"><span class="string">            ordinate</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># canvas settings</span></span><br><span class="line">    plt.close()</span><br><span class="line">    <span class="keyword">if</span> L!=H:</span><br><span class="line">        plt.ylim(L, H)</span><br><span class="line">    plt.title(title)</span><br><span class="line">    plt.xlabel(xlable)</span><br><span class="line">    plt.ylabel(ylable)</span><br><span class="line"></span><br><span class="line">    plt.plot(x, y)</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></div></figure>        <h3 id="正弦波"   >          <a href="#正弦波" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#正弦波"></a> 正弦波</h3>      <p>  在本实验中将采用正弦波作为输入信号。另外，参考信号、噪声信号等都需要用到正弦信号，所以第一步将编写一个产生给定幅度、频率和相位的正弦信号的函数。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g_sin</span>(<span class="params">t=<span class="number">1</span>, amp=<span class="number">1</span>, f0=<span class="number">10</span>, fs=<span class="number">500</span>, phi=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    generate sinusoid</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        t   : float</span></span><br><span class="line"><span class="string">            time length of the generated sequence</span></span><br><span class="line"><span class="string">        amp : float</span></span><br><span class="line"><span class="string">            amplitude</span></span><br><span class="line"><span class="string">        f0  : float</span></span><br><span class="line"><span class="string">            frequency of sinusoid in Hz</span></span><br><span class="line"><span class="string">        fs  : float</span></span><br><span class="line"><span class="string">            sampling rate per second</span></span><br><span class="line"><span class="string">        phi : float</span></span><br><span class="line"><span class="string">            initial phase in deg</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">        anonymous : list[numpy array, numpy array]</span></span><br><span class="line"><span class="string">            [abscissa, a sinusoid signal]</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    T = <span class="number">1</span>/fs</span><br><span class="line">    N = t/T</span><br><span class="line">    x = <span class="number">2</span>*np.pi*np.arange(N)*T</span><br><span class="line">    <span class="keyword">return</span> [np.arange(<span class="number">0</span>, t, T), amp*np.sin(f0*x+phi*np.pi/<span class="number">180</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x, y = g_sin()</span><br><span class="line">draw(x, y)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_1.png"  alt="" />      </p>        <h3 id="方波"   >          <a href="#方波" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#方波"></a> 方波</h3>      <p>  参考信号可以使用正弦波、方波等。在本实验中将使用方波，而方波的傅里叶级数为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>4</mn><mi>π</mi></mfrac><munderover><mo>∑</mo><mrow><mi>n</mi><mo>=</mo><mn>0</mn></mrow><mi mathvariant="normal">∞</mi></munderover><mfrac><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mn>2</mn><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><msub><mi>ω</mi><mi>r</mi></msub><mi>t</mi><mo stretchy="false">]</mo></mrow><mrow><mn>2</mn><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">f(x)=\frac{4}{\pi}\sum\limits_{n=0}^{\infty}\frac{sin[(2n+1)\omega_rt]}{2n+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.9185100000000004em;vertical-align:-1.267113em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">π</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∞</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mopen">[</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">t</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>  所以我们可以利用上面的正弦波函数，产生一个近似的方波，方波的阶数（即K）越大近似效果越好，K=50时就有很好的效果。  (PS：此处方波均指占空比为50%，正负对称的方波)</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g_square_wave</span>(<span class="params">t=<span class="number">1</span>, amp=<span class="number">1</span>, f0=<span class="number">10</span>, fs=<span class="number">500</span>, K=<span class="number">50</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    generate square wave</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        t   : float</span></span><br><span class="line"><span class="string">            time length of the generated sequence</span></span><br><span class="line"><span class="string">        amp : float</span></span><br><span class="line"><span class="string">            amplitude</span></span><br><span class="line"><span class="string">        f0  : float</span></span><br><span class="line"><span class="string">            frequency of sinusoid in Hz</span></span><br><span class="line"><span class="string">        fs  : float</span></span><br><span class="line"><span class="string">            sampling rate per second</span></span><br><span class="line"><span class="string">        K   : int</span></span><br><span class="line"><span class="string">            order of fourier series</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">        anonymous : list[numpy array, numpy array]</span></span><br><span class="line"><span class="string">            [abscissa, a square wave]</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    T = <span class="number">1</span>/fs</span><br><span class="line">    N = t/T</span><br><span class="line">    x = <span class="number">2</span>*np.pi*np.arange(N)*T</span><br><span class="line"></span><br><span class="line">    y = np.zeros(<span class="built_in">len</span>(x))</span><br><span class="line">    k = <span class="number">2</span>*np.arange(<span class="number">1</span>, K)-<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">        y[i] = amp*np.<span class="built_in">sum</span>(np.sin(k*f0*x[i])/k)</span><br><span class="line">    <span class="keyword">return</span> [np.arange(<span class="number">0</span>, t, T), <span class="number">4</span>*y/np.pi]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x, y = g_square_wave()</span><br><span class="line">draw(x, y)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_2.png"  alt="" />      </p><p>  使用上述两个函数，可以叠加产生带有噪声的信号。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x, y1 = g_sin(amp=<span class="number">0.2</span>, f0=<span class="number">30</span>)</span><br><span class="line">x, y2 = g_sin(amp=<span class="number">0.35</span>, f0=<span class="number">3</span>, phi=<span class="number">45</span>)</span><br><span class="line">x, y3 = g_square_wave(amp=<span class="number">0.1</span>, f0=<span class="number">10</span>)</span><br><span class="line">draw(x, y1+y2+y3)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_3.png"  alt="" />      </p>        <h3 id="频域分析"   >          <a href="#频域分析" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#频域分析"></a> 频域分析</h3>      <p>  这些噪声在时域中难以分辨。不过信号与噪声不同，往往具有明显的频率特征，而噪声一般是与频率无关的，或者是在特定频率范围内的，所以在频域内可以很好的分辨出输入信号的各种成分。<br />  使用快速傅里叶变换（FFT）从时域转化到频域，并且对振幅谱进行取半归一化。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">FFT</span>(<span class="params">s, fs</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    fast fourier transform</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        s  : numpy array</span></span><br><span class="line"><span class="string">            signal</span></span><br><span class="line"><span class="string">        fs : float</span></span><br><span class="line"><span class="string">            sampling rate per second</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    X  = fft(s)</span><br><span class="line">    mX = np.<span class="built_in">abs</span>(X)   <span class="comment"># magnitude</span></span><br><span class="line">    pX = np.angle(X) <span class="comment"># phase</span></span><br><span class="line"></span><br><span class="line">    draw(np.arange(<span class="built_in">int</span>(fs/<span class="number">2</span>)), mX[<span class="built_in">range</span>(<span class="built_in">int</span>(fs/<span class="number">2</span>))]/fs, </span><br><span class="line">         <span class="string">&#x27;Input signal in frequency domain&#x27;</span>, <span class="string">&#x27;frequency(Hz)&#x27;</span>, <span class="string">&#x27;amplitude&#x27;</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">FFT(y1+y2+y3, <span class="number">500</span>)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_4.png"  alt="" />      </p>        <h3 id="高斯白噪声"   >          <a href="#高斯白噪声" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#高斯白噪声"></a> 高斯白噪声</h3>      <p>  上面的信号添加的噪声还是正弦信号，而现实中比较常见的噪声是白噪声。下面的函数可以根据输入信号产生一个特定信噪比的白噪声。<br />  信噪比的定义是：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>N</mi><mi>R</mi><mo stretchy="false">(</mo><mi>d</mi><mi>B</mi><mo stretchy="false">)</mo><mo>=</mo><mn>10</mn><mi>l</mi><mi>g</mi><mfrac><msub><mi>P</mi><mrow><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub><msub><mi>P</mi><mrow><mi>n</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></msub></mfrac><mo>=</mo><mn>20</mn><mi>l</mi><mi>g</mi><mfrac><msub><mi>A</mi><mrow><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub><msub><mi>A</mi><mrow><mi>n</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">SNR(dB)=10lg\frac{P_{signal}}{P_{noise}}=20lg\frac{A_{signal}}{A_{noise}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.19633em;vertical-align:-0.8360000000000001em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.19633em;vertical-align:-0.8360000000000001em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>  在本实验中，功率<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span></span></span></span>可以用功<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi><mo>=</mo><mo>∫</mo><mi>P</mi><mi>d</mi><mi>t</mi><mo>=</mo><mi>C</mi><mo>∫</mo><msup><mi>A</mi><mn>2</mn></msup><mi>d</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">W=\int Pdt=C\int A^2dt</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.11112em;vertical-align:-0.30612em;"></span><span class="mop op-symbol small-op" style="margin-right:0.19445em;position:relative;top:-0.0005599999999999772em;">∫</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.120228em;vertical-align:-0.30612em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol small-op" style="margin-right:0.19445em;position:relative;top:-0.0005599999999999772em;">∫</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span></span></span></span>代替，因为信号和噪声的积分时间是相同的。而信号的波形是采样得到的，所以<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span></span></span></span>可以用<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∑</mo><msubsup><mi>x</mi><mi>i</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\sum x_i^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.072772em;vertical-align:-0.258664em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span>代替，于是有：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>N</mi><mi>R</mi><mo>=</mo><mn>10</mn><mi>l</mi><mi>g</mi><mfrac><mrow><mo>∑</mo><msubsup><mi>s</mi><mi>i</mi><mn>2</mn></msubsup></mrow><mrow><mo>∑</mo><msubsup><mi>n</mi><mi>i</mi><mn>2</mn></msubsup></mrow></mfrac><mo>⟹</mo><mo>∑</mo><msubsup><mi>n</mi><mi>i</mi><mn>2</mn></msubsup><mo>=</mo><mfrac><mrow><mo>∑</mo><msubsup><mi>s</mi><mi>i</mi><mn>2</mn></msubsup></mrow><mrow><mn>1</mn><msup><mn>0</mn><mrow><mi>S</mi><mi>N</mi><mi>R</mi><mi mathvariant="normal">/</mi><mn>10</mn></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">SNR=10lg\frac{\sum s_i^2}{\sum n_i^2} \Longrightarrow \sum n_i^2= \frac{\sum s_i^2}{10^{SNR/10}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.4539720000000003em;vertical-align:-0.9628639999999999em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959080000000001em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.27686399999999994em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9628639999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.6000100000000002em;vertical-align:-0.55001em;"></span><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.1951080000000003em;vertical-align:-0.704em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.2960000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mord mtight">/</span><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.704em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wgn</span>(<span class="params">x, snr</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    generate Gauss white noise</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        x   : numpy array</span></span><br><span class="line"><span class="string">            signal</span></span><br><span class="line"><span class="string">        snr : float</span></span><br><span class="line"><span class="string">            signal-to-noise ratio</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">        anonymous : numpy array</span></span><br><span class="line"><span class="string">            Gauss white noise</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    snr    = <span class="number">10</span>**(snr/<span class="number">10.0</span>)</span><br><span class="line">    xpower = np.<span class="built_in">sum</span>(x**<span class="number">2</span>)/<span class="built_in">len</span>(x)</span><br><span class="line">    npower = xpower / snr</span><br><span class="line">    <span class="keyword">return</span> np.random.randn(<span class="built_in">len</span>(x)) * np.sqrt(npower)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">noise = wgn(np.sin(np.arange(<span class="number">0</span>, <span class="number">1000000</span>)*<span class="number">0.1</span>), <span class="number">6</span>)</span><br><span class="line">plt.close()</span><br><span class="line">plt.subplot(<span class="number">211</span>)</span><br><span class="line">plt.hist(noise, bins=<span class="number">100</span>)</span><br><span class="line">plt.subplot(<span class="number">212</span>)</span><br><span class="line">plt.psd(noise)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_5.png"  alt="" />      </p>        <h2 id="模拟"   >          <a href="#模拟" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#模拟"></a> 模拟</h2>      <p>  下面开始正式的模拟过程：</p><ol><li>获得输入信号，输入信号由10Hz的目标信号和其他频率的正弦噪声以及白噪声组成</li></ol><p>  A. 增加正弦部分</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x, y1  = g_sin(amp=<span class="number">0.1</span>)</span><br><span class="line">x, y2  = g_sin(amp=<span class="number">0.5</span>, f0=<span class="number">50</span>)</span><br><span class="line">x, y3  = g_sin(amp=<span class="number">0.8</span>, f0=<span class="number">3</span>)</span><br><span class="line">x, y4  = g_sin(amp=<span class="number">0.3</span>, f0=<span class="number">200</span>)</span><br><span class="line">signal = y1+y2+y3+y4</span><br></pre></td></tr></table></div></figure><p>  B. 增加白噪声部分</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">noise = wgn(signal, <span class="number">10</span>)</span><br><span class="line">sn    = signal+noise</span><br><span class="line">draw(x, sn)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_6.png"  alt="" />      <br />  C. 查看输入信号的频域信息</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FFT(sn, <span class="number">500</span>)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_7.png"  alt="" />      </p><ol start="2"><li>获得参考信号，方波频率与目标信号相同，为10Hz</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x, y   = g_square_wave(K=<span class="number">100</span>)</span><br><span class="line">square = y</span><br><span class="line">draw(x, square)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_8.png"  alt="" />      </p><ol start="3"><li>前置放大×2倍</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sn = sn*<span class="number">2</span></span><br><span class="line">draw(x, sn)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_9.png"  alt="" />      </p><ol start="4"><li>输入信号进行带通滤波，除去/抑制部分噪声，增强锁相放大器的性能（动态储备和输出动态范围）</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b, a = sg.butter(<span class="number">1</span>, [<span class="number">0.02</span>, <span class="number">0.12</span>], <span class="string">&#x27;bandpass&#x27;</span>) <span class="comment"># 5Hz - 30Hz</span></span><br><span class="line">snq  = sg.filtfilt(b, a, sn)</span><br><span class="line">draw(x, snq)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_10.png"  alt="" />      </p><ol start="5"><li>调谐放大输入信号×5，增大信噪比</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b, a = sg.butter(<span class="number">1</span>, [<span class="number">0.038</span>, <span class="number">0.042</span>], <span class="string">&#x27;bandpass&#x27;</span>) <span class="comment"># 9.5Hz - 10.5Hz</span></span><br><span class="line">sns  = sg.filtfilt(b, a, snq)</span><br><span class="line">snq  = sns*<span class="number">4</span>+snq</span><br><span class="line">draw(x, snq)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_11.png"  alt="" />      </p><ol start="6"><li>PSD（相敏检波器）处理输入与参考信号（本质为乘法器）</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">snqx = snq*square</span><br><span class="line">draw(x, snqx)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_12.png"  alt="" />      </p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FFT(snqx, <span class="number">500</span>)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_13.png"  alt="" />      </p><ol start="7"><li>低通滤波，减少其他信号对直流分量的影响（等效噪声宽度很小）</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b, a = sg.butter(<span class="number">3</span>, <span class="number">0.00004</span>, <span class="string">&#x27;lowpass&#x27;</span>) <span class="comment"># 0 - 0.01Hz</span></span><br><span class="line">sns  = sg.filtfilt(b, a, snqx)</span><br><span class="line">draw(x, sns)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_14.png"  alt="" />      </p><ol start="8"><li>直流放大×5</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sns = sns*<span class="number">5</span></span><br><span class="line">draw(x, sns)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/05/amplifier_15.png"  alt="" />      </p>]]></content>
    
    
    <summary type="html">&lt;style&gt;
  .Note {
    width: 100%;
    height: 7200px;
    border: medium none;
  }
&lt;/style&gt;
&lt;!-- &lt;iframe src=&quot;https://lastknightcoder.gitee.io/jupyter-for-iframe/numpy%E5%85%A5%E9%97%A8.html&quot; class=&quot;Note&quot;&gt;&lt;/iframe&gt; --&gt;

        &lt;h2 id=&quot;准备&quot;   &gt;
          &lt;a href=&quot;#准备&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#准备&quot;&gt;&lt;/a&gt; 准备&lt;/h2&gt;
      
&lt;p&gt;  本篇笔记将使用python演示锁相放大器的基本原理。&lt;br /&gt;
  首先引入需要用到的package，使用&lt;code&gt;%matplotlib widget&lt;/code&gt;可以产生交互式的图片。&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;div class=&quot;table-container&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; numpy &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; np&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; scipy.fftpack &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; fft&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; scipy &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; signal &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; sg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; matplotlib &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; pyplot &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; plt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;%matplotlib widget&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="学习" scheme="https://foolishfox.cn/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Python" scheme="https://foolishfox.cn/tags/Python/"/>
    
    <category term="信号处理" scheme="https://foolishfox.cn/tags/%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
</feed>
