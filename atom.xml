<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Fox Home</title>
  
  <subtitle>清疚</subtitle>
  <link href="https://foolishfox.cn/atom.xml" rel="self"/>
  
  <link href="https://foolishfox.cn/"/>
  <updated>2021-04-12T12:58:40.647Z</updated>
  <id>https://foolishfox.cn/</id>
  
  <author>
    <name>liuyihui</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>宝塔Nginx反向代理导致css/js/png等重定向过多</title>
    <link href="https://foolishfox.cn/posts/202104-redirect.html"/>
    <id>https://foolishfox.cn/posts/202104-redirect.html</id>
    <published>2021-04-11T01:48:38.000Z</published>
    <updated>2021-04-12T12:58:40.647Z</updated>
    
    <content type="html"><![CDATA[        <h1 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>      <p>  在之前的文章<a href="/posts/move.html">博客服务器迁移过程</a>中介绍了<code>footprint</code>打造旅行地图，然后使用Nginx反向代理，将<code>ff.cn/travel</code>指向<code>127.0.0.1:886</code>，原本访问一切正常，但是昨天碰到了一个新的问题：css/js/png等文件请求301重定向过多，花了蛮久才解决问题，所以记下来提醒自己。</p><span id="more"></span>        <h1 id="复现"   >          <a href="#复现" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#复现"></a> 复现</h1>      <p>  在网站<code>/travel/</code>目录下创建<code>hello.js</code>文件，请求<code>ff.cn/travel/hello.js</code>，显示<code>ff.cn 将您重定向的次数过多</code>。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/04/20210412203604.png"  alt="" />      <br />  在开发者模式下查看网络请求，发现服务器将<code>ff.cn/travel/hello.js</code>重定向给自身，导致出现死循环。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/04/20210412203648.png"  alt="" />      </p>        <h1 id="解决"   >          <a href="#解决" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#解决"></a> 解决</h1>      <ol><li>浏览器提示清除cookie：</li></ol><blockquote><p>当相应网页尝试对您进行重定向的次数过多时，您就会看到这条错误消息。<br />有时，网页打不开是因为 Cookie 出问题了。要修正该错误，请尝试清除 Cookie。</p></blockquote>    <div class="note-plugin danger">      <span class="note-plugin__icon note-plugin__icon--danger">              <i class="fas fa-minus-circle"></i>            </span>      <p>无作用</p>    </div>  <ol start="2"><li>刷新DNS/更换DNS<br />  重定向过多可能发生了DNS劫持，可以刷新DNS或者换一个DNS地址。</li></ol>    <div class="note-plugin danger">      <span class="note-plugin__icon note-plugin__icon--danger">              <i class="fas fa-minus-circle"></i>            </span>      <p>无作用</p>    </div>  <ol start="3"><li>SSL证书问题<br />  如果开启了强制访问HTTPS或者SSL证书更换，可能导致前后端接口不一致，陷入反复跳转，造成重定向过多，可以重置SSL证书或者重启强制访问HTTPS。</li></ol>    <div class="note-plugin danger">      <span class="note-plugin__icon note-plugin__icon--danger">              <i class="fas fa-minus-circle"></i>            </span>      <p>无作用</p>    </div>          <h1 id="分析"   >          <a href="#分析" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#分析"></a> 分析</h1>      <p>  查看Nginx日志，发现浏览器发出请求<code>ff.cn/travel/hello.js</code>时，本应该转给<code>127.0.0.1:886/hello.js</code>，然而日志中显示回应请求的链接是<code>127.0.0.1:80/travel/hello.js</code>，怀疑是代理设置出现问题。<br />  查看<code>ff.cn</code>的配置文件如下：</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">  listen 443 ssl http2;</span><br><span class="line">    server_name ff.cn;</span><br><span class="line">    index index.php index.html index.htm default.php default.htm default.html;</span><br><span class="line">    root &#x2F;ff.cn;</span><br><span class="line">    </span><br><span class="line">    #SSL-START SSL相关配置，请勿删除或修改下一行带注释的404规则</span><br><span class="line">    #error_page 404&#x2F;404.html;</span><br><span class="line">    #HTTP_TO_HTTPS_START</span><br><span class="line">    if ($server_port !~ 443)&#123;</span><br><span class="line">        rewrite ^(&#x2F;.*)$ https:&#x2F;&#x2F;$host$1 permanent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #SSL-END</span><br><span class="line">    </span><br><span class="line">    #ERROR-PAGE-START  错误页配置，可以注释、删除或修改</span><br><span class="line">    #error_page 404 &#x2F;404.html;</span><br><span class="line">    #error_page 502 &#x2F;502.html;</span><br><span class="line">    #ERROR-PAGE-END</span><br><span class="line">    </span><br><span class="line">    #PHP-INFO-START  PHP引用配置，可以注释或修改</span><br><span class="line">    #清理缓存规则</span><br><span class="line"></span><br><span class="line">    location ~ &#x2F;purge(&#x2F;.*) &#123;</span><br><span class="line">        proxy_cache_purge cache_one $host$1$is_args$args;</span><br><span class="line">        #access_log  &#x2F;www&#x2F;wwwlogs&#x2F;ff.cn_purge_cache.log;</span><br><span class="line">    &#125;</span><br><span class="line">    #引用反向代理规则，注释后配置的反向代理将无效</span><br><span class="line">    include &#x2F;www&#x2F;server&#x2F;panel&#x2F;vhost&#x2F;nginx&#x2F;proxy&#x2F;ff.cn&#x2F;*.conf;</span><br><span class="line"></span><br><span class="line">    include enable-php-00.conf;</span><br><span class="line">    #PHP-INFO-END</span><br><span class="line">    </span><br><span class="line">    #REWRITE-START URL重写规则引用,修改后将导致面板设置的伪静态规则失效</span><br><span class="line">    include &#x2F;www&#x2F;server&#x2F;panel&#x2F;vhost&#x2F;rewrite&#x2F;ff.cn.conf;</span><br><span class="line">    #REWRITE-END</span><br><span class="line">    </span><br><span class="line">    #禁止访问的文件或目录</span><br><span class="line">    location ~ ^&#x2F;(\.user.ini|\.htaccess|\.git|\.svn|\.project|LICENSE|README.md)</span><br><span class="line">    &#123;</span><br><span class="line">        return 404;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    #一键申请SSL证书验证目录相关设置</span><br><span class="line">    location ~ \.well-known&#123;</span><br><span class="line">        allow all;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    access_log  &#x2F;www&#x2F;wwwlogs&#x2F;ff.cn.log;</span><br><span class="line">    error_log  &#x2F;www&#x2F;wwwlogs&#x2F;ff.cn.error.log;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#PROXY-START&#x2F;travel&#x2F;</span><br><span class="line">location  ~* \.(php|jsp|js|css|png|cgi|asp|aspx)$</span><br><span class="line">&#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">&#125;</span><br><span class="line">location &#x2F;travel&#x2F;</span><br><span class="line">&#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1:886&#x2F;;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">    </span><br><span class="line">    add_header X-Cache $upstream_cache_status;</span><br><span class="line">    </span><br><span class="line">    #Set Nginx Cache</span><br><span class="line">    add_header Cache-Control no-cache;</span><br><span class="line">&#125;</span><br><span class="line">#PROXY-END&#x2F;travel&#x2F;</span><br></pre></td></tr></table></div></figure><p>  可以发现，问题出现在了代理配置中的<code>location ~* \.(php|jsp|js|css|png|cgi|asp|aspx)$</code>这一块。当接受到<code>ff.cn/travel/hello.js</code>请求时，根据代理配置进行转发，js/css/png等文件匹配上了第一条规则，于是请求被发往<code>127.0.0.1:80/travel/hello.js</code>，也就刚好是<code>ff.cn/travel/hello.js</code>自身，造成了死循环。将这一片段或者<code>js|css|png</code>删除即可解决</p>        <h1 id="后记"   >          <a href="#后记" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#后记"></a> 后记</h1>      <p>  宝塔确实有点诡异，上一秒还好好访问的，结果突然就重定向了。以后碰到问题多看日志，更容易发现问题所在的地方。</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h1&gt;
      
&lt;p&gt;  在之前的文章&lt;a href=&quot;/posts/move.html&quot;&gt;博客服务器迁移过程&lt;/a&gt;中介绍了&lt;code&gt;footprint&lt;/code&gt;打造旅行地图，然后使用Nginx反向代理，将&lt;code&gt;ff.cn/travel&lt;/code&gt;指向&lt;code&gt;127.0.0.1:886&lt;/code&gt;，原本访问一切正常，但是昨天碰到了一个新的问题：css/js/png等文件请求301重定向过多，花了蛮久才解决问题，所以记下来提醒自己。&lt;/p&gt;</summary>
    
    
    
    <category term="博客" scheme="https://foolishfox.cn/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    
    <category term="Nginx" scheme="https://foolishfox.cn/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>使用Echarts绘制名侦探柯南人物关系图</title>
    <link href="https://foolishfox.cn/posts/202104-conan.html"/>
    <id>https://foolishfox.cn/posts/202104-conan.html</id>
    <published>2021-04-09T04:24:55.000Z</published>
    <updated>2021-04-11T01:54:50.620Z</updated>
    
    <content type="html"><![CDATA[        <h1 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>      <p>  《名侦探柯南绯色的子弹》就要上映了，npy想要和我一起去看，但是她又搞不懂人物关系，所以就用<code>Echarts</code>做一个柯南的人物关系表了解一下。<br />  <code>ECharts</code>是使用<code>JavaScript</code>实现的开源可视化库，可以做出很多精巧的图片，最初由百度团队开源，后于2018年初捐赠给Apache基金会，成为ASF孵化级项目。</p><span id="more"></span>        <h1 id="步骤"   >          <a href="#步骤" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#步骤"></a> 步骤</h1>      <ol><li>引入<code>jquery</code>和<code>echarts</code>的js文件</li></ol><figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/echarts/5.0.2/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></div></figure><ol start="2"><li>获取<span class="exturl"><a class="exturl__link"   href="https://cdn.jsdelivr.net/gh/YiHui-Liu/Fox-Home-CDN/Detective-Conan.json" >人物关系json文件</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br />  json文件中主要分为3部分，分别是<code>nodes</code>表示人物，<code>links</code>表示关系连接，<code>categories</code>表示阵营/类别。</li></ol><ul><li>nodes</li></ul><figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 必填，二选一</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;0&quot;</span>,   <span class="comment">// 人物id</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;柯南&quot;</span>,   <span class="comment">// 人物名称</span></span><br><span class="line">    <span class="comment">// 选填</span></span><br><span class="line">    <span class="attr">&quot;symbolSize&quot;</span>: <span class="number">50</span>,   <span class="comment">// 点的大小</span></span><br><span class="line">    <span class="attr">&quot;value&quot;</span>: <span class="number">100</span>,   <span class="comment">// 力引导布局(force)中连线长度</span></span><br><span class="line">    <span class="attr">&quot;category&quot;</span>: <span class="number">0</span>,   <span class="comment">// 人物类别</span></span><br><span class="line">    <span class="attr">&quot;itemStyle&quot;</span>: &#123;   <span class="comment">// 自定义样式</span></span><br><span class="line">        <span class="attr">&quot;normal&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;color&quot;</span>: <span class="string">&quot;blue&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ul><li>links</li></ul><figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 必填</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span>: <span class="string">&quot;1&quot;</span>,   <span class="comment">// 源节点名称或者id</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;0&quot;</span>,   <span class="comment">// 目标节点名称或者id</span></span><br><span class="line">    <span class="comment">// 选填</span></span><br><span class="line">    <span class="attr">&quot;value&quot;</span>: <span class="number">100</span>,   <span class="comment">// 力引导布局(force)中连线长度</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;伙伴&quot;</span>   <span class="comment">// 关系名称</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ul><li>categories</li></ul><figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 必填</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;黑衣组织&quot;</span>,   <span class="comment">// 类别名称</span></span><br><span class="line">    <span class="comment">// 选填</span></span><br><span class="line">    <span class="attr">&quot;symbol&quot;</span>: <span class="string">&quot;circle&quot;</span>,   <span class="comment">// 类目节点标记的图形</span></span><br><span class="line">    <span class="attr">&quot;symbolSize&quot;</span>: <span class="number">10</span>,   <span class="comment">// 类目节点的默认大小</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ol start="3"><li>配置前端</li></ol><figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;conan_container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></div></figure><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> conan = echarts.init(<span class="built_in">document</span>.getElementById(<span class="string">&quot;conan_container&quot;</span>));</span><br><span class="line">    <span class="keyword">var</span> option;</span><br><span class="line">    conan.showLoading();</span><br><span class="line">    $.getJSON(<span class="string">&#x27;https://cdn.jsdelivr.net/gh/YiHui-Liu/Fox-Home-CDN/Detective-Conan.json&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">graph</span>) </span>&#123;</span><br><span class="line">        conan.hideLoading();</span><br><span class="line">        option = &#123;</span><br><span class="line">            <span class="comment">// 图表标题与位置</span></span><br><span class="line">            title: &#123;</span><br><span class="line">                text: <span class="string">&#x27;Detective Conan&#x27;</span>,</span><br><span class="line">                top: <span class="string">&#x27;bottom&#x27;</span>,</span><br><span class="line">                left: <span class="string">&#x27;right&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            tooltip: &#123;&#125;,</span><br><span class="line">            legend: [&#123;</span><br><span class="line">                <span class="comment">// selectedMode: &#x27;single&#x27;,</span></span><br><span class="line">                data: graph.categories.map(<span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> a.name;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;],</span><br><span class="line">            animationDuration: <span class="number">1500</span>,</span><br><span class="line">            animationEasingUpdate: <span class="string">&#x27;quinticInOut&#x27;</span>,</span><br><span class="line">            series: [</span><br><span class="line">                &#123;</span><br><span class="line">                    name: <span class="string">&#x27;Detective Conan&#x27;</span>,</span><br><span class="line">                    type: <span class="string">&#x27;graph&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 布局，none使用节点中提供的x、y作为节点的位置；circular采用环形布局；force采用力引导布局</span></span><br><span class="line">                    layout: <span class="string">&#x27;circular&#x27;</span>,</span><br><span class="line">                    data: graph.nodes,</span><br><span class="line">                    links: graph.links,</span><br><span class="line">                    categories: graph.categories,</span><br><span class="line">                    symbolSize: <span class="number">15</span>,</span><br><span class="line">                    value: <span class="number">30</span>,</span><br><span class="line">                    roam: <span class="literal">true</span>,</span><br><span class="line">                    label: &#123;</span><br><span class="line">                        show: <span class="literal">true</span>,</span><br><span class="line">                        position: <span class="string">&#x27;right&#x27;</span>,</span><br><span class="line">                        formatter: <span class="string">&#x27;&#123;b&#125;&#x27;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    labelLayout: &#123;</span><br><span class="line">                        hideOverlap: <span class="literal">true</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    lineStyle: &#123;</span><br><span class="line">                        color: <span class="string">&#x27;source&#x27;</span>,</span><br><span class="line">                        curveness: <span class="number">0.3</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 突出显示有连接的人物</span></span><br><span class="line">                    emphasis: &#123;</span><br><span class="line">                        focus: <span class="string">&#x27;adjacency&#x27;</span>,</span><br><span class="line">                        lineStyle: &#123;</span><br><span class="line">                            width: <span class="number">10</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 缩放限制</span></span><br><span class="line">                    scaleLimit: &#123;</span><br><span class="line">                        min: <span class="number">0.6</span>,</span><br><span class="line">                        max: <span class="number">3</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 显示links的名称</span></span><br><span class="line">                    <span class="comment">// edgeSymbolSize: [4, 10],</span></span><br><span class="line">                    <span class="comment">// edgeLabel: &#123;</span></span><br><span class="line">                    <span class="comment">//     show: true,</span></span><br><span class="line">                    <span class="comment">//     formatter: function (x) &#123;</span></span><br><span class="line">                    <span class="comment">//         return x.data.name;</span></span><br><span class="line">                    <span class="comment">//     &#125;,</span></span><br><span class="line">                    <span class="comment">//     textStyle: &#123;</span></span><br><span class="line">                    <span class="comment">//         fontSize: 20</span></span><br><span class="line">                    <span class="comment">//     &#125;</span></span><br><span class="line">                    <span class="comment">// &#125;,</span></span><br><span class="line">                    <span class="comment">// 力引导布局的设置</span></span><br><span class="line">                    <span class="comment">// force: &#123;</span></span><br><span class="line">                    <span class="comment">//     repulsion: 2500,</span></span><br><span class="line">                    <span class="comment">//     edgeLength: [10, 50]</span></span><br><span class="line">                    <span class="comment">// &#125;,</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;;</span><br><span class="line">        conan.setOption(option);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (option &amp;&amp; <span class="keyword">typeof</span> option === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">        conan.setOption(option);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>        <h1 id="效果展示"   >          <a href="#效果展示" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#效果展示"></a> 效果展示</h1>      <script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script><script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/echarts/5.0.2/echarts.min.js"></script><div id="conan_container" style="max-width: 900px;height: 600px;"></div><script type="text/javascript">    var conan = echarts.init(document.getElementById("conan_container"));    var option;    conan.showLoading();    $.getJSON('https://cdn.jsdelivr.net/gh/YiHui-Liu/Fox-Home-CDN/Detective-Conan.json', function (graph) {        conan.hideLoading();        option = {            title: {                text: 'Detective Conan',                top: 'bottom',                left: 'right'            },            tooltip: {                formatter: function (x) {                    return x.data.des;                }            },            legend: [{                // selectedMode: 'single',                data: graph.categories.map(function (a) {                    return a.name;                })            }],            animationDuration: 1500,            animationEasingUpdate: 'quinticInOut',            series: [                {                    name: 'Detective Conan',                    type: 'graph',                    layout: 'circular',                    data: graph.nodes,                    links: graph.links,                    categories: graph.categories,                    symbolSize: 15,                    value: 30,                    roam: true,                    label: {                        show: true,                        position: 'right',                        formatter: '{b}'                    },                    labelLayout: {                        hideOverlap: true                    },                    lineStyle: {                        color: 'source',                        curveness: 0.3                    },                    emphasis: {                        focus: 'adjacency',                        lineStyle: {                            width: 10                        }                    },                    scaleLimit: {                        min: 0.6,                        max: 3                    }                }            ]        };        conan.setOption(option);    });    if (option && typeof option === 'object') {        conan.setOption(option);    }</script>        <h1 id="参考资料"   >          <a href="#参考资料" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h1>      <ol><li><span class="exturl"><a class="exturl__link"   href="https://blog.csdn.net/weixin_38409915/article/details/114369054" >人物关系图谱:ECharts 实现</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link"   href="https://echarts.apache.org/examples/zh/index.html" >Echarts文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link"   href="https://echarts.apache.org/zh/option.html" >Echarts示例</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h1&gt;
      
&lt;p&gt;  《名侦探柯南绯色的子弹》就要上映了，npy想要和我一起去看，但是她又搞不懂人物关系，所以就用&lt;code&gt;Echarts&lt;/code&gt;做一个柯南的人物关系表了解一下。&lt;br /&gt;
  &lt;code&gt;ECharts&lt;/code&gt;是使用&lt;code&gt;JavaScript&lt;/code&gt;实现的开源可视化库，可以做出很多精巧的图片，最初由百度团队开源，后于2018年初捐赠给Apache基金会，成为ASF孵化级项目。&lt;/p&gt;</summary>
    
    
    
    <category term="Javascript" scheme="https://foolishfox.cn/categories/Javascript/"/>
    
    
    <category term="Echarts" scheme="https://foolishfox.cn/tags/Echarts/"/>
    
    <category term="名侦探柯南" scheme="https://foolishfox.cn/tags/%E5%90%8D%E4%BE%A6%E6%8E%A2%E6%9F%AF%E5%8D%97/"/>
    
  </entry>
  
  <entry>
    <title>博客评论系统——Waline</title>
    <link href="https://foolishfox.cn/posts/202104-waline.html"/>
    <id>https://foolishfox.cn/posts/202104-waline.html</id>
    <published>2021-04-07T14:21:46.000Z</published>
    <updated>2021-04-11T01:54:04.643Z</updated>
    
    <content type="html"><![CDATA[        <h1 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>      <p>  <span class="exturl"><a class="exturl__link"   href="https://waline.js.org/" >waline</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>是由<span class="exturl"><a class="exturl__link"   href="https://github.com/lizheming" >lizheming</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>开发的博客评论系统，从<span class="exturl"><a class="exturl__link"   href="https://valine.js.org/" >Valine</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>衍生的带后端评论系统。可以将<code>Waline</code>等价成<code>With backend Valine</code>。<br />  Waline的服务端可以部署在<span class="exturl"><a class="exturl__link"   href="https://vercel.com/" >Vercel</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="https://www.cloudbase.net" >CloudBase</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>或者服务器上，数据库可以使用<span class="exturl"><a class="exturl__link"   href="https://www.leancloud.cn/" >LeanCloud</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、MySQL等，总计有多达48钟部署方式。在官方教程中，使用云服务部署都介绍的比较详细，下面介绍两种本地部署方式，可以自定义端口，配合多种数据库使用。</p><span id="more"></span>        <h1 id="docker"   >          <a href="#docker" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#docker"></a> Docker</h1>      <p>  在Docker容器内运行<code>vanilla.js</code>文件。</p><ol><li>修改<code>Node.js</code>淘宝源</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单次使用</span></span><br><span class="line">npm install module_name --registry=https://registry.npm.taobao.org</span><br><span class="line"><span class="comment"># 永久修改</span></span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br><span class="line"><span class="comment"># 使用cnpm，安装了cnpm之后，npm install 都可以换成cnpm install</span></span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></div></figure><ol start="2"><li>构建镜像</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/lizheming/waline.git</span><br><span class="line"><span class="built_in">cd</span> waline</span><br><span class="line">docker build -t image_name -f packages/server/Dockerfile .</span><br></pre></td></tr></table></div></figure><ol start="3"><li>修改配置<code>packages/client/.env</code>，参考文档中所需环境变量配置即可</li></ol><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">SKIP_PREFLIGHT_CHECK&#x3D;true</span><br><span class="line"></span><br><span class="line"># 数据库配置，参考https:&#x2F;&#x2F;waline.js.org&#x2F;server&#x2F;databases.html</span><br><span class="line">MYSQL_HOST&#x3D;127.0.0.1</span><br><span class="line">MYSQL_DB&#x3D;db_name</span><br><span class="line">MYSQL_USER&#x3D;db_user</span><br><span class="line">MYSQL_PASSWORD&#x3D;password</span><br><span class="line"></span><br><span class="line">AKISMET_KEY&#x3D;guess</span><br><span class="line"></span><br><span class="line">SITE_NAME&#x3D;Fox Home</span><br><span class="line">SITE_URL&#x3D;https:&#x2F;&#x2F;foolishfox.cn</span><br><span class="line">AUTHOR_EMAIL&#x3D;fox@foolishfox.cn</span><br><span class="line"></span><br><span class="line">SC_KEY&#x3D;SCK232027Td54bfab83cfabf0aereq2c31b6552cd35fe1a43720074</span><br><span class="line"></span><br><span class="line">SMTP_HOST&#x3D;smtp.ym.163.com</span><br><span class="line">SMTP_PORT&#x3D;465</span><br><span class="line">SMTP_USER&#x3D;fox@foolishfox.cn</span><br><span class="line">SMTP_PASS&#x3D;password</span><br><span class="line">SENDER_NAME&#x3D;fox</span><br><span class="line">SENDER_EMAIL&#x3D;fox@foolishfox.cn</span><br></pre></td></tr></table></div></figure><ol start="4"><li>运行镜像</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --env-file ./packages/client/.env -p 8360:8360 -d image_name</span><br></pre></td></tr></table></div></figure><ol start="5"><li>设置反向目录代理，将<code>api.foolishfox.cn/waline</code>指向<code>127.0.0.1:8360</code></li><li>进入容器</li></ol><figure class="highlight sh"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看容器id</span></span><br><span class="line">root@iZ2ze8k2vy63cz277rsw8zZ:$ docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE              COMMAND                  CREATED          STATUS          PORTS                    NAMES</span><br><span class="line">cebd15a83483   lizheming/waline   <span class="string">&quot;docker-entrypoint.s…&quot;</span>   44 seconds ago   Up 42 seconds   0.0.0.0:8360-&gt;8360/tcp   admiring_noether</span><br><span class="line"><span class="comment"># 进入容器</span></span><br><span class="line">root@iZ2ze8k2vy63cz277rsw8zZ:$ docker <span class="built_in">exec</span> -it cebd15a83483 /bin/bash</span><br></pre></td></tr></table></div></figure><ol start="7"><li>安装<code>vim</code>（可跳过）与验证组件</li></ol><figure class="highlight sh"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install vim</span><br><span class="line">apt install apt-transport-https ca-certificates</span><br></pre></td></tr></table></div></figure><ol start="8"><li>更新软件源（使用<span class="exturl"><a class="exturl__link"   href="https://mirrors.tuna.tsinghua.edu.cn/help/debian/" >清华源</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>）</li></ol><figure class="highlight sh"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份</span></span><br><span class="line">mv /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line"><span class="comment"># vim修改</span></span><br><span class="line">vim /etc/apt/sources.list</span><br><span class="line"><span class="comment"># echo修改</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free&quot;</span> &gt;/etc/apt/sources.list</span><br><span class="line"><span class="comment"># 更新</span></span><br><span class="line">apt update</span><br><span class="line">...</span><br></pre></td></tr></table></div></figure><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster main contrib non-free</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster main contrib non-free</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster-updates main contrib non-free</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster-updates main contrib non-free</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster-backports main contrib non-free</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster-backports main contrib non-free</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian-security buster&#x2F;updates main contrib non-free</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian-security buster&#x2F;updates main contrib non-free</span><br></pre></td></tr></table></div></figure><ol start="9"><li>配置<code>config.js</code>，路径为：<code>node_modules/@waline/vercel/config.js</code>，参考<span class="exturl"><a class="exturl__link"   href="https://waline.js.org/server/basic.html#%E4%BB%A3%E7%A0%81%E9%85%8D%E7%BD%AE" >服务端配置</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    secureDomains: [</span><br><span class="line">        <span class="string">&#x27;foolishfox.cn&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;api.foolishfox.cn&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    forbiddenWords: [</span><br><span class="line">        <span class="string">&#x27;空包&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;快递&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;下单&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    disallowIPList: [</span><br><span class="line">        <span class="string">&#x27;8.8.8.8&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><ol start="10"><li>修改主程序<code>vanilla.js</code>，导入自定义配置</li></ol><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> Application = <span class="built_in">require</span>(<span class="string">&#x27;thinkjs&#x27;</span>);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">let</span> config = &#123;&#125;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    config = <span class="built_in">require</span>(<span class="string">&#x27;./config.js&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(e) &#123;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></div></figure>        <h1 id="直接部署"   >          <a href="#直接部署" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#直接部署"></a> 直接部署</h1>      <p>  直接部署方便对配置进行修改，不需要更新镜像，安装好模块后使用<code>Node.js</code>运行模块内的<code>vanilla.js</code>文件即可。</p><ol><li>安装waline</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir walinejs &amp;&amp; <span class="built_in">cd</span> walinejs</span><br><span class="line">cnpm install @waline/vercel --save</span><br></pre></td></tr></table></div></figure><ol start="2"><li>编辑<code>.bashrc</code>，添加环境变量，最好将字符串用<code>&quot;</code>或者<code>'</code>包起来，避免<code>$</code>、<code>&amp;</code>等字符的影响</li></ol><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MYSQL_HOST&#x3D;&#39;rm-*.mysql.rds.aliyuncs.com&#39;</span><br><span class="line">...</span><br><span class="line">SENDER_EMAIL&#x3D;&#39;fox@foolishfox.cn&#39;</span><br></pre></td></tr></table></div></figure><ol start="3"><li>创建软链接，方便后续操作</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s node_modules/@waline/vercel ./waline</span><br><span class="line"><span class="built_in">cd</span> waline</span><br></pre></td></tr></table></div></figure><ol start="4"><li>配置服务端<code>vim config.js</code>，见上</li><li>修改主程序<code>vanilla.js</code>，见上</li><li>使用pm2运行程序</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g pm2</span><br><span class="line">pm2 start vanilla.js --name waline</span><br></pre></td></tr></table></div></figure><ol start="7"><li>设置反向目录代理，将<code>api.foolishfox.cn/waline</code>指向<code>127.0.0.1:8360</code></li></ol>        <h1 id="前端配置"   >          <a href="#前端配置" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前端配置"></a> 前端配置</h1>      <p>  参考<span class="exturl"><a class="exturl__link"   href="https://waline.js.org/client/basic.html" >文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，需要注意的有：</p><ol><li>本地(localhost)访问不增加计数（以<code>hexo</code>为例）</li></ol><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Waline(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#waline&#x27;</span>,</span><br><span class="line">    path: location.pathname,</span><br><span class="line">    serverURL: <span class="string">&#x27;https://your-serverURL.domain.com&#x27;</span>,</span><br><span class="line">    visitor: location.hostname!==<span class="string">&#x27;localhost&#x27;</span> &amp;&amp; !&#123; theme.waline.visitor &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>        <h1 id="参考资料"   >          <a href="#参考资料" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h1>      <ol><li><span class="exturl"><a class="exturl__link"   href="https://waline.js.org/" >waline</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><a href="/posts/move.html">博客服务器迁移过程</a></li><li><span class="exturl"><a class="exturl__link"   href="https://www.e-learn.cn/content/qita/2389149" >pm2入门</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h1&gt;
      
&lt;p&gt;  &lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://waline.js.org/&quot; &gt;waline&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;是由&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://github.com/lizheming&quot; &gt;lizheming&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;开发的博客评论系统，从&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://valine.js.org/&quot; &gt;Valine&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;衍生的带后端评论系统。可以将&lt;code&gt;Waline&lt;/code&gt;等价成&lt;code&gt;With backend Valine&lt;/code&gt;。&lt;br /&gt;
  Waline的服务端可以部署在&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://vercel.com/&quot; &gt;Vercel&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;、&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://www.cloudbase.net&quot; &gt;CloudBase&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;或者服务器上，数据库可以使用&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://www.leancloud.cn/&quot; &gt;LeanCloud&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;、MySQL等，总计有多达48钟部署方式。在官方教程中，使用云服务部署都介绍的比较详细，下面介绍两种本地部署方式，可以自定义端口，配合多种数据库使用。&lt;/p&gt;</summary>
    
    
    
    <category term="博客" scheme="https://foolishfox.cn/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    
    <category term="安装" scheme="https://foolishfox.cn/tags/%E5%AE%89%E8%A3%85/"/>
    
  </entry>
  
</feed>
