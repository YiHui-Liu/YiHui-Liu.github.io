<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Fox Home</title>
  
  <subtitle>清疚</subtitle>
  <link href="https://foolishfox.cn/atom.xml" rel="self"/>
  
  <link href="https://foolishfox.cn/"/>
  <updated>2021-04-09T05:49:50.890Z</updated>
  <id>https://foolishfox.cn/</id>
  
  <author>
    <name>liuyihui</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>使用Echarts绘制名侦探柯南人物关系图</title>
    <link href="https://foolishfox.cn/posts/202104-conan.html"/>
    <id>https://foolishfox.cn/posts/202104-conan.html</id>
    <published>2021-04-09T04:24:55.000Z</published>
    <updated>2021-04-09T05:49:50.890Z</updated>
    
    <content type="html"><![CDATA[        <h1 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>      <p>  《名侦探柯南绯色的子弹》就要上映了，npy想要和我一起去看，但是她又搞不懂人物关系，所以就用<code>Echarts</code>做一个柯南的人物关系表了解一下。<br />  <code>ECharts</code>是使用<code>JavaScript</code>实现的开源可视化库，可以做出很多精巧的图片，最初由百度团队开源，后于2018年初捐赠给Apache基金会，成为ASF孵化级项目。</p><span id="more"></span>        <h1 id="步骤"   >          <a href="#步骤" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#步骤"></a> 步骤</h1>      <ol><li>引入<code>jquery</code>和<code>echarts</code>的js文件</li></ol><figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/echarts/5.0.2/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></div></figure><ol start="2"><li>获取<span class="exturl"><a class="exturl__link"   href="https://cdn.jsdelivr.net/gh/YiHui-Liu/Fox-Home-CDN/Detective-Conan.json" >人物关系json文件</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br />  json文件中主要分为3部分，分别是<code>nodes</code>表示人物，<code>links</code>表示关系连接，<code>categories</code>表示阵营/类别。</li></ol><ul><li>nodes</li></ul><figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 必填，二选一</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;0&quot;</span>,   <span class="comment">// 人物id</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;柯南&quot;</span>,   <span class="comment">// 人物名称</span></span><br><span class="line">    <span class="comment">// 选填</span></span><br><span class="line">    <span class="attr">&quot;symbolSize&quot;</span>: <span class="number">50</span>,   <span class="comment">// 点的大小</span></span><br><span class="line">    <span class="attr">&quot;value&quot;</span>: <span class="number">100</span>,   <span class="comment">// 力引导布局(force)中连线长度</span></span><br><span class="line">    <span class="attr">&quot;category&quot;</span>: <span class="number">0</span>,   <span class="comment">// 人物类别</span></span><br><span class="line">    <span class="attr">&quot;itemStyle&quot;</span>: &#123;   <span class="comment">// 自定义样式</span></span><br><span class="line">        <span class="attr">&quot;normal&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;color&quot;</span>: <span class="string">&quot;blue&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ul><li>links</li></ul><figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 必填</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span>: <span class="string">&quot;1&quot;</span>,   <span class="comment">// 源节点名称或者id</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;0&quot;</span>,   <span class="comment">// 目标节点名称或者id</span></span><br><span class="line">    <span class="comment">// 选填</span></span><br><span class="line">    <span class="attr">&quot;value&quot;</span>: <span class="number">100</span>,   <span class="comment">// 力引导布局(force)中连线长度</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;伙伴&quot;</span>   <span class="comment">// 关系名称</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ul><li>categories</li></ul><figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 必填</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;黑衣组织&quot;</span>,   <span class="comment">// 类别名称</span></span><br><span class="line">    <span class="comment">// 选填</span></span><br><span class="line">    <span class="attr">&quot;symbol&quot;</span>: <span class="string">&quot;circle&quot;</span>,   <span class="comment">// 类目节点标记的图形</span></span><br><span class="line">    <span class="attr">&quot;symbolSize&quot;</span>: <span class="number">10</span>,   <span class="comment">// 类目节点的默认大小</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ol start="3"><li>配置前端</li></ol><figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;conan_container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></div></figure><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> conan = echarts.init(<span class="built_in">document</span>.getElementById(<span class="string">&quot;conan_container&quot;</span>));</span><br><span class="line">    <span class="keyword">var</span> option;</span><br><span class="line">    conan.showLoading();</span><br><span class="line">    $.getJSON(<span class="string">&#x27;https://cdn.jsdelivr.net/gh/YiHui-Liu/Fox-Home-CDN/Detective-Conan.json&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">graph</span>) </span>&#123;</span><br><span class="line">        conan.hideLoading();</span><br><span class="line">        option = &#123;</span><br><span class="line">            <span class="comment">// 图表标题与位置</span></span><br><span class="line">            title: &#123;</span><br><span class="line">                text: <span class="string">&#x27;Detective Conan&#x27;</span>,</span><br><span class="line">                top: <span class="string">&#x27;bottom&#x27;</span>,</span><br><span class="line">                left: <span class="string">&#x27;right&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            tooltip: &#123;&#125;,</span><br><span class="line">            legend: [&#123;</span><br><span class="line">                <span class="comment">// selectedMode: &#x27;single&#x27;,</span></span><br><span class="line">                data: graph.categories.map(<span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> a.name;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;],</span><br><span class="line">            animationDuration: <span class="number">1500</span>,</span><br><span class="line">            animationEasingUpdate: <span class="string">&#x27;quinticInOut&#x27;</span>,</span><br><span class="line">            series: [</span><br><span class="line">                &#123;</span><br><span class="line">                    name: <span class="string">&#x27;Detective Conan&#x27;</span>,</span><br><span class="line">                    type: <span class="string">&#x27;graph&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 布局，none使用节点中提供的x、y作为节点的位置；circular采用环形布局；force采用力引导布局</span></span><br><span class="line">                    layout: <span class="string">&#x27;circular&#x27;</span>,</span><br><span class="line">                    data: graph.nodes,</span><br><span class="line">                    links: graph.links,</span><br><span class="line">                    categories: graph.categories,</span><br><span class="line">                    symbolSize: <span class="number">15</span>,</span><br><span class="line">                    value: <span class="number">30</span>,</span><br><span class="line">                    roam: <span class="literal">true</span>,</span><br><span class="line">                    label: &#123;</span><br><span class="line">                        show: <span class="literal">true</span>,</span><br><span class="line">                        position: <span class="string">&#x27;right&#x27;</span>,</span><br><span class="line">                        formatter: <span class="string">&#x27;&#123;b&#125;&#x27;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    labelLayout: &#123;</span><br><span class="line">                        hideOverlap: <span class="literal">true</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    lineStyle: &#123;</span><br><span class="line">                        color: <span class="string">&#x27;source&#x27;</span>,</span><br><span class="line">                        curveness: <span class="number">0.3</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 突出显示有连接的人物</span></span><br><span class="line">                    emphasis: &#123;</span><br><span class="line">                        focus: <span class="string">&#x27;adjacency&#x27;</span>,</span><br><span class="line">                        lineStyle: &#123;</span><br><span class="line">                            width: <span class="number">10</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 缩放限制</span></span><br><span class="line">                    scaleLimit: &#123;</span><br><span class="line">                        min: <span class="number">0.6</span>,</span><br><span class="line">                        max: <span class="number">3</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 显示links的名称</span></span><br><span class="line">                    <span class="comment">// edgeSymbolSize: [4, 10],</span></span><br><span class="line">                    <span class="comment">// edgeLabel: &#123;</span></span><br><span class="line">                    <span class="comment">//     show: true,</span></span><br><span class="line">                    <span class="comment">//     formatter: function (x) &#123;</span></span><br><span class="line">                    <span class="comment">//         return x.data.name;</span></span><br><span class="line">                    <span class="comment">//     &#125;,</span></span><br><span class="line">                    <span class="comment">//     textStyle: &#123;</span></span><br><span class="line">                    <span class="comment">//         fontSize: 20</span></span><br><span class="line">                    <span class="comment">//     &#125;</span></span><br><span class="line">                    <span class="comment">// &#125;,</span></span><br><span class="line">                    <span class="comment">// 力引导布局的设置</span></span><br><span class="line">                    <span class="comment">// force: &#123;</span></span><br><span class="line">                    <span class="comment">//     repulsion: 2500,</span></span><br><span class="line">                    <span class="comment">//     edgeLength: [10, 50]</span></span><br><span class="line">                    <span class="comment">// &#125;,</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;;</span><br><span class="line">        conan.setOption(option);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (option &amp;&amp; <span class="keyword">typeof</span> option === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">        conan.setOption(option);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>        <h1 id="效果展示"   >          <a href="#效果展示" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#效果展示"></a> 效果展示</h1>      <script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script><script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/echarts/5.0.2/echarts.min.js"></script><div id="conan_container" style="max-width: 900px;height: 600px;"></div><script type="text/javascript">    var conan = echarts.init(document.getElementById("conan_container"));    var option;    conan.showLoading();    $.getJSON('https://cdn.jsdelivr.net/gh/YiHui-Liu/Fox-Home-CDN/Detective-Conan.json', function (graph) {        conan.hideLoading();        option = {            title: {                text: 'Detective Conan',                top: 'bottom',                left: 'right'            },            tooltip: {                formatter: function (x) {                    return x.data.des;                }            },            legend: [{                // selectedMode: 'single',                data: graph.categories.map(function (a) {                    return a.name;                })            }],            animationDuration: 1500,            animationEasingUpdate: 'quinticInOut',            series: [                {                    name: 'Detective Conan',                    type: 'graph',                    layout: 'circular',                    data: graph.nodes,                    links: graph.links,                    categories: graph.categories,                    symbolSize: 15,                    value: 30,                    roam: true,                    label: {                        show: true,                        position: 'right',                        formatter: '{b}'                    },                    labelLayout: {                        hideOverlap: true                    },                    lineStyle: {                        color: 'source',                        curveness: 0.3                    },                    emphasis: {                        focus: 'adjacency',                        lineStyle: {                            width: 10                        }                    },                    scaleLimit: {                        min: 0.6,                        max: 3                    }                }            ]        };        conan.setOption(option);    });    if (option && typeof option === 'object') {        conan.setOption(option);    }</script>        <h1 id="参考资料"   >          <a href="#参考资料" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h1>      <ol><li><span class="exturl"><a class="exturl__link"   href="https://blog.csdn.net/weixin_38409915/article/details/114369054" >人物关系图谱:ECharts 实现</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link"   href="https://echarts.apache.org/examples/zh/index.html" >Echarts文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link"   href="https://echarts.apache.org/zh/option.html" >Echarts示例</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h1&gt;
      
&lt;p&gt;  《名侦探柯南绯色的子弹》就要上映了，npy想要和我一起去看，但是她又搞不懂人物关系，所以就用&lt;code&gt;Echarts&lt;/code&gt;做一个柯南的人物关系表了解一下。&lt;br /&gt;
  &lt;code&gt;ECharts&lt;/code&gt;是使用&lt;code&gt;JavaScript&lt;/code&gt;实现的开源可视化库，可以做出很多精巧的图片，最初由百度团队开源，后于2018年初捐赠给Apache基金会，成为ASF孵化级项目。&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>博客评论系统——Waline</title>
    <link href="https://foolishfox.cn/posts/202104-waline.html"/>
    <id>https://foolishfox.cn/posts/202104-waline.html</id>
    <published>2021-04-07T14:21:46.000Z</published>
    <updated>2021-04-09T11:48:13.640Z</updated>
    
    <content type="html"><![CDATA[        <h1 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>      <p>  <span class="exturl"><a class="exturl__link"   href="https://waline.js.org/" >waline</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>是由<span class="exturl"><a class="exturl__link"   href="https://github.com/lizheming" >lizheming</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>开发的博客评论系统，从<span class="exturl"><a class="exturl__link"   href="https://valine.js.org/" >Valine</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>衍生的带后端评论系统。可以将<code>Waline</code>等价成<code>With backend Valine</code>。<br />  Waline的服务端可以部署在<span class="exturl"><a class="exturl__link"   href="https://vercel.com/" >Vercel</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="https://www.cloudbase.net" >CloudBase</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>或者服务器上，数据库可以使用<span class="exturl"><a class="exturl__link"   href="https://www.leancloud.cn/" >LeanCloud</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、MySQL等，总计有多达48钟部署方式。在官方教程中，使用云服务部署都介绍的比较详细，下面介绍两种本地部署方式，可以自定义端口，配合多种数据库使用。</p><span id="more"></span>        <h1 id="docker"   >          <a href="#docker" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#docker"></a> Docker</h1>      <p>  在Docker容器内运行<code>vanilla.js</code>文件。</p><ol><li>修改<code>Node.js</code>淘宝源</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单次使用</span></span><br><span class="line">npm install module_name --registry=https://registry.npm.taobao.org</span><br><span class="line"><span class="comment"># 永久修改</span></span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br><span class="line"><span class="comment"># 使用cnpm，安装了cnpm之后，npm install 都可以换成cnpm install</span></span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></div></figure><ol start="2"><li>构建镜像</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/lizheming/waline.git</span><br><span class="line"><span class="built_in">cd</span> waline</span><br><span class="line">docker build -t image_name -f packages/server/Dockerfile .</span><br></pre></td></tr></table></div></figure><ol start="3"><li>修改配置<code>packages/client/.env</code>，参考文档中所需环境变量配置即可</li></ol><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">SKIP_PREFLIGHT_CHECK&#x3D;true</span><br><span class="line"></span><br><span class="line"># 数据库配置，参考https:&#x2F;&#x2F;waline.js.org&#x2F;server&#x2F;databases.html</span><br><span class="line">MYSQL_HOST&#x3D;127.0.0.1</span><br><span class="line">MYSQL_DB&#x3D;db_name</span><br><span class="line">MYSQL_USER&#x3D;db_user</span><br><span class="line">MYSQL_PASSWORD&#x3D;password</span><br><span class="line"></span><br><span class="line">AKISMET_KEY&#x3D;guess</span><br><span class="line"></span><br><span class="line">SITE_NAME&#x3D;Fox Home</span><br><span class="line">SITE_URL&#x3D;https:&#x2F;&#x2F;foolishfox.cn</span><br><span class="line">AUTHOR_EMAIL&#x3D;fox@foolishfox.cn</span><br><span class="line"></span><br><span class="line">SC_KEY&#x3D;SCK232027Td54bfab83cfabf0aereq2c31b6552cd35fe1a43720074</span><br><span class="line"></span><br><span class="line">SMTP_HOST&#x3D;smtp.ym.163.com</span><br><span class="line">SMTP_PORT&#x3D;465</span><br><span class="line">SMTP_USER&#x3D;fox@foolishfox.cn</span><br><span class="line">SMTP_PASS&#x3D;password</span><br><span class="line">SENDER_NAME&#x3D;fox</span><br><span class="line">SENDER_EMAIL&#x3D;fox@foolishfox.cn</span><br></pre></td></tr></table></div></figure><ol start="4"><li>运行镜像</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --env-file ./packages/client/.env -p 8360:8360 -d image_name</span><br></pre></td></tr></table></div></figure><ol start="5"><li>设置反向目录代理，将<code>api.foolishfox.cn/waline</code>指向<code>127.0.0.1:8360</code></li><li>进入容器</li></ol><figure class="highlight sh"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看容器id</span></span><br><span class="line">root@iZ2ze8k2vy63cz277rsw8zZ:$ docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE              COMMAND                  CREATED          STATUS          PORTS                    NAMES</span><br><span class="line">cebd15a83483   lizheming/waline   <span class="string">&quot;docker-entrypoint.s…&quot;</span>   44 seconds ago   Up 42 seconds   0.0.0.0:8360-&gt;8360/tcp   admiring_noether</span><br><span class="line"><span class="comment"># 进入容器</span></span><br><span class="line">root@iZ2ze8k2vy63cz277rsw8zZ:$ docker <span class="built_in">exec</span> -it cebd15a83483 /bin/bash</span><br></pre></td></tr></table></div></figure><ol start="7"><li>安装<code>vim</code>（可跳过）与验证组件</li></ol><figure class="highlight sh"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install vim</span><br><span class="line">apt install apt-transport-https ca-certificates</span><br></pre></td></tr></table></div></figure><ol start="8"><li>更新软件源（使用<span class="exturl"><a class="exturl__link"   href="https://mirrors.tuna.tsinghua.edu.cn/help/debian/" >清华源</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>）</li></ol><figure class="highlight sh"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份</span></span><br><span class="line">mv /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line"><span class="comment"># vim修改</span></span><br><span class="line">vim /etc/apt/sources.list</span><br><span class="line"><span class="comment"># echo修改</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free&quot;</span> &gt;/etc/apt/sources.list</span><br><span class="line"><span class="comment"># 更新</span></span><br><span class="line">apt update</span><br><span class="line">...</span><br></pre></td></tr></table></div></figure><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster main contrib non-free</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster main contrib non-free</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster-updates main contrib non-free</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster-updates main contrib non-free</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster-backports main contrib non-free</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster-backports main contrib non-free</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian-security buster&#x2F;updates main contrib non-free</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian-security buster&#x2F;updates main contrib non-free</span><br></pre></td></tr></table></div></figure><ol start="9"><li>配置<code>config.js</code>，路径为：<code>node_modules/@waline/vercel/config.js</code>，参考<span class="exturl"><a class="exturl__link"   href="https://waline.js.org/server/basic.html#%E4%BB%A3%E7%A0%81%E9%85%8D%E7%BD%AE" >服务端配置</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    secureDomains: [</span><br><span class="line">        <span class="string">&#x27;foolishfox.cn&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;api.foolishfox.cn&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    forbiddenWords: [</span><br><span class="line">        <span class="string">&#x27;空包&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;快递&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;下单&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    disallowIPList: [</span><br><span class="line">        <span class="string">&#x27;8.8.8.8&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><ol start="10"><li>修改主程序<code>vanilla.js</code>，导入自定义配置</li></ol><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> Application = <span class="built_in">require</span>(<span class="string">&#x27;thinkjs&#x27;</span>);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">let</span> config = &#123;&#125;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    config = <span class="built_in">require</span>(<span class="string">&#x27;./config.js&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(e) &#123;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></div></figure>        <h1 id="直接部署"   >          <a href="#直接部署" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#直接部署"></a> 直接部署</h1>      <p>  直接部署方便对配置进行修改，不需要更新镜像，安装好模块后使用<code>Node.js</code>运行模块内的<code>vanilla.js</code>文件即可。</p><ol><li>安装waline</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir walinejs &amp;&amp; <span class="built_in">cd</span> walinejs</span><br><span class="line">cnpm install @waline/vercel --save</span><br></pre></td></tr></table></div></figure><ol start="2"><li>编辑<code>.bashrc</code>，添加环境变量，最好将字符串用<code>&quot;</code>或者<code>'</code>包起来，避免<code>$</code>、<code>&amp;</code>等字符的影响</li></ol><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MYSQL_HOST&#x3D;&#39;rm-*.mysql.rds.aliyuncs.com&#39;</span><br><span class="line">...</span><br><span class="line">SENDER_EMAIL&#x3D;&#39;fox@foolishfox.cn&#39;</span><br></pre></td></tr></table></div></figure><ol start="3"><li>创建软链接，方便后续操作</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s node_modules/@waline/vercel ./waline</span><br><span class="line"><span class="built_in">cd</span> waline</span><br></pre></td></tr></table></div></figure><ol start="4"><li>配置服务端<code>vim config.js</code>，见上</li><li>修改主程序<code>vanilla.js</code>，见上</li><li>使用pm2运行程序</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g pm2</span><br><span class="line">pm2 start vanilla.js --name waline</span><br></pre></td></tr></table></div></figure><ol start="7"><li>设置反向目录代理，将<code>api.foolishfox.cn/waline</code>指向<code>127.0.0.1:8360</code></li></ol>        <h1 id="前端配置"   >          <a href="#前端配置" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前端配置"></a> 前端配置</h1>      <p>  参考<span class="exturl"><a class="exturl__link"   href="https://waline.js.org/client/basic.html" >文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，需要注意的有：</p><ol><li>本地(localhost)访问不增加计数（以<code>hexo</code>为例）</li></ol><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Waline(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#waline&#x27;</span>,</span><br><span class="line">    path: location.pathname,</span><br><span class="line">    serverURL: <span class="string">&#x27;https://your-serverURL.domain.com&#x27;</span>,</span><br><span class="line">    visitor: location.hostname!==<span class="string">&#x27;localhost&#x27;</span> &amp;&amp; !&#123; theme.waline.visitor &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>        <h1 id="参考资料"   >          <a href="#参考资料" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h1>      <ol><li><span class="exturl"><a class="exturl__link"   href="https://waline.js.org/" >waline</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><a href="/posts/move.html">博客服务器迁移过程</a></li><li><span class="exturl"><a class="exturl__link"   href="https://www.e-learn.cn/content/qita/2389149" >pm2入门</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h1&gt;
      
&lt;p&gt;  &lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://waline.js.org/&quot; &gt;waline&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;是由&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://github.com/lizheming&quot; &gt;lizheming&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;开发的博客评论系统，从&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://valine.js.org/&quot; &gt;Valine&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;衍生的带后端评论系统。可以将&lt;code&gt;Waline&lt;/code&gt;等价成&lt;code&gt;With backend Valine&lt;/code&gt;。&lt;br /&gt;
  Waline的服务端可以部署在&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://vercel.com/&quot; &gt;Vercel&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;、&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://www.cloudbase.net&quot; &gt;CloudBase&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;或者服务器上，数据库可以使用&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://www.leancloud.cn/&quot; &gt;LeanCloud&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;、MySQL等，总计有多达48钟部署方式。在官方教程中，使用云服务部署都介绍的比较详细，下面介绍两种本地部署方式，可以自定义端口，配合多种数据库使用。&lt;/p&gt;</summary>
    
    
    
    <category term="Hexo" scheme="https://foolishfox.cn/categories/Hexo/"/>
    
    
    <category term="blog" scheme="https://foolishfox.cn/tags/blog/"/>
    
    <category term="安装" scheme="https://foolishfox.cn/tags/%E5%AE%89%E8%A3%85/"/>
    
  </entry>
  
  <entry>
    <title>博客服务器迁移过程</title>
    <link href="https://foolishfox.cn/posts/202103-move.html"/>
    <id>https://foolishfox.cn/posts/202103-move.html</id>
    <published>2021-03-30T12:03:44.000Z</published>
    <updated>2021-04-07T15:43:18.448Z</updated>
    
    <content type="html"><![CDATA[    <div class="note-plugin info">      <span class="note-plugin__icon note-plugin__icon--info">              <i class="fas fa-info-circle"></i>            </span>      <p><strong>Info</strong><br />本文记录迁移过程备忘，方便后面再次迁移</p>    </div>          <h1 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>      <p>  阿里云ECS学生机要过期了，由于自己曾经升级过ECS的带宽（从1M到3M），所以不能享受续费优惠，无奈之下，只能选择进行服务器迁移。备选的方案有腾讯云CVM、阿里云轻量应用服务器和硅云ECS。</p><span id="more"></span><p>  硅云最早被Pass，毕竟和前面两家大厂相比不论是产品可选择性还是可靠性都略显不足，只能放在次要选择。腾讯云有学生优惠，2H4G3M服务器400+一年，还可以同样价格续费，很实惠。不过最终综合价格和便捷，还是选择了阿里云，初购96/年的轻量应用服务器，毕竟我的RDS数据库和OSS（被我用又拍云云储存顶替了）都是阿里云的。</p>        <h1 id="准备"   >          <a href="#准备" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#准备"></a> 准备</h1>      <p>  买好服务器后，首先配置一下shh免密码登录，方便后面的过程进行。<br />  下一步查看一下有哪些东西需要进行迁移。我的服务都已经添加了监控，可以直接在<span class="exturl"><a class="exturl__link"   href="https://status.foolishfox.cn/" >监控-服务</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>看到：<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/03/20210330202813.png"  alt="" />      <br />  仔细清点过后，需要进行迁移的服务有：</p><ul><li>API-Img: 图片、视频等静态文件API，阿里云OSS -&gt; 又拍云云储存</li><li>API-Waline: 评论后台，ECS -&gt; swas</li><li>Site-Blog: 博客主体，ECS -&gt; swas</li><li>Site-Editor: 在线编辑器，ECS -&gt; swas</li><li>Site-Guard: ServerStatus，ECS -&gt; swas</li><li>Site-Travel: 旅行地图，ECS -&gt; swas</li></ul>        <h1 id="迁移"   >          <a href="#迁移" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#迁移"></a> 迁移</h1>              <h2 id="api-img"   >          <a href="#api-img" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#api-img"></a> API-Img</h2>      <p>  根据又拍云文档创建云储存服务，更改img.foolishfox.cn的CNAME的解析，备份文件即可。</p>        <h2 id="site-blog"   >          <a href="#site-blog" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#site-blog"></a> Site-Blog</h2>      <p>  又进行一次之前的迁移，可以看之前的<a href="/posts/202012-heog.html">文章</a>。<br />  为了方便下一步的安装，可以选择安装<code>n</code>进行<code>Node.js</code>的版本管理，另外还可以更改<code>npm</code>源为淘宝源，加快下载、安装速度。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/03/20210330204237.png"  alt="" />      </p>        <h2 id="site-editor"   >          <a href="#site-editor" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#site-editor"></a> Site-Editor</h2>      <p>  进行了上一步之后，服务器已经安装好了<code>Node.js</code>环境，剩下的只需要安照<span class="exturl"><a class="exturl__link"   href="https://winwin_2011.gitee.io/winwin-hexo-editor/" >文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>安装即可。<br />  使用<code>pm2</code>启动后，需要设置<code>Nginx</code>反向代理，方便通过域名进行访问。例如<code>winwin-hexo-editor</code>运行在8900端口，设置<code>write.foolishfox.cn</code>的反向代理为<code>127.0.0.1:8900</code>。</p>        <h2 id="site-guard"   >          <a href="#site-guard" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#site-guard"></a> Site-Guard</h2>      <p>  ServerStatus一开始是一个老外的项目，可以理解为多服务器探针、多服务器云监控。后来国人进行了汉化和修改，我这里使用的是<span class="exturl"><a class="exturl__link"   href="https://github.com/nyawork/" >nyawork</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>开发的<span class="exturl"><a class="exturl__link"   href="https://github.com/nyawork/ServerStatus-Hotaru" >ServerStatus-Hotaru</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>版本。安装十分简单，只需要下载好文件，按照步骤进行即可。</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@vultr:~<span class="comment"># wget https://raw.githubusercontent.com/nyawork/ServerStatus-Hotaru/master/status.sh</span></span><br><span class="line">root@vultr:~<span class="comment"># chmod +x status.sh</span></span><br></pre></td></tr></table></div></figure><p>  因为要从Github下载文件，所以安装速度比较慢。例如下载<code>master.zip</code>，可以打开<code>status.sh</code>文件找到下载链接，下载好之后更改文件名为<code>master.zip</code>，再上传到<code>/tmp</code>文件夹下，这样速度会快很多。除了<code>master.zip</code>，还有一个文件是<code>jq</code>，事先创建好<code>/usr/local/ServerStatus</code>文件夹，将下载好的文件重命名后放在该文件下。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://img.foolishfox.cn/images/2021/03/20210330205244.png"  alt="" />      <br />  要修改的话，可以直接更改<code>/usr/local/ServerStatus/server/config.json</code>文件，重启<code>status.sh</code>即可。</p>        <h2 id="site-travel"   >          <a href="#site-travel" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#site-travel"></a> Site-Travel</h2>      <p>  <span class="exturl"><a class="exturl__link"   href="https://github.com/yc111/footprint" >footprint</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>是由<span class="exturl"><a class="exturl__link"   href="https://github.com/yc111/" >yc111</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>开发的利用echarts展示旅行足迹的项目。前面已经配置好了<code>Node.js</code>环境，只需安装依赖即可运行。然后设置Nginx反向目录代理，将<code>api.foolishfox.cn/travel</code>指向<code>127.0.0.1:1024</code>。</p>        <h2 id="api-waline"   >          <a href="#api-waline" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#api-waline"></a> API-Waline</h2>      <p>  <span class="exturl"><a class="exturl__link"   href="https://waline.js.org/" >waline</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>是由<span class="exturl"><a class="exturl__link"   href="https://github.com/lizheming" >lizheming</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>开发的博客评论系统，是最难配置的一部分。Waline有多达48钟部署方式，下面介绍两种部署方式：</p>        <h3 id="docker"   >          <a href="#docker" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#docker"></a> Docker</h3>      <p>  由于有自己的服务器和数据库，最开始选择了Waline/client+Docker+MySQL的方式进行部署。</p><ol><li>修改<code>Node.js</code>淘宝源</li><li>构建镜像</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/lizheming/waline.git</span><br><span class="line"><span class="built_in">cd</span> waline</span><br><span class="line">docker build -t lizheming/waline -f packages/server/Dockerfile .</span><br></pre></td></tr></table></div></figure><ol start="3"><li>修改配置<code>packages/client/.env</code></li></ol><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SITE_NAME&#x3D;Fox Home</span><br><span class="line">SITE_URL&#x3D;https:&#x2F;&#x2F;foolishfox.cn</span><br><span class="line"></span><br><span class="line"># 配置参考：</span><br><span class="line"># https:&#x2F;&#x2F;waline.js.org&#x2F;server&#x2F;databases.html</span><br><span class="line"># https:&#x2F;&#x2F;waline.js.org&#x2F;server&#x2F;notification.html</span><br><span class="line">MYSQL_HOST&#x3D;127.0.0.1</span><br><span class="line">MYSQL_DB&#x3D;db_name</span><br><span class="line">MYSQL_USER&#x3D;db_user</span><br><span class="line">MYSQL_PASSWORD&#x3D;password</span><br><span class="line">SC_KEY&#x3D;SCK232027Td54bfab83cfabf0aereq2c31b6552cd35fe1a43720074</span><br><span class="line">AUTHOR_EMAIL&#x3D;fox@foolishfox.cn</span><br></pre></td></tr></table></div></figure><ol start="4"><li>运行镜像</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --env-file ./packages/client/.env -p 8360:8360 -d lizheming/waline</span><br></pre></td></tr></table></div></figure><ol start="5"><li>设置反向目录代理，将<code>api.foolishfox.cn/waline</code>指向<code>127.0.0.1:8360</code></li></ol>        <h3 id="独立部署"   >          <a href="#独立部署" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#独立部署"></a> 独立部署</h3>      <p>  由于方便对配置进行修改，不需要更新镜像等原因，后来弃用了Docker部署，改为直接使用<code>Node.js</code>运行。</p><ol><li>安装waline</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir walinejs &amp;&amp; <span class="built_in">cd</span> walinejs</span><br><span class="line">cnpm install @waline/vercel --save</span><br></pre></td></tr></table></div></figure><ol start="2"><li>编辑<code>.bashrc</code>，添加环境变量，最好将字符串用<code>&quot;</code>或者<code>'</code>包起来，避免<code>$</code>、<code>&amp;</code>等字符的影响</li><li>创建软链接，方便后续操作</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s node_modules/@waline/vercel ./waline</span><br><span class="line"><span class="built_in">cd</span> waline</span><br></pre></td></tr></table></div></figure><ol start="4"><li>配置服务端<code>vim config.js</code></li></ol><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    secureDomains: [</span><br><span class="line">        <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><ol start="5"><li>修改主程序<code>vanilla.js</code></li></ol><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> Application = <span class="built_in">require</span>(<span class="string">&#x27;thinkjs&#x27;</span>);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">let</span> config = &#123;&#125;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    config = <span class="built_in">require</span>(<span class="string">&#x27;./config.js&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(e) &#123;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></div></figure><ol start="6"><li>使用pm2运行程序</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g pm2</span><br><span class="line">pm2 start vanilla.js --name waline</span><br></pre></td></tr></table></div></figure><ol start="7"><li>设置反向目录代理，将<code>api.foolishfox.cn/waline</code>指向<code>127.0.0.1:8360</code></li></ol>        <h1 id="参考资料"   >          <a href="#参考资料" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h1>      <ol><li><span class="exturl"><a class="exturl__link"   href="https://segmentfault.com/a/1190000023054090" >Windows SSH 免密登录详解</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><a href="/posts/202012-heog.html">从WordPress搬迁——使用Hexo搭建博客</a></li><li><span class="exturl"><a class="exturl__link"   href="https://newsn.net/say/node-n.html" >如何利用n轻松切换nodejs的版本</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link"   href="https://winwin_2011.gitee.io/winwin-hexo-editor/" >winwin-hexo-editor</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link"   href="https://github.com/nyawork/ServerStatus-Hotaru" >ServerStatus-Hotaru</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link"   href="https://github.com/yc111/footprint" >footprint</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link"   href="https://waline.js.org/" >waline</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>]]></content>
    
    
    <summary type="html">&lt;div class=&quot;note-plugin info&quot;&gt;
      &lt;span class=&quot;note-plugin__icon note-plugin__icon--info&quot;&gt;
              &lt;i class=&quot;fas fa-info-circle&quot;&gt;&lt;/i&gt;
            &lt;/span&gt;
      &lt;p&gt;&lt;strong&gt;Info&lt;/strong&gt;&lt;br /&gt;本文记录迁移过程备忘，方便后面再次迁移&lt;/p&gt;
    &lt;/div&gt;
  

        &lt;h1 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h1&gt;
      
&lt;p&gt;  阿里云ECS学生机要过期了，由于自己曾经升级过ECS的带宽（从1M到3M），所以不能享受续费优惠，无奈之下，只能选择进行服务器迁移。备选的方案有腾讯云CVM、阿里云轻量应用服务器和硅云ECS。&lt;/p&gt;</summary>
    
    
    
    <category term="博客" scheme="https://foolishfox.cn/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    
    <category term="软件" scheme="https://foolishfox.cn/tags/%E8%BD%AF%E4%BB%B6/"/>
    
    <category term="安装" scheme="https://foolishfox.cn/tags/%E5%AE%89%E8%A3%85/"/>
    
    <category term="Hexo" scheme="https://foolishfox.cn/tags/Hexo/"/>
    
  </entry>
  
</feed>
