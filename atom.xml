<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Fox Home</title>
  
  <subtitle>清疚</subtitle>
  <link href="https://foolishfox.cn/atom.xml" rel="self"/>
  
  <link href="https://foolishfox.cn/"/>
  <updated>2021-06-23T15:24:26.863Z</updated>
  <id>https://foolishfox.cn/</id>
  
  <author>
    <name>liuyihui</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>中国没有辜负社会主义</title>
    <link href="https://foolishfox.cn/posts/202106-china_socialism.html"/>
    <id>https://foolishfox.cn/posts/202106-china_socialism.html</id>
    <published>2021-06-23T15:11:04.000Z</published>
    <updated>2021-06-23T15:24:26.863Z</updated>
    
    <content type="html"><![CDATA[        <h2 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2>      <p>  英国伦敦，大英博物馆，1516年出版的莫尔的《乌托邦》一书静静躺在展柜里。同时留在这座博物馆图书阅览室地板上的，是一位伟人厚重的足印。正是这位为人类解放事业奋斗终身的马克思，将社会主义从空想变为科学，从而广泛而深刻地影响了世界，也广泛而深刻地改变了中国。</p><p>  中国北京，人民大会堂，习近平总书记2016年在庆祝中国共产党成立95周年大会上向世界宣示：中国共产党领导中国人民取得的伟大胜利，使具有500年历史的社会主义主张在世界上人口最多的国家成功开辟出具有高度现实性和可行性的正确道路，让科学社会主义在21世纪焕发出新的蓬勃生机。</p><p>  数百年奔流激荡。曾经苦难深重，如今意气昂扬。在科学真理和崇高理想的指引下，中国大地发生历史巨变，我们无比坚定，社会主义没有辜负中国！在中国共产党领导人民的顽强奋斗中，信仰的光芒熠熠闪烁，伟大的事业青春盎然，我们无比自豪，中国没有辜负社会主义！</p><span id="more"></span>        <h2 id="中国特色社会主义道路"   >          <a href="#中国特色社会主义道路" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#中国特色社会主义道路"></a> 中国特色社会主义道路</h2>      <p>  走进江苏常州的瞿秋白纪念馆，“我总想为大家辟一条光明的路”的誓言格外醒目。</p><p>  中国共产党这个百折不回的寻路者、大勇无畏的开路人，面对种种考验、重重难关，以愚公移山的坚定、精卫填海的奉献，带领中国人民走出了一条险峻而壮丽、艰辛而宽广的中国道路。中国特色社会主义道路，是党和人民100年奋斗、创造、积累的根本成就，是引领中国进步、增进人民福祉、实现民族复兴的康庄大道。</p><p>  这是一条在历史洪流中扭转民族命运、书写人间奇迹的奋斗之路。在“山重水复疑无路”的彷徨困顿中，马克思主义给中国带来“柳暗花明”。从此，中国共产党开展了以马克思主义之“矢”射中国之“的”的伟大实践。为了推翻“三座大山”，党领导人民开创了农村包围城市、武装夺取政权的革命道路，建立了新中国。为了改变一穷二白的落后面貌，我们建立起全新的社会主义制度，形成了独立的比较完整的工业体系和国民经济体系，并在总结正反两方面经验的基础上，开启了改革开放的伟大航程，极大解放和发展了生产力。面对民族复兴和世界变局的交织激荡，我们坚定理想信念、保持战略定力，围绕坚持和发展中国特色社会主义，完善总体布局、确立战略布局，引领中华民族迎来了从站起来到富起来、强起来的伟大飞跃。</p><p>  这是一条把人民放在最高位置，得民心、顺民意、惠民利的初心之路。“人民就是江山，共产党打江山、守江山，守的是人民的心，为的是让人民过上好日子。”一代代共产党人为了人民的利益和福祉，把青春和生命、鲜血和汗水，倾注在这片可爱的土地。“小康路上一个都不能少”！为了让幸福的阳光洒遍神州每一个角落，习近平总书记带领全党全国打响脱贫攻坚战，25.5万个驻村工作队挺进一线，近200万名乡镇干部、数百万村干部倾力奋战，八年时间实现了9899万农村贫困人口全部脱贫，832个贫困县全部摘帽，12.8万个贫困村全部出列。这是党、人民、民族的伟大光荣，是我国社会主义制度优越性的充分体现，标志着中华民族向着共同富裕迈出了一大步。</p><p>  这是一条在经济文化落后国家探索建设现代化的创造之路。现代化是世界近代以来的历史潮流，也寄托着马克思主义先驱对理想社会的期许。错失了工业革命机遇的中国，从所谓“天朝上国”跌落成任人宰割的“鱼肉”。严复著《原强》《辟韩》，郭嵩焘著《使西纪程》，孙中山著《建国方略》，都见证着对现代化的希望和失望。只有中国共产党登上历史舞台，根除了帝国主义和封建主义的祸根，实现了经济基础和上层建筑的彻底改造，才为中国现代化提供了根本前提。从“四个现代化”目标到“三步走”战略，从建设小康社会到建设现代化强国……党领导人民不但用几十年时间走完了发达国家几百年走过的工业化历程，而且探索开辟了物质文明和精神文明相协调、全体人民共同富裕、人与自然和谐共生、走和平发展道路的中国式现代化，为人类社会发展提供了现代化的全新选择。</p><p>  这是一条始终保持革命精神、以党的自我革命引领伟大社会革命的锻造之路。列宁指出：“无产阶级在争取政权的斗争中，除了组织，没有别的武器。”把曾经“一盘散沙”的中国凝聚起来，不能不依靠有理想、有纪律的马克思主义政党；为宏伟的目标、艰巨的任务而奋斗，不能不保持党的先进性和纯洁性、创造力和战斗力。古田会议、遵义会议、延安整风、“两个务必”、伟大工程和新的伟大工程……每到重大关头，党都指引着前进的方向、担当起历史的责任，坚持真理、修正错误，带领人民翻过一座又一座山，夺取一个又一个胜利。党的十八大以来，以习近平同志为核心的党中央坚持党对一切工作的领导，以自我革命精神推进全面从严治党，以党的革命性锻造引领新的伟大斗争。“打铁必须自身硬。”新时代共产党人用决心和勇气夯实了事业常青之基，用行动回答了跳出“历史周期率”的世纪之问！</p><p>  2021年3月，俄罗斯联邦共产党中央委员会主席根纳季·久加诺夫在《真理报》撰文指出：“中国共产党的经验证明，20世纪末社会主义的失利，并不是各种反共产主义者喜欢说的‘乌托邦社会主义计划的失败’……在中共领导下，中国人民有能力应对时代的一切挑战，沿着建设新时代中国特色社会主义的正确道路前进”。</p><p>  中国用铁一般的事实宣告：历史没有终结也不会终结，社会主义生机蓬勃、前途无限！中国特色社会主义道路不但走得对、走得通，而且必将通往更加光明的未来！</p>        <h2 id="中国特色-民族特色-时代特色"   >          <a href="#中国特色-民族特色-时代特色" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#中国特色-民族特色-时代特色"></a> 中国特色、民族特色、时代特色</h2>      <p>  马克思主义为人间带回真理的火种，但它并没有结束真理，而是开启了真理之书的扉页。中国，以鲜活厚重的理论创新、思想创造，在科学社会主义这部巨著里写下了属于自己的不朽篇章。</p>        <h3 id="坚守中国从未背离科学社会主义基本原则"   >          <a href="#坚守中国从未背离科学社会主义基本原则" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#坚守中国从未背离科学社会主义基本原则"></a> 坚守：中国从未背离科学社会主义基本原则</h3>      <p>  马克思、恩格斯曾对未来社会主义社会的发展过程、发展方向、一般特征作过科学预测和设想。比如，在生产资料公有制基础上组织生产，满足全体社会成员的需要是社会主义生产的根本目的；对社会生产进行有计划的指导和调节，实行等量劳动领取等量产品的按劳分配原则；合乎自然规律地改造和利用自然……这些构成了科学社会主义基本原则。</p><p>  百年峥嵘岁月，无论弱小还是强大，无论处于高潮还是遭遇挫折，中国共产党从未动摇对科学社会主义基本原则的坚持。我们坚持党的领导；坚持人民民主专政的国体和人民代表大会制度的政体；坚持劳动光荣、按劳分配的社会主义分配原则；坚持把人的价值放在第一位，不断促进人的全面发展和社会全面进步……这些都在新的历史条件下体现了科学社会主义基本原则，赓续了社会主义的基因血脉。</p>        <h3 id="发展中国不断推进马克思主义中国化"   >          <a href="#发展中国不断推进马克思主义中国化" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#发展中国不断推进马克思主义中国化"></a> 发展：中国不断推进马克思主义中国化</h3>      <p>  “马克思的整个世界观不是教义，而是方法。它提供的不是现成的教条，而是进一步研究的出发点和供这种研究使用的方法。”只有发展马克思主义，才能坚持马克思主义，这就是历史的辩证法。</p><p>  百年风雨兼程，中国共产党始终高举真理的旗帜、进行理论的创造，坚持解放思想和实事求是相统一、培元固本和守正创新相统一，不断推进马克思主义基本原理同中国实际相结合，产生了毛泽东思想、邓小平理论、“三个代表”重要思想、科学发展观等重大理论创新成果，不断丰富和发展中国化的马克思主义，用与时俱进的科学理论回答了“中国向何处去、社会主义向何处去”的历史课题、时代之问。这些深深扎根于中国大地的思想成果，深刻影响着国家民族的前途命运，极大改变着中国人民的精神面貌，社会主义参天大树在世界东方根深叶茂。</p>        <h3 id="领航引领中国-影响世界的当代中国马克思主义-21世纪马克思主义"   >          <a href="#领航引领中国-影响世界的当代中国马克思主义-21世纪马克思主义" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#领航引领中国-影响世界的当代中国马克思主义-21世纪马克思主义"></a> 领航：引领中国、影响世界的当代中国马克思主义、21世纪马克思主义</h3>      <p>  “哲学把无产阶级作为自己的物质武器。同样，无产阶级也把哲学作为自己的精神武器。”从现实的此岸通向梦想的彼岸，从必然王国通向自由王国，必定依靠揭示客观规律、洞察历史大势、回应时代呼声的科学理论。</p><p>  百年大江奔流，在中华民族伟大复兴的关键时期，在当今世界动荡变革的历史变局之中，中国共产党人凭着历史的积淀、理想的坚守、开拓的勇毅，紧紧围绕新时代坚持和发展什么样的中国特色社会主义、怎样坚持和发展中国特色社会主义，推进实践的新革命、思想的新长征，结出了饱含中国精神、时代精华的硕果——习近平新时代中国特色社会主义思想。</p><p>  “中国共产党领导是中国特色社会主义最本质的特征”“坚持以人民为中心的发展思想”“推动全体人民共同富裕取得更为明显的实质性进展”“充分发挥市场在资源配置中的决定性作用，更好发挥政府作用”“坚持创新、协调、绿色、开放、共享的发展理念”“绿水青山就是金山银山”“推动构建人类命运共同体”……这些富有创见的思想、观点和论断，对马克思主义作出了原创性、时代性贡献，开拓了中国特色社会主义的新境界。</p><p>  新时代中国共产党人赋予马克思主义以鲜明的中国特色、民族特色、时代特色，使人们对共产党执政规律、社会主义建设规律、人类社会发展规律的认识达到了一个新的历史高度，使科学社会主义释放出具有强大说服力、感召力的真理光芒！</p>        <h2 id="中国制度和治理体系"   >          <a href="#中国制度和治理体系" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#中国制度和治理体系"></a> 中国制度和治理体系</h2>      <p>  从莫尔笔下的“乌托邦”，到康帕内拉书中的“太阳城”，从摩莱里苦心写就的《自然法典》，到欧文身体力行的“新和谐公社”，从只存在了72天的巴黎公社，到世界上第一个社会主义国家苏联，人类对社会主义社会和制度形态的探索从未停止。中国在社会主义道路上的制度探索和实践，成就了经济快速发展和社会长期稳定“两大奇迹”。</p><p>  中国共产党一经成立，就把建立体现社会主义原则的制度作为追求。无论是互助合作运动还是工农兵代表大会制度，无论是“三三制”还是“豆选法”，这些在革命根据地的早期实践，都蕴含着社会主义的制度因素和价值理念，为建立新型国家制度积累了宝贵经验。</p><p>  新中国成立后，我们及时把成功的实践经验转化为制度成果，使我国国家制度既体现科学社会主义基本原则，又符合中国的特殊国情。社会主义公有制、人民代表大会制度、中国共产党领导的多党合作和政治协商制度、民族区域自治制度等一系列制度逐步建立健全。</p><p>  习近平总书记深刻指出：“制度问题更带有根本性、全局性、稳定性、长期性。”“只有扎根本国土壤、汲取充沛养分的制度，才最可靠、也最管用。”</p><p>  进入新时代，我们聚焦坚持和完善中国特色社会主义制度、推进国家治理体系和治理能力现代化，在实践探索的基础上加强顶层设计和战略安排，党和国家制度建设“施工图”恢弘展开。从党的领导、人民代表大会、坚持马克思主义在意识形态领域指导地位、党对人民军队的绝对领导等根本制度，到社会主义基本经济制度、基本政治制度，再到不同领域具有创新性、支撑性的重要制度，中国特色社会主义制度体系层次分明、系统完备，各项制度更加成熟、更加定型，在国家治理中日益显现出巨大的制度效能。</p><p>  危机是制度的试金石。面对百年不遇的新冠肺炎疫情，党领导人民不惜一切代价阻断疫情传播链条，不惜一切代价抢救生命，仅用3个月左右的时间取得了武汉保卫战、湖北保卫战的决定性成果，以最快速度研制出安全有效的疫苗，在压力巨大的情况下确保了经济发展、社会稳定，并为世界各国抗击疫情提供了有力支持。中国速度、中国奇迹的背后，是人民至上、生命至上的社会主义价值理念，是同舟共济、集中力量办大事的制度优越性，是心系世界人民安危福祉的国际主义精神！</p><p>  德国政治家埃贡·克伦茨这样评价：中国应对这场全球性危机的方式方法，展示了社会主义的制度优势。资本主义世界的旧药方已经不受欢迎，重心正在发生偏移。阿根廷学者马塞洛·罗德里格斯这样写道：这场危机再次凸显了两种理念之争，一种是资本主义，将所有社会关系都商品化，倡导消费主义、个人主义、剥削和社会达尔文主义；另一种是社会主义，倡导健康、教育、文化等不是市场上可交易的商品，而是人民的权利。</p><p>  在中国特色社会主义制度下，中国人民享受着前所未有的民主、自由和人权，感受着前所未有的获得感、幸福感、安全感。中国制度和治理体系是党和人民历尽千辛万苦、付出巨大代价取得的伟大成就，矗立起人类制度文明和政治文明发展史上的一座丰碑！</p>        <h2 id="中国特色社会主义文化"   >          <a href="#中国特色社会主义文化" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#中国特色社会主义文化"></a> 中国特色社会主义文化</h2>      <p>  “文化自信是一个国家、一个民族发展中更基本、更深沉、更持久的力量。”源自于源远流长的中华优秀传统文化，熔铸于党领导人民创造的革命文化和社会主义先进文化，植根于中国特色社会主义伟大实践……历经百年，中国特色社会主义文化已经融入在中国共产党的精神血脉，时刻形塑着亿万中国人的精神气质。</p><p>  悠远的文明传承是她的基因。今年3月22日，正在福建考察的习近平总书记来到朱熹园，语重心长地指出：“如果没有中华五千年文明，哪里有什么中国特色？如果不是中国特色，哪有我们今天这么成功的中国特色社会主义道路？”五千年文明的薪火相传、生生不息，赋予了我们党百折不挠的顽强与坚韧；中华文化特有的气质和禀赋，赋予了我们党质朴刚健、艰苦奋斗的宝贵品格；华夏先人对天下大同的追求向往，赋予了我们党心系苍生、天下为公的博大胸襟。凝结着人类思想精华的马克思主义，激活了古老的华夏文明；历史上唯一一个从未中断的伟大文明，又为马克思主义在中国的发展注入丰富的养分和深厚的动力。</p><p>  威武不屈的革命精神是她的本色。在一百年来党领导人民开天辟地、改天换地、翻天覆地的进程中，不但书写了足以彪炳史册的伟大功绩，而且铸就了可歌可泣、光照千秋的伟大精神。上海兴业路的石库门，嘉兴南湖的红船，井冈山麓的八角楼，长征路上的大渡桥，大庆油田第一口油井，戈壁深处的“两弹一星”科研基地，深圳的莲花山，荆江大堤的抗洪纪念碑，汶川地震后建成的新城，旧貌换新颜的湘西十八洞村……这些早已不只是闻名中外的地理标识，更已成为中华民族不甘落后、拼搏奋斗的精神图腾。每当风雨来袭，每当挑战来临，中国人民都在精神之旅中坚定信心、鼓足勇气，凝聚起众志成城、一往无前的磅礴伟力。</p><p>  社会主义不但要提高物质生产力、也要提高精神生产力，实现现代化一个重要目标就是建成社会主义文化强国。新时代的中国，党的创新理论深入人心，社会主义核心价值观广为弘扬，文化体制改革扎实推进，文化事业、产业蓬勃发展，文明之花处处绽放。《我和我的祖国》《我和我的家乡》等电影诉说着家国的情怀，《觉醒年代》《跨过鸭绿江》《山海情》等电视剧拨动着人民的心弦，《不忘初心》《天耀中华》《沂蒙山》《大地颂歌》等主题作品传扬着时代的旋律，更有那一支支乌兰牧骑活跃在边疆草原，一支支文艺志愿小分队扎根在工厂田间，一部部作品走出国门、走向世界……这一切，构成了激荡人心的时代协奏、感动世界的中国交响。</p>        <h2 id="后记"   >          <a href="#后记" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#后记"></a> 后记</h2>      <p>  这是人民蓬勃向上的中国，这是文化繁盛绚丽的中国。中国特色社会主义文化，成为新时代中国屹立于世界民族之林的精神支柱，成为中华民族为人类贡献的文明瑰宝！</p><p>  五百年来，人类追求社会主义的路途上，有鲜花芬芳，也有荆棘密布。一百年来，中国人追求社会主义的历程中，闪耀着光荣和梦想，也充满着奋斗和牺牲，伟大的中国共产党和英雄的中国人民从未退却、从未动摇。历史雄辩地证明：中国没有辜负社会主义！</p><p>  面向未来，中国必将为人类文明进步、为世界社会主义发展作出更大贡献，让这个正义而充满前途的事业迸发出更加夺目的光芒！</p><p>  备注：转自人民日报</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h2&gt;
      
&lt;p&gt;  英国伦敦，大英博物馆，1516年出版的莫尔的《乌托邦》一书静静躺在展柜里。同时留在这座博物馆图书阅览室地板上的，是一位伟人厚重的足印。正是这位为人类解放事业奋斗终身的马克思，将社会主义从空想变为科学，从而广泛而深刻地影响了世界，也广泛而深刻地改变了中国。&lt;/p&gt;
&lt;p&gt;  中国北京，人民大会堂，习近平总书记2016年在庆祝中国共产党成立95周年大会上向世界宣示：中国共产党领导中国人民取得的伟大胜利，使具有500年历史的社会主义主张在世界上人口最多的国家成功开辟出具有高度现实性和可行性的正确道路，让科学社会主义在21世纪焕发出新的蓬勃生机。&lt;/p&gt;
&lt;p&gt;  数百年奔流激荡。曾经苦难深重，如今意气昂扬。在科学真理和崇高理想的指引下，中国大地发生历史巨变，我们无比坚定，社会主义没有辜负中国！在中国共产党领导人民的顽强奋斗中，信仰的光芒熠熠闪烁，伟大的事业青春盎然，我们无比自豪，中国没有辜负社会主义！&lt;/p&gt;</summary>
    
    
    
    <category term="随记" scheme="https://foolishfox.cn/categories/%E9%9A%8F%E8%AE%B0/"/>
    
    
    <category term="马列毛邓" scheme="https://foolishfox.cn/tags/%E9%A9%AC%E5%88%97%E6%AF%9B%E9%82%93/"/>
    
  </entry>
  
  <entry>
    <title>星座故事 | 大熊座与小熊座</title>
    <link href="https://foolishfox.cn/posts/202105-constellation1.html"/>
    <id>https://foolishfox.cn/posts/202105-constellation1.html</id>
    <published>2021-05-28T16:05:20.000Z</published>
    <updated>2021-06-22T15:49:17.066Z</updated>
    
    <content type="html"><![CDATA[        <h2 id="传说"   >          <a href="#传说" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#传说"></a> 传说</h2>      <p>  在古代希腊的神话故事中，大熊是温柔美丽的少女卡力斯托的化身。传说卡力斯托被众神之王宙斯所爱，生下了儿子阿卡斯。宙斯的妻子赫拉知道后非常气愤，她决定要用法力对卡力斯托进行惩罚，于是她把卡力斯托白暂的双臂变成了长满黑毛的利爪，娇红的双唇变成了血盆似的大口，让卡力斯托变成了一只大母熊。后来宙斯知道了，就把大熊提升到天上，成为大熊星座。</p><span id="more"></span><p>  而小熊是大熊卡力斯托的儿子阿卡斯。卡力斯托被宙斯的妻子赫拉所害变成一只大熊后，在悲哀和痛苦中度过了15个年头，这时卡力斯托的儿子阿卡斯长大了，成为一名英俊出色的猎手。一天，阿卡斯在林中打猎，被他的母亲卡力斯托看见了，她忘记了自己已经是熊身，便伸开双臂准备拥抱亲爱的孩子。但阿卡斯不知道这只大熊是自己的母亲，他急忙向大熊举起手中的长枪准备射击。幸亏宙斯，也就是阿卡斯的父亲，在天上看见了，他担心阿卡斯会杀死母亲，便用法术把阿卡斯也变成了一只小熊，并将母子俩一起都提升到天上，成为大熊座和小熊座。</p><p>  赫拉看到卡力斯托母子都被弄到天上，嫉妒之心油然而生。 她去请自己的哥哥海神波塞冬帮忙：永远不让卡力斯托母子从天上下海来休息喝水。于是，母子俩只得永远在北极上空转圈，不能下海。尽管如此，赫拉还不满足，她又选派一个猎人带着两只凶猛的猎犬，紧跟在大熊和小熊的后面。这个猎人就是天上的牧夫座，而他牵着的两只猎犬就是猎犬座，猎人和猎犬忠实执行神后赫拉交付的任务：紧紧看守着大熊和小熊，不停地追捕着。</p>        <h2 id="星空"   >          <a href="#星空" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#星空"></a> 星空</h2>      <p>  大熊座是北方天空中最明亮、最重要的星座之一,著名的北斗七星就在这个星座里。大熊座一年四季都能看到，春季黄昏后是观测它的最好时机。在星图上，大熊座的星星被想象为一只大熊，北斗七星的斗柄是大熊的长长的尾巴，斗勺的四颗星是大熊的身躯，另一些较暗的星构成了大熊的头和脚。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/1622203030.jpg"  alt="" />      </p><p>  北斗七星从勺口到柄尾依次是天枢、天璇、天玑、天权、玉衡、开阳、摇光。前四颗组成了斗身，叫做魁；后三颗组成了斗柄，叫做杓。而开阳是一个奇特的目视双星系统，伴星叫做开阳增一（也称为辅）。后续的研究发现，开阳和辅实际上就是双星系统，开阳就被分为了开阳A（大熊座<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>ζ</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">\zeta&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07378em;">ζ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>）和开阳B（大熊座<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>ζ</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\zeta&#x27;&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07378em;">ζ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>）。</p><p>  1989年光谱观测首先发现开阳A是分光双星，后来又发现开阳B也是分光双星，可能是三合星，所以开阳实际上是一个四合星甚至五合星系统。1996年通过极高分辨率的望远镜拍摄出开阳A的两颗子星A1和A2。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/20210528194950.png"  alt="" />      <br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="http://inews.gtimg.com/newsapp_match/0/8453683962/0.jpg"  alt="" />      </p><p>  小熊座的7颗星星也被称为小北斗，其中除<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">α</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">β</span></span></span></span>是较亮的2等星外，其他都是较暗的星。因此，小熊座不如北斗七星那样耀眼，在明月之夜或大城市里就不容易看到。小熊座<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">α</span></span></span></span>（勾陈一）就是现在的北极星，处于北斗七星中天枢和天璇的延长线上。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/1622201708-1-.jpg"  alt="" />      </p><p>  在大熊星座的东南方向，有两个紧挨着的“邻居”：东边的是牧夫座，西边的是猎犬座。猎犬座原先是大熊座的一部份，是北天星座中的小星座。猎犬座也是最暗的星座之一，其中只有一颗三等星。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/1622203502.jpg"  alt="" />      </p><p>  牧夫座的大角星是全天第四亮星，之所以叫做大角是因为它被看作是四象之一的东方苍龙的一只角。此外牧夫座还包括了8颗4等以上和21颗5等以上的亮星，其中几颗中等亮度的星构成了一个五边形，像个大风筝，而最亮的大角星就像挂在风筝下面的一盏明灯。5月下旬，沿着北斗七星斗柄几颗的曲线顺势延伸出去，画出一条大弧线，就可以在天顶附近的星空找到大角星。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/1622203810.png"  alt="" />      </p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;传说&quot;   &gt;
          &lt;a href=&quot;#传说&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#传说&quot;&gt;&lt;/a&gt; 传说&lt;/h2&gt;
      
&lt;p&gt;  在古代希腊的神话故事中，大熊是温柔美丽的少女卡力斯托的化身。传说卡力斯托被众神之王宙斯所爱，生下了儿子阿卡斯。宙斯的妻子赫拉知道后非常气愤，她决定要用法力对卡力斯托进行惩罚，于是她把卡力斯托白暂的双臂变成了长满黑毛的利爪，娇红的双唇变成了血盆似的大口，让卡力斯托变成了一只大母熊。后来宙斯知道了，就把大熊提升到天上，成为大熊星座。&lt;/p&gt;</summary>
    
    
    
    <category term="天文" scheme="https://foolishfox.cn/categories/%E5%A4%A9%E6%96%87/"/>
    
    
    <category term="科普" scheme="https://foolishfox.cn/tags/%E7%A7%91%E6%99%AE/"/>
    
    <category term="观星" scheme="https://foolishfox.cn/tags/%E8%A7%82%E6%98%9F/"/>
    
    <category term="星座" scheme="https://foolishfox.cn/tags/%E6%98%9F%E5%BA%A7/"/>
    
  </entry>
  
  <entry>
    <title>Termux | 安装云探针</title>
    <link href="https://foolishfox.cn/posts/202105-termux-status.html"/>
    <id>https://foolishfox.cn/posts/202105-termux-status.html</id>
    <published>2021-05-28T09:11:14.000Z</published>
    <updated>2021-06-22T15:49:17.066Z</updated>
    
    <content type="html"><![CDATA[    <div class="note-plugin info">      <span class="note-plugin__icon note-plugin__icon--info">              <i class="fas fa-info-circle"></i>            </span>      <p>有关Termux的详细教程，请查看<span class="exturl"><a class="exturl__link"   href="https://www.sqlsec.com/2018/05/termux.html" >Termux 高级终端安装使用配置教程-国光</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br />以下内容可适用于其他Linux发行版</p>    </div>          <h2 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2>      <p>  ServerStatus可以实时监控服务器的网络、负载、内存占用等信息，也被称为云探针、多服务器探针、云监控、多服务器云监控，本人追溯到最早源自于<span class="exturl"><a class="exturl__link"   href="https://github.com/BotoX" >BotoX</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>的<span class="exturl"><a class="exturl__link"   href="https://github.com/BotoX/ServerStatus" >项目</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>。</p><blockquote><p>Display and monitor your servers statistics in a beatiful way</p></blockquote><span id="more"></span><p>  后人经过多位大佬的修改、汉化和美化，已经有多个版本的ServerStatus可供部署，本文采用的是由<span class="exturl"><a class="exturl__link"   href="https://github.com/CokeMine" >CokeMine</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>开发的<span class="exturl"><a class="exturl__link"   href="https://github.com/CokeMine/ServerStatus-Hotaru" >ServerStatus-Hotaru</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>版本。</p>        <h2 id="安装"   >          <a href="#安装" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#安装"></a> 安装</h2>              <h3 id="服务端"   >          <a href="#服务端" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#服务端"></a> 服务端</h3>      <ol><li>获取文件</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/CokeMine/ServerStatus-Hotaru/master/status.sh</span><br><span class="line">chmod +x status.sh</span><br></pre></td></tr></table></div></figure><ol start="2"><li>安装服务端<br />运行<code>./status.sh s</code>，配置按推荐即可，如果服务器上有Nginx/Apache，则不需要安装Caddy，否则建议选择Y一键配置HTTP服务<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/20210528173613.png"  alt="" />      </li><li>添加客户端信息：打开<code>/usr/local/ServerStatus/server/config.json</code>，修改如下:</li></ol><figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;servers&quot;</span>:</span><br><span class="line"> [</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Fox Home&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;KVM&quot;</span>,  <span class="comment">// 现在一般云服务器都是KVM</span></span><br><span class="line">   <span class="attr">&quot;host&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;location&quot;</span>: <span class="string">&quot;杭州&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;disabled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">   <span class="attr">&quot;region&quot;</span>: <span class="string">&quot;CN&quot;</span>   <span class="comment">// region信息在文件/usr/local/ServerStatus/region.json中</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;B&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;B&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Fox Lab&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;KVM&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;host&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;location&quot;</span>: <span class="string">&quot;香港&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;disabled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;region&quot;</span>: <span class="string">&quot;HK&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ol start="4"><li>启动服务端</li></ol>        <h3 id="客户端"   >          <a href="#客户端" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#客户端"></a> 客户端</h3>      <p>  运行<code>./status.sh c</code>安装客户端，配置信息按照前文服务端配置（<code>username</code>和<code>password</code>）填写即可</p>        <h2 id="其他"   >          <a href="#其他" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#其他"></a> 其他</h2>              <h3 id="termux适配"   >          <a href="#termux适配" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#termux适配"></a> Termux适配</h3>          <div class="note-plugin warning">      <span class="note-plugin__icon note-plugin__icon--warning">              <i class="fas fa-exclamation-circle"></i>            </span>      <p>Termux端不建议按照服务端</p>    </div>  <p>  从仓库中下载<span class="exturl"><a class="exturl__link"   href="https://raw.githubusercontent.com/CokeMine/ServerStatus-Hotaru/master/clients/status-client.py" >status-client.py</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，对一下内容进行修改：</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_hdd</span>():</span></span><br><span class="line">    p = subprocess.check_output([<span class="string">&#x27;df&#x27;</span>]).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="comment"># 在终端中运行df命令，查看/data对应的那一行的行号就是X+1</span></span><br><span class="line">    total = p.splitlines()[X]</span><br><span class="line">    used = <span class="built_in">int</span>(total.split()[<span class="number">2</span>])/<span class="number">1024</span></span><br><span class="line">    size = <span class="built_in">int</span>(total.split()[<span class="number">1</span>])/<span class="number">1024</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(size), <span class="built_in">int</span>(used)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_load</span>():</span></span><br><span class="line">    p = subprocess.check_output([<span class="string">&#x27;uptime&#x27;</span>]).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">round</span>(<span class="built_in">float</span>(p.split(<span class="string">&#x27;, &#x27;</span>)[<span class="number">3</span>].split(<span class="string">&#x27;: &#x27;</span>)[<span class="number">1</span>]), <span class="number">2</span>)*<span class="number">100</span></span><br><span class="line">...</span><br></pre></td></tr></table></div></figure>        <h3 id="修改前端主题"   >          <a href="#修改前端主题" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#修改前端主题"></a> 修改前端/主题</h3>      <p>  由于前端文件已经被打包过了，所以不建议直接修改格式化打包后的js/css文件，建议自行下载修改再打包，复制dist目录到服务器。</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/CokeMine/Hotaru_theme.git</span><br><span class="line"><span class="built_in">cd</span> ./Hotaru_theme &amp;&amp; npm install</span><br><span class="line"><span class="comment"># 修改完成之后</span></span><br><span class="line">npm run build</span><br></pre></td></tr></table></div></figure>        <h3 id="windows适配"   >          <a href="#windows适配" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#windows适配"></a> Windows适配</h3>      <p>  使用<span class="exturl"><a class="exturl__link"   href="https://raw.githubusercontent.com/CokeMine/ServerStatus-Hotaru/master/clients/status-psutil.py" >Psutil版</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>即可使ServerStatus客户端在Windows等平台运行</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install psutil</span><br><span class="line"><span class="comment"># 修改status-psutil.py</span></span><br><span class="line">python status-psutil.py</span><br></pre></td></tr></table></div></figure>        <h2 id="参考资料"   >          <a href="#参考资料" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h2>      <ol><li><span class="exturl"><a class="exturl__link"   href="https://github.com/CokeMine/ServerStatus-Hotaru" >ServerStatus-Hotaru</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link"   href="https://www.cokemine.com/serverstatus-hotaru.html" >ServerStatus-Hotaru云探针的安装与配置</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link"   href="https://github.com/CokeMine/ServerStatus-Hotaru/issues/75" >想改网页内的几个字 如何操作</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>]]></content>
    
    
    <summary type="html">&lt;div class=&quot;note-plugin info&quot;&gt;
      &lt;span class=&quot;note-plugin__icon note-plugin__icon--info&quot;&gt;
              &lt;i class=&quot;fas fa-info-circle&quot;&gt;&lt;/i&gt;
            &lt;/span&gt;
      &lt;p&gt;有关Termux的详细教程，请查看&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://www.sqlsec.com/2018/05/termux.html&quot; &gt;Termux 高级终端安装使用配置教程-国光&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;&lt;br /&gt;以下内容可适用于其他Linux发行版&lt;/p&gt;
    &lt;/div&gt;
  

        &lt;h2 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h2&gt;
      
&lt;p&gt;  ServerStatus可以实时监控服务器的网络、负载、内存占用等信息，也被称为云探针、多服务器探针、云监控、多服务器云监控，本人追溯到最早源自于&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://github.com/BotoX&quot; &gt;BotoX&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;的&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://github.com/BotoX/ServerStatus&quot; &gt;项目&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Display and monitor your servers statistics in a beatiful way&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Termux" scheme="https://foolishfox.cn/categories/Termux/"/>
    
    
    <category term="安装" scheme="https://foolishfox.cn/tags/%E5%AE%89%E8%A3%85/"/>
    
    <category term="Python" scheme="https://foolishfox.cn/tags/Python/"/>
    
    <category term="ServerStatus" scheme="https://foolishfox.cn/tags/ServerStatus/"/>
    
  </entry>
  
  <entry>
    <title>博客成长日志 | 准实时访问统计</title>
    <link href="https://foolishfox.cn/posts/202105-visit.html"/>
    <id>https://foolishfox.cn/posts/202105-visit.html</id>
    <published>2021-05-19T16:09:37.000Z</published>
    <updated>2021-06-01T02:40:58.627Z</updated>
    
    <content type="html"><![CDATA[        <h2 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2>      <p>  通过百度统计、CNZZ等服务，我们可以记录站点的访问地图、访问量和来源，如果想要展示数据，可以选择直接导向服务商提供的公开页面，但是样式丑陋，所以本文通过百度统计API，使用Echarts制作站点访问准实时统计页面，效果可以参考<a href="/s/statistics/">统计</a>。</p><span id="more"></span><p>  之所以说是准实时统计，是因为为了解决跨域问题（CROS error），本文采用的方法是定时通过百度统计API将数据下载保存为json文件，放置在网站目录下（后续可能会发展为vercel api，挖坑）。不过作为个人博客，方式访问量不会很大，没有必要实时更新，目前本站设置是每隔6小时更新一次。</p>        <h2 id="数据获取"   >          <a href="#数据获取" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#数据获取"></a> 数据获取</h2>              <h3 id="百度统计"   >          <a href="#百度统计" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#百度统计"></a> 百度统计</h3>      <p>  在设置样式之前首先需要获取统计数据，使用百度账号登陆<span class="exturl"><a class="exturl__link"   href="https://tongji.baidu.com/web/welcome/login" >百度统计</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，根据<a href="#refer-4">参考资料4</a>进行操作，获取token与site_id，具体教程可以查看<a href="#refer-1">参考资料1</a>。</p>        <h3 id="下载文件"   >          <a href="#下载文件" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#下载文件"></a> 下载文件</h3>      <p>  通过6个链接，我们可以获取：一年内每日访问统计、访问地图数据、月度访问统计、来源分类统计、搜索引擎访问统计和外部链接访问统计；通过python或者nodejs都可以很方便的下载文件保存，以下为python的示例：</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time, datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始统计的日期</span></span><br><span class="line">start_date   = <span class="string">&#x27;20201218&#x27;</span></span><br><span class="line">date         = datetime.datetime.now()</span><br><span class="line"><span class="comment"># 结束统计的日期</span></span><br><span class="line">end_date     = <span class="built_in">str</span>(date.year) + (<span class="built_in">str</span>(date.month) <span class="keyword">if</span> date.month &gt; <span class="number">9</span> <span class="keyword">else</span> (<span class="string">&#x27;0&#x27;</span> + <span class="built_in">str</span>(date.month))) + (<span class="built_in">str</span>(date.day) <span class="keyword">if</span> date.day &gt; <span class="number">9</span> <span class="keyword">else</span> (<span class="string">&#x27;0&#x27;</span> + <span class="built_in">str</span>(date.day)))</span><br><span class="line"><span class="comment"># token和siteid</span></span><br><span class="line">access_token = <span class="string">&#x27;121.6e...&#x27;</span></span><br><span class="line">site_id      = <span class="string">&#x27;16******&#x27;</span></span><br><span class="line"><span class="comment"># 百度统计API</span></span><br><span class="line">dataUrl      = <span class="string">&#x27;https://openapi.baidu.com/rest/2.0/tongji/report/getData?access_token=&#x27;</span> + access_token + <span class="string">&#x27;&amp;site_id=&#x27;</span> + site_id</span><br><span class="line"><span class="comment"># 统计访问次数 PV 填写 &#x27;pv_count&#x27;，统计访客数 UV 填写 &#x27;visitor_count&#x27;，二选一</span></span><br><span class="line">metrics      = <span class="string">&#x27;pv_count&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downFile</span>(<span class="params">url, fileName, prefix=<span class="string">&#x27;/home/API/data/&#x27;</span></span>):</span></span><br><span class="line">    print(<span class="string">&#x27;downloading :&#x27;</span>, url)</span><br><span class="line">    down_res = requests.get(url)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(prefix+fileName, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(down_res.content)</span><br><span class="line">    print(<span class="string">&#x27;writing :&#x27;</span>, prefix+fileName)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访客地图</span></span><br><span class="line">downFile(dataUrl + <span class="string">&#x27;&amp;start_date=&#x27;</span> + start_date + <span class="string">&#x27;&amp;end_date=&#x27;</span> + end_date + <span class="string">&#x27;&amp;metrics=&#x27;</span> + metrics + <span class="string">&#x27;&amp;method=visit/district/a&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;map.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问趋势</span></span><br><span class="line">downFile(dataUrl + <span class="string">&#x27;&amp;start_date=&#x27;</span> + start_date + <span class="string">&#x27;&amp;end_date=&#x27;</span> + end_date + <span class="string">&#x27;&amp;metrics=&#x27;</span> + metrics + <span class="string">&#x27;&amp;method=trend/time/a&amp;gran=month&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;trends.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问来源</span></span><br><span class="line">downFile(dataUrl + <span class="string">&#x27;&amp;start_date=&#x27;</span> + start_date + <span class="string">&#x27;&amp;end_date=&#x27;</span> + end_date + <span class="string">&#x27;&amp;metrics=&#x27;</span> + metrics + <span class="string">&#x27;&amp;method=source/all/a&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;sources.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 搜索引擎</span></span><br><span class="line">downFile(dataUrl + <span class="string">&#x27;&amp;start_date=&#x27;</span> + start_date + <span class="string">&#x27;&amp;end_date=&#x27;</span> + end_date + <span class="string">&#x27;&amp;metrics=&#x27;</span> + metrics + <span class="string">&#x27;&amp;method=source/engine/a&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;engine.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 外部链接</span></span><br><span class="line">downFile(dataUrl + <span class="string">&#x27;&amp;start_date=&#x27;</span> + start_date + <span class="string">&#x27;&amp;end_date=&#x27;</span> + end_date + <span class="string">&#x27;&amp;metrics=&#x27;</span> + metrics + <span class="string">&#x27;&amp;method=source/link/a&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;link.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问日历</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">访问日历需要获取一年内的数据，按照一年365天计算，大概为52周多一点，所以前面有完整的52排，获取方式只要通过开始日期年份-1即可</span></span><br><span class="line"><span class="string">然后就是第53排的处理，python中的date.weekday()获取的星期几是0对应周一，所以通过(date.weekday()+1)%7即可转换到0对应周日</span></span><br><span class="line"><span class="string">于是在52周的基础上，减去星期数，就可以得到新的start_date</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">date       = datetime.datetime(date.year-<span class="number">1</span>, date.month, date.day)</span><br><span class="line">date       = datetime.datetime.fromtimestamp(date.timestamp()-<span class="number">3600</span>*<span class="number">24</span>*((date.weekday()+<span class="number">1</span>)%<span class="number">7</span>))</span><br><span class="line">start_date = <span class="built_in">str</span>(date.year) + (<span class="built_in">str</span>(date.month) <span class="keyword">if</span> date.month &gt; <span class="number">9</span> <span class="keyword">else</span> (<span class="string">&#x27;0&#x27;</span> + <span class="built_in">str</span>(date.month))) + (<span class="built_in">str</span>(date.day) <span class="keyword">if</span> date.day &gt; <span class="number">9</span> <span class="keyword">else</span> (<span class="string">&#x27;0&#x27;</span> + <span class="built_in">str</span>(date.day)))</span><br><span class="line">downFile(dataUrl + <span class="string">&#x27;&amp;method=overview/getTimeTrendRpt&#x27;</span> + <span class="string">&#x27;&amp;metrics=&#x27;</span> + metrics + <span class="string">&#x27;&amp;start_date=&#x27;</span> + start_date + <span class="string">&#x27;&amp;end_date=&#x27;</span> + end_date,</span><br><span class="line">    <span class="string">&#x27;calendar.json&#x27;</span>)</span><br></pre></td></tr></table></div></figure>        <h3 id="自动更新"   >          <a href="#自动更新" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#自动更新"></a> 自动更新</h3>      <p>  在Linux中可以通过<code>crontab</code>设置定时任务，以下为每整6小时的0点执行一次任务：</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0 0 * * * /usr/bin/python /home/API/data/get.py &gt;&gt; /home/API/data/get.log</span><br><span class="line">0 6 * * * /usr/bin/python /home/API/data/get.py &gt;&gt; /home/API/data/get.log</span><br><span class="line">0 12 * * * /usr/bin/python /home/API/data/get.py &gt;&gt; /home/API/data/get.log</span><br><span class="line">0 18 * * * /usr/bin/python /home/API/data/get.py &gt;&gt; /home/API/data/get.log</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">0 0,6,12,18 * * * /usr/bin/python /home/API/data/get.py &gt;&gt; /home/API/data/get.log</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">0 */6 * * * /usr/bin/python /home/API/data/get.py &gt;&gt; /home/API/data/get.log</span><br></pre></td></tr></table></div></figure>        <h2 id="数据展示"   >          <a href="#数据展示" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#数据展示"></a> 数据展示</h2>              <h3 id="统计图容器"   >          <a href="#统计图容器" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#统计图容器"></a> 统计图容器</h3>      <p>  在html代码中插入：</p><figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/echarts@4.7.0/dist/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/echarts@4.7.0/map/js/china.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 90%;margin: 0 auto;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;calendar_container&quot;</span> <span class="attr">class</span>=<span class="string">&quot;data-container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;map_container&quot;</span> <span class="attr">class</span>=<span class="string">&quot;data-container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 500px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;trends_container&quot;</span> <span class="attr">class</span>=<span class="string">&quot;data-container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 350px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;sources_container&quot;</span> <span class="attr">class</span>=<span class="string">&quot;data-container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 450px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/calendar.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/census.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></div></figure>        <h3 id="访问日历"   >          <a href="#访问日历" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#访问日历"></a> 访问日历</h3>      <p>  访问日历类似于Github贡献日历，有两种方法实现。</p><ol><li>源自于<span class="exturl"><a class="exturl__link"   href="https://zfe.space/post/hexo-githubcalendar.html" >hexo-githubcalendar 插件</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，由<span class="exturl"><a class="exturl__link"   href="https://blog.eurkon.com/" >Eurkon</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>修改，原文见<a href="#refer-3">参考资料3</a>。点击<span class="exturl"><a class="exturl__link"   href="https://github.com/YiHui-Liu/Fox-Home-CDN/blob/5eadc9f050b9d759dc14786085253b000049b7de/calendar.js" >链接</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>下载<code>calendar.js</code>文件，需要修改的地方有：</li></ol><figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 下面的链接是本站点的访问数据，需要修改为自己的，为了防止浏览器缓存的干扰，在url后添加了时间戳，可以进一步优化为时间的小时数对6取模</span></span><br><span class="line">fetch(<span class="string">&#x27;https://api.foolishfox.cn/data/calendar.json?date&#x27;</span>+<span class="keyword">new</span> <span class="built_in">Date</span>()).then(<span class="function"><span class="params">data</span> =&gt;</span> data.json()).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 统计访问次数 PV 填写 &#x27;pv_count&#x27;，统计访客数 UV 填写 &#x27;visitor_count&#x27;，二选一</span></span><br><span class="line">visit_calendar(<span class="string">&#x27;pv_count&#x27;</span>, visit_color);</span><br><span class="line">...</span><br></pre></td></tr></table></div></figure><p>  另外，需要更改容器id可以直接搜索替换即可。</p><ol start="2"><li>通过<span class="exturl"><a class="exturl__link"   href="https://cdn.jsdelivr.net/gh/YiHui-Liu/Fox-Home-CDN/census.js" >census.js</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>进行设置，包括后续的访问地图、访问趋势（访问次数）和访问来源都是基于此文件通过Echarts实现的。</li></ol><figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 统计访问次数 PV 填写 &#x27;pv_count&#x27;，统计访客数 UV 填写 &#x27;visitor_count&#x27;，二选一</span></span><br><span class="line"><span class="keyword">var</span> metrics     = <span class="string">&#x27;pv_count&#x27;</span></span><br><span class="line"><span class="keyword">var</span> metricsName = (metrics === <span class="string">&#x27;pv_count&#x27;</span> ? <span class="string">&#x27;访问次数&#x27;</span> : (metrics === <span class="string">&#x27;visitor_count&#x27;</span> ? <span class="string">&#x27;访客数&#x27;</span> : <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calChart</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">&quot;script&quot;</span>)</span><br><span class="line">    <span class="comment">// 下面的链接是本站点的访问数据，需要修改为自己的，为了防止浏览器缓存的干扰，在url后添加了时间戳，可以进一步优化为时间的小时数对6取模</span></span><br><span class="line">    fetch(<span class="string">&#x27;https://api.foolishfox.cn/data/calendar.json?date&#x27;</span>+<span class="keyword">new</span> <span class="built_in">Date</span>()).then(<span class="function"><span class="params">data</span> =&gt;</span> data.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// 颜色盒，用于设置不同数据的展示颜色，可更改</span></span><br><span class="line">        <span class="keyword">let</span> colorBox = [<span class="string">&#x27;#EBEDF0&#x27;</span>, <span class="string">&#x27;#FFE9BB&#x27;</span>, <span class="string">&#x27;#FFD1A7&#x27;</span>, <span class="string">&#x27;#FFBB95&#x27;</span>, <span class="string">&#x27;#FFA383&#x27;</span>, <span class="string">&#x27;#FF8D70&#x27;</span>, <span class="string">&#x27;#FF745C&#x27;</span>, <span class="string">&#x27;#FF5C4A&#x27;</span>, <span class="string">&#x27;#FF4638&#x27;</span>, <span class="string">&#x27;#FF2E26&#x27;</span>, <span class="string">&#x27;#FF1812&#x27;</span>];</span><br></pre></td></tr></table></div></figure>        <h3 id="访问地图"   >          <a href="#访问地图" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#访问地图"></a> 访问地图</h3>      <p>  最简单的就是访问地图，直接修改json文件的请求url即可：</p><figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 访问地图</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapChart</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">&quot;script&quot;</span>)</span><br><span class="line">    <span class="comment">// 下面的链接是本站点的访问数据，需要修改为自己的，为了防止浏览器缓存的干扰，在url后添加了时间戳，可以进一步优化为时间的小时数对6取模</span></span><br><span class="line">    fetch(<span class="string">&#x27;https://api.foolishfox.cn/data/map.json?date&#x27;</span>+<span class="keyword">new</span> <span class="built_in">Date</span>()).then(<span class="function"><span class="params">data</span> =&gt;</span> data.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br></pre></td></tr></table></div></figure>        <h3 id="访问趋势"   >          <a href="#访问趋势" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#访问趋势"></a> 访问趋势</h3>      <p>  访问趋势中按照年份，将12个月的数据展开，需要从json中获取到年份和月份信息，由于时间日期格式是固定的，所以可以直接截取。本部分代码以下列展示的为准：</p><figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取年份和月份</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_year</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">parseInt</span>(s.substr(<span class="number">0</span>, <span class="number">4</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_month</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">parseInt</span>(s.substr(<span class="number">5</span>, <span class="number">2</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 访问趋势</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trendsChart</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">&quot;script&quot;</span>)</span><br><span class="line">    <span class="comment">// 下面的链接是本站点的访问数据，需要修改为自己的，为了防止浏览器缓存的干扰，在url后添加了时间戳，可以进一步优化为时间的小时数对6取模</span></span><br><span class="line">    fetch(<span class="string">&#x27;https://api.foolishfox.cn/data/trends.json?date&#x27;</span>+<span class="keyword">new</span> <span class="built_in">Date</span>()).then(<span class="function"><span class="params">data</span> =&gt;</span> data.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="keyword">let</span> monthValueArr = &#123;&#125;;</span><br><span class="line">        <span class="keyword">let</span> monthName = data.result.items[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">let</span> monthValue = data.result.items[<span class="number">1</span>];</span><br><span class="line">        <span class="comment">// 2020是起始年份，改为你自己的</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i =<span class="number">2020</span>; i &lt;= date.getFullYear(); i++)   monthValueArr[<span class="built_in">String</span>(i)] = [ ,  ,  ,  ,  ,  ,  ,  ,  ,  ,  ,  ];</span><br><span class="line">        monthValueArr</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; monthName.length; i++) &#123;</span><br><span class="line">            <span class="keyword">let</span> year = get_year(monthName[i][<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">let</span> month = get_month(monthName[i][<span class="number">0</span>]);</span><br><span class="line">            monthValueArr[<span class="built_in">String</span>(year)][<span class="built_in">String</span>(month-<span class="number">1</span>)] = monthValue[i][<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 以后每过一年，需要手动添加以下legend和series</span></span><br><span class="line">        script.innerHTML = <span class="string">`</span></span><br><span class="line"><span class="string">        var trendsChart = echarts.init(document.getElementById(&#x27;trends_container&#x27;), &#x27;light&#x27;);</span></span><br><span class="line"><span class="string">        var trendsOption = &#123;</span></span><br><span class="line"><span class="string">            title: &#123; text: &#x27;访问趋势&#x27;, x: &#x27;center&#x27; &#125;,</span></span><br><span class="line"><span class="string">            tooltip: &#123; trigger: &#x27;axis&#x27; &#125;,</span></span><br><span class="line"><span class="string">            legend: &#123; data: [&#x27;2020&#x27;, &#x27;2021&#x27;], x: &#x27;right&#x27; &#125;,</span></span><br><span class="line"><span class="string">            xAxis: &#123;</span></span><br><span class="line"><span class="string">                name: &#x27;日期&#x27;, type: &#x27;category&#x27;, boundaryGap: false,</span></span><br><span class="line"><span class="string">                data: [&#x27;一月&#x27;, &#x27;二月&#x27;, &#x27;三月&#x27;, &#x27;四月&#x27;, &#x27;五月&#x27;, &#x27;六月&#x27;, &#x27;七月&#x27;, &#x27;八月&#x27;, &#x27;九月&#x27;, &#x27;十月&#x27;, &#x27;十一月&#x27;, &#x27;十二月&#x27;]</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">            yAxis: &#123; name: &#x27;<span class="subst">$&#123;metricsName&#125;</span>&#x27;, type: &#x27;value&#x27; &#125;,</span></span><br><span class="line"><span class="string">            series: [</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                    name: &#x27;2020&#x27;, type: &#x27;line&#x27;, smooth: true,</span></span><br><span class="line"><span class="string">                    data: [<span class="subst">$&#123;monthValueArr[<span class="string">&quot;2020&quot;</span>]&#125;</span>],</span></span><br><span class="line"><span class="string">                    markLine: &#123; data: [&#123;type: &#x27;average&#x27;, name: &#x27;平均值&#x27;&#125;] &#125;</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                    name: &#x27;2021&#x27;, type: &#x27;line&#x27;, smooth: true,</span></span><br><span class="line"><span class="string">                    data: [<span class="subst">$&#123;monthValueArr[<span class="string">&quot;2021&quot;</span>]&#125;</span>],</span></span><br><span class="line"><span class="string">                    markLine: &#123; data: [&#123;type: &#x27;average&#x27;, name: &#x27;平均值&#x27;&#125;] &#125;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            ]</span></span><br><span class="line"><span class="string">        &#125;;</span></span><br><span class="line"><span class="string">        trendsChart.setOption(trendsOption);</span></span><br><span class="line"><span class="string">        window.addEventListener(&quot;resize&quot;, () =&gt; &#123; </span></span><br><span class="line"><span class="string">            trendsChart.resize();</span></span><br><span class="line"><span class="string">        &#125;);`</span></span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">&#x27;trends_container&#x27;</span>).after(script);</span><br><span class="line">    &#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h3 id="访问来源"   >          <a href="#访问来源" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#访问来源"></a> 访问来源</h3>      <p>  留在最后的是最复杂的访问来源，实际上百度的全部来源(<code>source/all/a</code>)API可以将来源分为：直达、外部链接和搜索引擎三个部分，直接使用并不困难。但是百度统计会将必应（<code>cn.bing.com</code>和<code>www.bing.com</code>）的来源归类到外部链接而不是搜索引擎，而且我自己还想统计来自于Github、十年之约等网站的流量，所以需要获取多个数据文件。</p><figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 下面的链接是本站点的访问数据，需要修改为自己的，为了防止浏览器缓存的干扰，在url后添加了时间戳，可以进一步优化为时间的小时数对6取模</span></span><br><span class="line">fetch(<span class="string">&#x27;https://api.foolishfox.cn/data/sources.json?date&#x27;</span>+<span class="keyword">new</span> <span class="built_in">Date</span>()).then(<span class="function"><span class="params">data</span> =&gt;</span> data.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> sourcesName = data.result.items[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> sourcesValue = data.result.items[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">let</span> sourcesArr = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; sourcesName.length; i++)</span><br><span class="line">        sourcesArr.push(&#123; <span class="attr">name</span>: sourcesName[i][<span class="number">0</span>].name, <span class="attr">value</span>: sourcesValue[i][<span class="number">0</span>] &#125;);</span><br><span class="line">    <span class="comment">// 记录总体数据，方便后续调用（使用var定义在fetch外面）</span></span><br><span class="line">    link = sourcesArr[<span class="number">1</span>][<span class="string">&#x27;value&#x27;</span>] ;</span><br><span class="line">    search = sourcesArr[<span class="number">2</span>][<span class="string">&#x27;value&#x27;</span>];</span><br><span class="line">    direct = sourcesArr[<span class="number">0</span>][<span class="string">&#x27;value&#x27;</span>];</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 下面的链接是本站点的访问数据，需要修改为自己的，为了防止浏览器缓存的干扰，在url后添加了时间戳，可以进一步优化为时间的小时数对6取模</span></span><br><span class="line">fetch(<span class="string">&#x27;https://api.foolishfox.cn/data/link.json?date&#x27;</span>+<span class="keyword">new</span> <span class="built_in">Date</span>()).then(<span class="function"><span class="params">data</span> =&gt;</span> data.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> linksName = data.result.items[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> linksValue = data.result.items[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">let</span> linksArr = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; linksName.length; i++)</span><br><span class="line">        linksArr[linksName[i][<span class="number">0</span>].name] = linksValue[i][<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// 除必应外，其他的都是自己想要统计的网站，都是http链接</span></span><br><span class="line">    <span class="keyword">let</span> sum = data.result.sum[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> bing = linksArr[<span class="string">&#x27;http://cn.bing.com&#x27;</span>]+linksArr[<span class="string">&#x27;http://www.bing.com&#x27;</span>];</span><br><span class="line">    <span class="keyword">let</span> github = linksArr[<span class="string">&#x27;http://github.com&#x27;</span>];</span><br><span class="line">    <span class="keyword">let</span> travel = linksArr[<span class="string">&#x27;http://travellings.now.sh&#x27;</span>]+linksArr[<span class="string">&#x27;http://travellings.vercel.app&#x27;</span>]+linksArr[<span class="string">&#x27;http://www.foreverblog.cn&#x27;</span>];</span><br><span class="line">    innerHTML += <span class="string">`</span></span><br><span class="line"><span class="string">                    &#123;value: <span class="subst">$&#123;bing&#125;</span>, name: &#x27;必应&#x27;&#125;,</span></span><br><span class="line"><span class="string">                    &#123;value: <span class="subst">$&#123;direct&#125;</span>, name: &#x27;直达&#x27;&#125;,</span></span><br><span class="line"><span class="string">                    &#123;value: <span class="subst">$&#123;github&#125;</span>, name: &#x27;Github&#x27;&#125;,</span></span><br><span class="line"><span class="string">                    &#123;value: <span class="subst">$&#123;travel&#125;</span>, name: &#x27;开往/十年之约&#x27;&#125;,`</span>+</span><br><span class="line">                    <span class="comment">// 将来自于必应的访问减去</span></span><br><span class="line">                    <span class="string">`&#123;value: <span class="subst">$&#123;sum-bing-github-travel+<span class="number">65</span>&#125;</span>, name: &#x27;其他&#x27;&#125;</span></span><br><span class="line"><span class="string">                ]</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                name: &#x27;访问来源&#x27;, type: &#x27;pie&#x27;, selectedMode: &#x27;single&#x27;, radius: [0, &#x27;30%&#x27;],</span></span><br><span class="line"><span class="string">                label: &#123; position: &#x27;inner&#x27;, fontSize: 14&#125;,</span></span><br><span class="line"><span class="string">                labelLine: &#123; show: false &#125;,</span></span><br><span class="line"><span class="string">                data: [`</span>+</span><br><span class="line">                    <span class="comment">// 将来自于必应的访问从外链中减去，加入搜索中</span></span><br><span class="line">                    <span class="string">`&#123;value: <span class="subst">$&#123;search+bing&#125;</span>, name: &#x27;搜索&#x27;, itemStyle: &#123; color : &#x27;green&#x27; &#125;&#125;,</span></span><br><span class="line"><span class="string">                    &#123;value: <span class="subst">$&#123;direct&#125;</span>, name: &#x27;直达&#x27;, itemStyle: &#123; color : &#x27;#FFDB5C&#x27; &#125;&#125;,</span></span><br><span class="line"><span class="string">                    &#123;value: <span class="subst">$&#123;link-bing&#125;</span>, name: &#x27;外链&#x27;, itemStyle: &#123; color : &#x27;#32C5E9&#x27; &#125;&#125;</span></span><br><span class="line"><span class="string">                ]</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></div></figure>        <h2 id="qa"   >          <a href="#qa" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#qa"></a> Q&amp;A</h2>      <ol><li><p>不想使用python下载文件保存，想要实时统计<br />根据<a href="#refer-2">参考资料2</a>中4.3节——自建 Vercel API（可选）进行设置，替换上述文件中的url即可</p></li><li><p>依然出现跨域问题？<br />请务必保证通过2.2节获取的文件保存在博客的网站目录下，并通过url可以访问；如果想要向我一样通过其他域名（例如<code>api.foolishfox.cn/data/*.json</code>）访问，需要对服务器进行设置，以Nginx为例：</p></li></ol><figure class="highlight nginx"><figcaption><span>configuration</span></figcaption><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#data CROS</span></span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ ^/data/</span> &#123;</span><br><span class="line">    <span class="attribute">if</span> ($http_origin <span class="regexp">~* (http://localhost:4000|https://foolishfox.cn))</span> &#123;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="string">&quot;$http_origin&quot;</span>;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span> <span class="string">&#x27;GET, POST, OPTIONS&#x27;</span>;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span> <span class="string">&#x27;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ol start="3"><li><p>地图显示错误<br />务必注意，Echarts目前已经不提供地图js/json文件的下载，所以要通过npm获取到旧版本中的<code>China.js</code>文件，因此Echarts的版本最好也保持一致</p></li><li><p>Echarts绘制的访问日历无法自动适应窗口大小<br />正在积极解决中…</p></li></ol>        <h2 id="更新"   >          <a href="#更新" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#更新"></a> 更新</h2>      <ol><li>2021.6.1：访问趋势中第23行代码应改为：</li></ol><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">monthValueArr[<span class="built_in">String</span>(year)][<span class="built_in">String</span>(month-<span class="number">1</span>)] = monthValue[i][<span class="number">0</span>] === <span class="string">&#x27;--&#x27;</span> ? <span class="number">0</span> : monthValue[i][<span class="number">0</span>];</span><br></pre></td></tr></table></div></figure>        <h2 id="参考资料"   >          <a href="#参考资料" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h2>      <p><span id="refer-1">1. <span class="exturl"><a class="exturl__link"   href="https://blog.eurkon.com/post/ef1da941.html" >Hexo 博客访问统计图</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-2">2. <span class="exturl"><a class="exturl__link"   href="https://blog.eurkon.com/post/61763977.html" >Hexo 博客实时访问统计图</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-3">3. <span class="exturl"><a class="exturl__link"   href="https://blog.eurkon.com/post/1a169b5a.html" >Hexo 博客访问日历图</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-4">4. <span class="exturl"><a class="exturl__link"   href="https://tongji.baidu.com/api/manual/" >百度统计用户手册</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-5">5. <span class="exturl"><a class="exturl__link"   href="https://echarts.apache.org/examples/zh/index.html" >Echarts文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h2&gt;
      
&lt;p&gt;  通过百度统计、CNZZ等服务，我们可以记录站点的访问地图、访问量和来源，如果想要展示数据，可以选择直接导向服务商提供的公开页面，但是样式丑陋，所以本文通过百度统计API，使用Echarts制作站点访问准实时统计页面，效果可以参考&lt;a href=&quot;/s/statistics/&quot;&gt;统计&lt;/a&gt;。&lt;/p&gt;</summary>
    
    
    
    <category term="博客成长日志" scheme="https://foolishfox.cn/categories/%E5%8D%9A%E5%AE%A2%E6%88%90%E9%95%BF%E6%97%A5%E5%BF%97/"/>
    
    
    <category term="Hexo" scheme="https://foolishfox.cn/tags/Hexo/"/>
    
    <category term="Echarts" scheme="https://foolishfox.cn/tags/Echarts/"/>
    
    <category term="百度统计" scheme="https://foolishfox.cn/tags/%E7%99%BE%E5%BA%A6%E7%BB%9F%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>Yourls : 短链接生成器与短域名获取</title>
    <link href="https://foolishfox.cn/posts/202105-yourls.html"/>
    <id>https://foolishfox.cn/posts/202105-yourls.html</id>
    <published>2021-05-14T15:01:00.000Z</published>
    <updated>2021-06-22T15:49:17.066Z</updated>
    
    <content type="html"><![CDATA[        <h2 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2>      <p>  你是否遇到过这样的场景？你有一个链接，例如<code>https://arxiv.org/abs/2104.14228</code>，需要分享给朋友，这个链接长而且不好记忆，需要经常用到的时候也不方便，假设你需要发微博，由于字数限制，链接长度越短越好，这时候如果有一个链接<code>https://ffox.ml/grid02</code>经过重定向可以指向前文的网址，那边就会很美观且方便，而这就需要用到短链接生成技术。</p><span id="more"></span><p>  其实短链接的作用主要在于数据统计、控制访问、便于管理。另外相同的页面，短链接与原链接生成的二维码的复杂度也大大不同。目前市面上主要的短链接服务可以参考：<span class="exturl"><a class="exturl__link"   href="https://sina.lt/why.php" >短网址服务，我们该怎么选？</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，其中安照优先级介绍了部分优质的服务提供商。</p><p>  除了使用服务商提供的短链接生成服务外，我们其实还可以自己搭建一个这样的服务。原理很简单，通过某种算法将长链接<code>A</code>转化为一个短字符串<code>B</code>，浏览器结合域名<code>C</code>访问<code>C/B</code>，服务器响应跳转至<code>A</code>，并在过程中完成数据的统计。目前有很多开源的短链接服务，其中之一就是今天的主角<code>Yourls</code>。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/1621008545.png"  alt="" />      </p>        <h2 id="yourls"   >          <a href="#yourls" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#yourls"></a> Yourls</h2>      <blockquote><p>YOURLS stands for Your Own URL Shortener. It is a small set of PHP scripts that will allow you to run your own URL shortening service (a la TinyURL or Bitly).<br />Running your own URL shortener is fun, geeky and useful: you own your data and do not depend on third-party services. It is also a great way to add branding to your short URLs, instead of using the same public URL shortener everyone uses.</p></blockquote><p>  <code>Yourls</code>的特性是开源免费，可以管理、统计每一个短链接的数量，提供API接口，而且具有众多插件，便于进行二次开发，下面就一起搭建一个自己的软链接服务。</p>        <h3 id="准备"   >          <a href="#准备" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#准备"></a> 准备</h3>      <p>  <code>Yourls</code>是基于PHP和MySQL开发的，所以需要提前准备好：</p><ul><li>Apache（2.4版本及以上）或Nginx服务器</li><li>PHP（7.4版本及以上）</li><li>MySQL（5.0版本及以上）</li></ul><p>  另外如果需要使用API接口，还需要安装PHP <span class="exturl"><a class="exturl__link"   href="https://www.php.net/curl" >cURL</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>拓展。</p>        <h3 id="安装"   >          <a href="#安装" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#安装"></a> 安装</h3>              <h4 id="下载"   >          <a href="#下载" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#下载"></a> 下载</h4>      <p>  从<span class="exturl"><a class="exturl__link"   href="https://github.com/YOURLS/YOURLS/releases" >Releases</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>下载最新版本的安装包，目前使用的是1.8.1版本，并解压至工作目录</p>        <h4 id="配置文件"   >          <a href="#配置文件" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#配置文件"></a> 配置文件</h4>      <p>  将<code>user</code>目录下的<code>config-sample.php</code>复制备份命名为<code>config.php</code>，修改配置如下，更多设置请参考<span class="exturl"><a class="exturl__link"   href="https://yourls.org/#Config" >Config</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据库配置</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_DB_USER&#x27;</span>, <span class="string">&#x27;yourls&#x27;</span> );   <span class="comment">//用户名</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_DB_PASS&#x27;</span>, <span class="string">&#x27;xxxxxxxx&#x27;</span> );   <span class="comment">//密码</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_DB_NAME&#x27;</span>, <span class="string">&#x27;yourls&#x27;</span> );   <span class="comment">//数据库名</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_DB_HOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span> );   <span class="comment">//地址</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_DB_PREFIX&#x27;</span>, <span class="string">&#x27;yourls_&#x27;</span> );   <span class="comment">//表前缀</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 站点设置</span></span><br><span class="line"><span class="comment">#设置站点</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_SITE&#x27;</span>, <span class="string">&#x27;http://ozh.in&#x27;</span> );   <span class="comment">//域名</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_LANG&#x27;</span>, <span class="string">&#x27;&#x27;</span> );   <span class="comment">//语言</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_UNIQUE_URLS&#x27;</span>, <span class="literal">true</span> );   <span class="comment">//是否允许长链接对应多个短链接</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_HOURS_OFFSET&#x27;</span>, <span class="string">&#x27;-5&#x27;</span> );   <span class="comment">//时区偏移</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_PRIVATE&#x27;</span>, <span class="string">&#x27;true&#x27;</span> );   <span class="comment">//是否私有，如果私有的，则api接口需要传递用户名和密码，如果公开，则可以自由访问后台</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_COOKIEKEY&#x27;</span>, <span class="string">&#x27;modify this text with something random&#x27;</span> );   <span class="comment">//设置cookie，可访问http://yourls.org/cookie生成</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户设置</span></span><br><span class="line"><span class="variable">$yourls_user_passwords</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;password&#x27;</span>,   <span class="comment">//用户名=&gt;密码，可填多个，登录成功后这里的明文密码会被加密</span></span><br><span class="line">    );</span><br><span class="line">define( <span class="string">&#x27;YOURLS_DEBUG&#x27;</span>, <span class="literal">false</span> );   <span class="comment">//是否开启调试</span></span><br><span class="line">define( <span class="string">&#x27;YOURLS_URL_CONVERT&#x27;</span>, <span class="number">62</span> );   <span class="comment">//短链接字符串使用36进制或2进制，建议62进制</span></span><br><span class="line"><span class="variable">$yourls_reserved_URL</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;porn&#x27;</span>, <span class="string">&#x27;faggot&#x27;</span>, <span class="string">&#x27;sex&#x27;</span>, <span class="string">&#x27;nigger&#x27;</span>, <span class="string">&#x27;fuck&#x27;</span>, <span class="string">&#x27;cunt&#x27;</span>, <span class="string">&#x27;dick&#x27;</span>,   <span class="comment">//黑名单</span></span><br><span class="line">);</span><br></pre></td></tr></table></div></figure>        <h4 id="服务器设置"   >          <a href="#服务器设置" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#服务器设置"></a> 服务器设置</h4>      <ol><li>Apache<br />需要开启<code>mod_rewrite</code>模块，编辑<span class="exturl"><a class="exturl__link"   href="https://github.com/YOURLS/YOURLS/wiki/.htaccess" >.htaccess</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>文件：</li></ol><figure class="highlight apache"><figcaption><span>configuration</span></figcaption><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根目录http://yoursite/</span></span><br><span class="line"><span class="comment"># BEGIN YOURLS</span></span><br><span class="line"><span class="section">&lt;IfModule mod_rewrite.c&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteEngine</span></span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">RewriteBase</span> /</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;REQUEST_FILENAME&#125;</span> !-f</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;REQUEST_FILENAME&#125;</span> !-d</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteRule</span></span> ^.*$ /yourls-loader.php<span class="meta"> [L]</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br><span class="line"><span class="comment"># END YOURLS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 二级目录http://yoursite/somedir/</span></span><br><span class="line"><span class="comment"># BEGIN YOURLS</span></span><br><span class="line"><span class="section">&lt;IfModule mod_rewrite.c&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteEngine</span></span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">RewriteBase</span> /somedir/</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;REQUEST_FILENAME&#125;</span> !-f</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;REQUEST_FILENAME&#125;</span> !-d</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteRule</span></span> ^.*$ /somedir/yourls-loader.php<span class="meta"> [L]</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br><span class="line"><span class="comment"># END YOURLS</span></span><br></pre></td></tr></table></div></figure><ol start="2"><li>Nginx<br />请注意宝塔用户安照<span class="exturl"><a class="exturl__link"   href="https://github.com/YOURLS/YOURLS/wiki/Nginx-configuration" >文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>中的操作可能无效，可以更改为：</li></ol><figure class="highlight nginx"><figcaption><span>configuration</span></figcaption><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># HTTP over IPv4 &amp; IPv6</span></span><br><span class="line">  <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">  <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># HTTPS over IPv4 &amp; IPv6</span></span><br><span class="line">  <span class="comment"># MUST BE EDITED TO REFLECT YOUR CONFIGURATION</span></span><br><span class="line">  <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">  <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl;</span><br><span class="line">  <span class="attribute">ssl_certificate</span>     example.com.crt;</span><br><span class="line">  <span class="attribute">ssl_certificate_key</span> example.com.key;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Server names</span></span><br><span class="line">  <span class="comment"># MUST BE EDITED TO REFLECT YOUR CONFIGURATION</span></span><br><span class="line">  <span class="attribute">server_name</span> example.com www.example.com;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Root directory</span></span><br><span class="line">  <span class="comment"># MUST BE EDITED TO REFLECT YOUR CONFIGURATION</span></span><br><span class="line">  <span class="attribute">root</span> /path/to/yourls/files;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 更改部分在这里！！！</span></span><br><span class="line">  <span class="comment"># 更改部分在这里！！！</span></span><br><span class="line">  <span class="comment"># 更改部分在这里！！！</span></span><br><span class="line">  <span class="attribute">location</span> /  </span><br><span class="line">  &#123;  </span><br><span class="line">    <span class="attribute">if</span> (!-f $request_filename)&#123;</span><br><span class="line">      <span class="attribute">set</span> $rule_0 <span class="number">1</span>$rule_0;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">if</span> (!-d $request_filename)&#123;</span><br><span class="line">      <span class="attribute">set</span> $rule_0 <span class="number">2</span>$rule_0;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">if</span> ($rule_0 = <span class="string">&quot;21&quot;</span>)&#123;</span><br><span class="line">      <span class="attribute">rewrite</span><span class="regexp"> ^/.*$</span> /yourls-loader.php <span class="literal">last</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># PHP engine</span></span><br><span class="line">  <span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">    <span class="attribute">include</span> fastcgi.conf;</span><br><span class="line">    <span class="comment"># OR</span></span><br><span class="line">    <span class="comment"># include fastcgi_params;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># MUST BE EDITED TO REFLECT YOUR CONFIGURATION</span></span><br><span class="line">    <span class="attribute">fastcgi_pass</span> unix:/var/run/php/php7.2-fpm.sock;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="安装-2"   >          <a href="#安装-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#安装-2"></a> 安装</h4>      <p>  访问<code>http://domain.com/admin</code>完成初安装，输入配置文件设置的账号、密码登陆后台。如果安装出错，可能是PHP或者MySQL版本不符合要求，或者是数据库初始化失败，可以按照<a href="#refer-3">参考资料3</a>进行解决。</p>        <h2 id="短域名"   >          <a href="#短域名" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#短域名"></a> 短域名</h2>      <p>  短链接最重要的还是根域名要短，但是以<code>.com</code>、<code>.cn</code>、<code>.org</code>、<code>.top</code>、<code>.xyz</code>等常见一级域名的短域名基本已经抢注完成，剩下的价格也很昂贵。为了减小这个问题带来的影响，有两种解决方案。</p>        <h3 id="付费域名"   >          <a href="#付费域名" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#付费域名"></a> 付费域名</h3>      <p>  在我国的<code>.cn</code>域名下有一类特殊的二级域名：按照国家各个省级行政区划分的行政区划域名，例如<code>bj.cn</code>代表北京，<code>sh.cn</code>代表上海等。这些域名注册比较少，一些比较短的域名（例如<code>fox.hn.cn</code>，湖南）很有可能没有被注册，而且价格很便宜。目前<span class="exturl"><a class="exturl__link"   href="https://www.west.cn/" >西部数码</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="https://www.diymysite.com/" >域趣网络</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>等都提供这一类域名的注册。</p>        <h3 id="免费域名"   >          <a href="#免费域名" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#免费域名"></a> 免费域名</h3>      <p>  <span class="exturl"><a class="exturl__link"   href="https://www.freenom.com/" >Freenom</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>是国际著名的免费域名提供商，可以提供<code>.tk</code>（托克劳）、<code>.ml</code>（马里）、<code>.ga</code>（加蓬）、<code>.cf</code>（中非共和国）、<code>.gq</code>（赤道几内亚）等国家一级域名，除特殊域名（少于4个字母，特殊含义等）外均可免费获取。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/20210515005206.png"  alt="" />      <br />  在Freenom获取免费域名有几个需要注意的地方：</p><ol><li>需要科学上网</li><li>注册账号时，填写的地址信息一定要与科学上网后的IP地址保持一致，最好在美国!最好在美国!最好在美国!</li><li>点击上图的<code>现在获取</code>会显示不可用，此时你只需要在搜索框中输入<code>ffox.ga</code>就可以解决，自动帮你添加购物车<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/1621011489-1-.png"  alt="" />      <br />  更多的教程与介绍可以查看下面的视频。</li></ol><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;">    <iframe src="//player.bilibili.com/player.html?aid=80621564&bvid=BV1zJ411W7p3&cid=137972479&page=1&high_quality=1"  scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; left: 0; top: 0;"></iframe></div>        <h2 id="拓展与配置"   >          <a href="#拓展与配置" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#拓展与配置"></a> 拓展与配置</h2>      <p>  <code>Yourls</code>具有丰富的插件和主题，还有各种语言的翻译包，所有的插件都能在<span class="exturl"><a class="exturl__link"   href="https://github.com/YOURLS/awesome-yourls" >awesome-yourls</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>找到介绍与项目地址。下面介绍一些我使用的拓展。</p>        <h3 id="插件"   >          <a href="#插件" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#插件"></a> 插件</h3>      <ol><li><p>Allow Hyphens in Short URLs<br />  自带的插件，允许短链接中出现连字符</p></li><li><p>Random ShortURLs<br />  默认情况下，短链接按照顺序生成，从1开始，但是更好的方式是使用时间戳或随机字符串，这一个插件就可以随机生成短链接字符串，还可以设置字符串的长度。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/1621045278-1-.png"  alt="" />      </p></li><li><p>Cache stat pages<br />  后台查看统计报表的数据都是实时统计的，此插件可以将缓存统计报表，加快访问速度</p></li><li><p>YOURLS Static Titles<br />  当你输入一个长链接生成短链时，YOURLS会抓取长链接对应页面的标题信息，所以创建短链接的速度会受到页面访问速度的影响，此插件可以经过设置跳过抓取标题，加快生成速度。除了这一种方案以外，还可以根据<a href="#refer-4">参考资料4</a>进行配置。</p></li></ol>        <h3 id="翻译"   >          <a href="#翻译" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#翻译"></a> 翻译</h3>      <p>  下载<span class="exturl"><a class="exturl__link"   href="https://github.com/ZvonimirSun/YOURLS-zh_CN" >汉化包</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>中的<code>zh_CN.mo</code>文件，移动至<code>/user/languages</code>文件夹下，设置配置文件中的语言为<code>zh_CN</code>即可。</p>        <h3 id="主题"   >          <a href="#主题" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#主题"></a> 主题</h3>      <p>  目前官方页面的<span class="exturl"><a class="exturl__link"   href="https://github.com/YOURLS/awesome-yourls#themes-" >主题</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>只有3个，大家可以搜寻比较好看的。我使用的主题是<span class="exturl"><a class="exturl__link"   href="https://github.com/Flynntes/Sleeky" >Sleeky</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，不仅很好看而且还会添加前端首页。</p><ol><li>下载文件</li><li>移动<code>sleeky-frontend</code>文件夹到网站根目录下</li><li>配置<code>frontend/config.php</code></li><li>移动<code>sleeky-backend</code>文件夹至<code>user/plugins/</code>目录</li><li>在后台管理中<code>example.com/admin/plugins.php</code>启用插件<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/1621046193-1-.png"  alt="" />      </li></ol>        <h2 id="其他"   >          <a href="#其他" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#其他"></a> 其他</h2>      <p>  查看统计数据，可以在后台的管理界面中数据统计查看，也可以在短链接后面添加<code>+</code>查看，例如<code>https://ffox.ml/LL+</code>，包括访问量、地区和来源等。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/1621046295-1-.jpg"  alt="" />      <br />  最后欢迎大家来玩–&gt;<span class="exturl"><a class="exturl__link"   href="https://ffox.ml/" >FF的短链接生成器</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h2 id="参考资料"   >          <a href="#参考资料" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h2>      <p><span id="refer-1">1. <span class="exturl"><a class="exturl__link"   href="https://yourls.org/" >YOURLS: Your Own URL Shortener</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-2">2. <span class="exturl"><a class="exturl__link"   href="https://github.com/YOURLS/YOURLS/wiki" >YOURLS Wiki</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-3">3. <span class="exturl"><a class="exturl__link"   href="https://www.cnblogs.com/myIvan/p/10582849.html" >用yourls 搭建短链接地址服务</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-4">4. <span class="exturl"><a class="exturl__link"   href="https://blog.csdn.net/hfut_wowo/article/details/108734217" >关于yourls生成短链耗时太长问题解决</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span><br /><span id="refer-5">5. <span class="exturl"><a class="exturl__link"   href="https://hongcyu.cn/posts/hexo-bilibili.html" >HEXO博客引用B站视频并自动适配</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></span></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h2&gt;
      
&lt;p&gt;  你是否遇到过这样的场景？你有一个链接，例如&lt;code&gt;https://arxiv.org/abs/2104.14228&lt;/code&gt;，需要分享给朋友，这个链接长而且不好记忆，需要经常用到的时候也不方便，假设你需要发微博，由于字数限制，链接长度越短越好，这时候如果有一个链接&lt;code&gt;https://ffox.ml/grid02&lt;/code&gt;经过重定向可以指向前文的网址，那边就会很美观且方便，而这就需要用到短链接生成技术。&lt;/p&gt;</summary>
    
    
    
    <category term="软件/程序" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/"/>
    
    
    <category term="安装" scheme="https://foolishfox.cn/tags/%E5%AE%89%E8%A3%85/"/>
    
    <category term="Nginx" scheme="https://foolishfox.cn/tags/Nginx/"/>
    
    <category term="PHP" scheme="https://foolishfox.cn/tags/PHP/"/>
    
    <category term="域名" scheme="https://foolishfox.cn/tags/%E5%9F%9F%E5%90%8D/"/>
    
  </entry>
  
  <entry>
    <title>Python模拟锁相放大器的工作过程</title>
    <link href="https://foolishfox.cn/posts/202105-amplifier.html"/>
    <id>https://foolishfox.cn/posts/202105-amplifier.html</id>
    <published>2021-05-07T14:02:44.000Z</published>
    <updated>2021-06-22T15:49:17.066Z</updated>
    
    <content type="html"><![CDATA[<style>  .Note {    width: 100%;    height: 7200px;    border: medium none;  }</style><!-- <iframe src="https://lastknightcoder.gitee.io/jupyter-for-iframe/numpy%E5%85%A5%E9%97%A8.html" class="Note"></iframe> -->        <h2 id="准备"   >          <a href="#准备" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#准备"></a> 准备</h2>      <p>  本篇笔记将使用python演示锁相放大器的基本原理。<br />  首先引入需要用到的package，使用<code>%matplotlib widget</code>可以产生交互式的图片。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy.fftpack <span class="keyword">import</span> fft</span><br><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> signal <span class="keyword">as</span> sg</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">%matplotlib widget</span><br></pre></td></tr></table></div></figure><span id="more"></span>        <h3 id="绘图"   >          <a href="#绘图" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#绘图"></a> 绘图</h3>      <p>  在本文中将会产生许多的图片，为了方便绘图编写一个展示信号的绘图函数。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw</span>(<span class="params">x, y, title=<span class="string">&#x27;&#x27;</span>, xlable=<span class="string">&#x27;time(s)&#x27;</span>, ylable=<span class="string">&#x27;amplitude&#x27;</span>, L=-<span class="number">3.8</span>, H=<span class="number">3.8</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    draw</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        x : numpy array</span></span><br><span class="line"><span class="string">            abscissa</span></span><br><span class="line"><span class="string">        y : numpy array</span></span><br><span class="line"><span class="string">            ordinate</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># canvas settings</span></span><br><span class="line">    plt.close()</span><br><span class="line">    <span class="keyword">if</span> L!=H:</span><br><span class="line">        plt.ylim(L, H)</span><br><span class="line">    plt.title(title)</span><br><span class="line">    plt.xlabel(xlable)</span><br><span class="line">    plt.ylabel(ylable)</span><br><span class="line"></span><br><span class="line">    plt.plot(x, y)</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></div></figure>        <h3 id="正弦波"   >          <a href="#正弦波" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#正弦波"></a> 正弦波</h3>      <p>  在本实验中将采用正弦波作为输入信号。另外，参考信号、噪声信号等都需要用到正弦信号，所以第一步将编写一个产生给定幅度、频率和相位的正弦信号的函数。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g_sin</span>(<span class="params">t=<span class="number">1</span>, amp=<span class="number">1</span>, f0=<span class="number">10</span>, fs=<span class="number">500</span>, phi=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    generate sinusoid</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        t   : float</span></span><br><span class="line"><span class="string">            time length of the generated sequence</span></span><br><span class="line"><span class="string">        amp : float</span></span><br><span class="line"><span class="string">            amplitude</span></span><br><span class="line"><span class="string">        f0  : float</span></span><br><span class="line"><span class="string">            frequency of sinusoid in Hz</span></span><br><span class="line"><span class="string">        fs  : float</span></span><br><span class="line"><span class="string">            sampling rate per second</span></span><br><span class="line"><span class="string">        phi : float</span></span><br><span class="line"><span class="string">            initial phase in deg</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">        anonymous : list[numpy array, numpy array]</span></span><br><span class="line"><span class="string">            [abscissa, a sinusoid signal]</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    T = <span class="number">1</span>/fs</span><br><span class="line">    N = t/T</span><br><span class="line">    x = <span class="number">2</span>*np.pi*np.arange(N)*T</span><br><span class="line">    <span class="keyword">return</span> [np.arange(<span class="number">0</span>, t, T), amp*np.sin(f0*x+phi*np.pi/<span class="number">180</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x, y = g_sin()</span><br><span class="line">draw(x, y)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_1.png"  alt="" />      </p>        <h3 id="方波"   >          <a href="#方波" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#方波"></a> 方波</h3>      <p>  参考信号可以使用正弦波、方波等。在本实验中将使用方波，而方波的傅里叶级数为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>4</mn><mi>π</mi></mfrac><munderover><mo>∑</mo><mrow><mi>n</mi><mo>=</mo><mn>0</mn></mrow><mi mathvariant="normal">∞</mi></munderover><mfrac><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mn>2</mn><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><msub><mi>ω</mi><mi>r</mi></msub><mi>t</mi><mo stretchy="false">]</mo></mrow><mrow><mn>2</mn><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">f(x)=\frac{4}{\pi}\sum\limits_{n=0}^{\infty}\frac{sin[(2n+1)\omega_rt]}{2n+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.9185100000000004em;vertical-align:-1.267113em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">π</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∞</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mopen">[</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">t</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>  所以我们可以利用上面的正弦波函数，产生一个近似的方波，方波的阶数（即K）越大近似效果越好，K=50时就有很好的效果。  (PS：此处方波均指占空比为50%，正负对称的方波)</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g_square_wave</span>(<span class="params">t=<span class="number">1</span>, amp=<span class="number">1</span>, f0=<span class="number">10</span>, fs=<span class="number">500</span>, K=<span class="number">50</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    generate square wave</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        t   : float</span></span><br><span class="line"><span class="string">            time length of the generated sequence</span></span><br><span class="line"><span class="string">        amp : float</span></span><br><span class="line"><span class="string">            amplitude</span></span><br><span class="line"><span class="string">        f0  : float</span></span><br><span class="line"><span class="string">            frequency of sinusoid in Hz</span></span><br><span class="line"><span class="string">        fs  : float</span></span><br><span class="line"><span class="string">            sampling rate per second</span></span><br><span class="line"><span class="string">        K   : int</span></span><br><span class="line"><span class="string">            order of fourier series</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">        anonymous : list[numpy array, numpy array]</span></span><br><span class="line"><span class="string">            [abscissa, a square wave]</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    T = <span class="number">1</span>/fs</span><br><span class="line">    N = t/T</span><br><span class="line">    x = <span class="number">2</span>*np.pi*np.arange(N)*T</span><br><span class="line"></span><br><span class="line">    y = np.zeros(<span class="built_in">len</span>(x))</span><br><span class="line">    k = <span class="number">2</span>*np.arange(<span class="number">1</span>, K)-<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">        y[i] = amp*np.<span class="built_in">sum</span>(np.sin(k*f0*x[i])/k)</span><br><span class="line">    <span class="keyword">return</span> [np.arange(<span class="number">0</span>, t, T), <span class="number">4</span>*y/np.pi]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x, y = g_square_wave()</span><br><span class="line">draw(x, y)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_2.png"  alt="" />      </p><p>  使用上述两个函数，可以叠加产生带有噪声的信号。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x, y1 = g_sin(amp=<span class="number">0.2</span>, f0=<span class="number">30</span>)</span><br><span class="line">x, y2 = g_sin(amp=<span class="number">0.35</span>, f0=<span class="number">3</span>, phi=<span class="number">45</span>)</span><br><span class="line">x, y3 = g_square_wave(amp=<span class="number">0.1</span>, f0=<span class="number">10</span>)</span><br><span class="line">draw(x, y1+y2+y3)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_3.png"  alt="" />      </p>        <h3 id="频域分析"   >          <a href="#频域分析" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#频域分析"></a> 频域分析</h3>      <p>  这些噪声在时域中难以分辨。不过信号与噪声不同，往往具有明显的频率特征，而噪声一般是与频率无关的，或者是在特定频率范围内的，所以在频域内可以很好的分辨出输入信号的各种成分。<br />  使用快速傅里叶变换（FFT）从时域转化到频域，并且对振幅谱进行取半归一化。</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">FFT</span>(<span class="params">s, fs</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    fast fourier transform</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        s  : numpy array</span></span><br><span class="line"><span class="string">            signal</span></span><br><span class="line"><span class="string">        fs : float</span></span><br><span class="line"><span class="string">            sampling rate per second</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    X  = fft(s)</span><br><span class="line">    mX = np.<span class="built_in">abs</span>(X)   <span class="comment"># magnitude</span></span><br><span class="line">    pX = np.angle(X) <span class="comment"># phase</span></span><br><span class="line"></span><br><span class="line">    draw(np.arange(<span class="built_in">int</span>(fs/<span class="number">2</span>)), mX[<span class="built_in">range</span>(<span class="built_in">int</span>(fs/<span class="number">2</span>))]/fs, </span><br><span class="line">         <span class="string">&#x27;Input signal in frequency domain&#x27;</span>, <span class="string">&#x27;frequency(Hz)&#x27;</span>, <span class="string">&#x27;amplitude&#x27;</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">FFT(y1+y2+y3, <span class="number">500</span>)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_4.png"  alt="" />      </p>        <h3 id="高斯白噪声"   >          <a href="#高斯白噪声" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#高斯白噪声"></a> 高斯白噪声</h3>      <p>  上面的信号添加的噪声还是正弦信号，而现实中比较常见的噪声是白噪声。下面的函数可以根据输入信号产生一个特定信噪比的白噪声。<br />  信噪比的定义是：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>N</mi><mi>R</mi><mo stretchy="false">(</mo><mi>d</mi><mi>B</mi><mo stretchy="false">)</mo><mo>=</mo><mn>10</mn><mi>l</mi><mi>g</mi><mfrac><msub><mi>P</mi><mrow><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub><msub><mi>P</mi><mrow><mi>n</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></msub></mfrac><mo>=</mo><mn>20</mn><mi>l</mi><mi>g</mi><mfrac><msub><mi>A</mi><mrow><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub><msub><mi>A</mi><mrow><mi>n</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">SNR(dB)=10lg\frac{P_{signal}}{P_{noise}}=20lg\frac{A_{signal}}{A_{noise}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.19633em;vertical-align:-0.8360000000000001em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.19633em;vertical-align:-0.8360000000000001em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>  在本实验中，功率<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span></span></span></span>可以用功<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi><mo>=</mo><mo>∫</mo><mi>P</mi><mi>d</mi><mi>t</mi><mo>=</mo><mi>C</mi><mo>∫</mo><msup><mi>A</mi><mn>2</mn></msup><mi>d</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">W=\int Pdt=C\int A^2dt</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.11112em;vertical-align:-0.30612em;"></span><span class="mop op-symbol small-op" style="margin-right:0.19445em;position:relative;top:-0.0005599999999999772em;">∫</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.120228em;vertical-align:-0.30612em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol small-op" style="margin-right:0.19445em;position:relative;top:-0.0005599999999999772em;">∫</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span></span></span></span>代替，因为信号和噪声的积分时间是相同的。而信号的波形是采样得到的，所以<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span></span></span></span>可以用<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∑</mo><msubsup><mi>x</mi><mi>i</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\sum x_i^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.072772em;vertical-align:-0.258664em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span>代替，于是有：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>N</mi><mi>R</mi><mo>=</mo><mn>10</mn><mi>l</mi><mi>g</mi><mfrac><mrow><mo>∑</mo><msubsup><mi>s</mi><mi>i</mi><mn>2</mn></msubsup></mrow><mrow><mo>∑</mo><msubsup><mi>n</mi><mi>i</mi><mn>2</mn></msubsup></mrow></mfrac><mo>⟹</mo><mo>∑</mo><msubsup><mi>n</mi><mi>i</mi><mn>2</mn></msubsup><mo>=</mo><mfrac><mrow><mo>∑</mo><msubsup><mi>s</mi><mi>i</mi><mn>2</mn></msubsup></mrow><mrow><mn>1</mn><msup><mn>0</mn><mrow><mi>S</mi><mi>N</mi><mi>R</mi><mi mathvariant="normal">/</mi><mn>10</mn></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">SNR=10lg\frac{\sum s_i^2}{\sum n_i^2} \Longrightarrow \sum n_i^2= \frac{\sum s_i^2}{10^{SNR/10}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.4539720000000003em;vertical-align:-0.9628639999999999em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959080000000001em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.27686399999999994em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9628639999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.6000100000000002em;vertical-align:-0.55001em;"></span><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.1951080000000003em;vertical-align:-0.704em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.2960000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mord mtight">/</span><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.704em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wgn</span>(<span class="params">x, snr</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    generate Gauss white noise</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">        x   : numpy array</span></span><br><span class="line"><span class="string">            signal</span></span><br><span class="line"><span class="string">        snr : float</span></span><br><span class="line"><span class="string">            signal-to-noise ratio</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">        anonymous : numpy array</span></span><br><span class="line"><span class="string">            Gauss white noise</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    snr    = <span class="number">10</span>**(snr/<span class="number">10.0</span>)</span><br><span class="line">    xpower = np.<span class="built_in">sum</span>(x**<span class="number">2</span>)/<span class="built_in">len</span>(x)</span><br><span class="line">    npower = xpower / snr</span><br><span class="line">    <span class="keyword">return</span> np.random.randn(<span class="built_in">len</span>(x)) * np.sqrt(npower)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">noise = wgn(np.sin(np.arange(<span class="number">0</span>, <span class="number">1000000</span>)*<span class="number">0.1</span>), <span class="number">6</span>)</span><br><span class="line">plt.close()</span><br><span class="line">plt.subplot(<span class="number">211</span>)</span><br><span class="line">plt.hist(noise, bins=<span class="number">100</span>)</span><br><span class="line">plt.subplot(<span class="number">212</span>)</span><br><span class="line">plt.psd(noise)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_5.png"  alt="" />      </p>        <h2 id="模拟"   >          <a href="#模拟" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#模拟"></a> 模拟</h2>      <p>  下面开始正式的模拟过程：</p><ol><li>获得输入信号，输入信号由10Hz的目标信号和其他频率的正弦噪声以及白噪声组成</li></ol><p>  A. 增加正弦部分</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x, y1  = g_sin(amp=<span class="number">0.1</span>)</span><br><span class="line">x, y2  = g_sin(amp=<span class="number">0.5</span>, f0=<span class="number">50</span>)</span><br><span class="line">x, y3  = g_sin(amp=<span class="number">0.8</span>, f0=<span class="number">3</span>)</span><br><span class="line">x, y4  = g_sin(amp=<span class="number">0.3</span>, f0=<span class="number">200</span>)</span><br><span class="line">signal = y1+y2+y3+y4</span><br></pre></td></tr></table></div></figure><p>  B. 增加白噪声部分</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">noise = wgn(signal, <span class="number">10</span>)</span><br><span class="line">sn    = signal+noise</span><br><span class="line">draw(x, sn)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_6.png"  alt="" />      <br />  C. 查看输入信号的频域信息</p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FFT(sn, <span class="number">500</span>)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_7.png"  alt="" />      </p><ol start="2"><li>获得参考信号，方波频率与目标信号相同，为10Hz</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x, y   = g_square_wave(K=<span class="number">100</span>)</span><br><span class="line">square = y</span><br><span class="line">draw(x, square)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_8.png"  alt="" />      </p><ol start="3"><li>前置放大×2倍</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sn = sn*<span class="number">2</span></span><br><span class="line">draw(x, sn)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_9.png"  alt="" />      </p><ol start="4"><li>输入信号进行带通滤波，除去/抑制部分噪声，增强锁相放大器的性能（动态储备和输出动态范围）</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b, a = sg.butter(<span class="number">1</span>, [<span class="number">0.02</span>, <span class="number">0.12</span>], <span class="string">&#x27;bandpass&#x27;</span>) <span class="comment"># 5Hz - 30Hz</span></span><br><span class="line">snq  = sg.filtfilt(b, a, sn)</span><br><span class="line">draw(x, snq)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_10.png"  alt="" />      </p><ol start="5"><li>调谐放大输入信号×5，增大信噪比</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b, a = sg.butter(<span class="number">1</span>, [<span class="number">0.038</span>, <span class="number">0.042</span>], <span class="string">&#x27;bandpass&#x27;</span>) <span class="comment"># 9.5Hz - 10.5Hz</span></span><br><span class="line">sns  = sg.filtfilt(b, a, snq)</span><br><span class="line">snq  = sns*<span class="number">4</span>+snq</span><br><span class="line">draw(x, snq)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_11.png"  alt="" />      </p><ol start="6"><li>PSD（相敏检波器）处理输入与参考信号（本质为乘法器）</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">snqx = snq*square</span><br><span class="line">draw(x, snqx)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_12.png"  alt="" />      </p><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FFT(snqx, <span class="number">500</span>)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_13.png"  alt="" />      </p><ol start="7"><li>低通滤波，减少其他信号对直流分量的影响（等效噪声宽度很小）</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b, a = sg.butter(<span class="number">3</span>, <span class="number">0.00004</span>, <span class="string">&#x27;lowpass&#x27;</span>) <span class="comment"># 0 - 0.01Hz</span></span><br><span class="line">sns  = sg.filtfilt(b, a, snqx)</span><br><span class="line">draw(x, sns)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_14.png"  alt="" />      </p><ol start="8"><li>直流放大×5</li></ol><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sns = sns*<span class="number">5</span></span><br><span class="line">draw(x, sns)</span><br></pre></td></tr></table></div></figure><p>        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/amplifier_15.png"  alt="" />      </p>]]></content>
    
    
    <summary type="html">&lt;style&gt;
  .Note {
    width: 100%;
    height: 7200px;
    border: medium none;
  }
&lt;/style&gt;
&lt;!-- &lt;iframe src=&quot;https://lastknightcoder.gitee.io/jupyter-for-iframe/numpy%E5%85%A5%E9%97%A8.html&quot; class=&quot;Note&quot;&gt;&lt;/iframe&gt; --&gt;

        &lt;h2 id=&quot;准备&quot;   &gt;
          &lt;a href=&quot;#准备&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#准备&quot;&gt;&lt;/a&gt; 准备&lt;/h2&gt;
      
&lt;p&gt;  本篇笔记将使用python演示锁相放大器的基本原理。&lt;br /&gt;
  首先引入需要用到的package，使用&lt;code&gt;%matplotlib widget&lt;/code&gt;可以产生交互式的图片。&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;div class=&quot;table-container&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; numpy &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; np&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; scipy.fftpack &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; fft&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; scipy &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; signal &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; sg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; matplotlib &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; pyplot &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; plt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;%matplotlib widget&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="学习" scheme="https://foolishfox.cn/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Python" scheme="https://foolishfox.cn/tags/Python/"/>
    
    <category term="信号处理" scheme="https://foolishfox.cn/tags/%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>建国以来土地政策的变化</title>
    <link href="https://foolishfox.cn/posts/202104-land.html"/>
    <id>https://foolishfox.cn/posts/202104-land.html</id>
    <published>2021-04-14T09:38:51.000Z</published>
    <updated>2021-06-22T15:49:17.058Z</updated>
    
    <content type="html"><![CDATA[        <h2 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2>      <p>  我国在相当长的时间内是一个传统的农业国，哪怕工业化之后，农民仍然占据人口的大多数，土地依旧是百姓关注的焦点，“耕者有其田”是自古以来百姓所渴望实现的目标。而且土地还关系到粮食生产的多少，直接影响国家的安危。</p><span id="more"></span><p>  封建土地所有制在我国持续了两千多年。尽管统治者一直试图抑制土地兼并，保证自耕农阶层的稳定，但是每到封建王朝末期，严重的土地兼并和高额的赋税，使得大量自耕农破产，权贵阶层则手握大量土地，而朝廷却国库空虚，最终矛盾激化，政权更替<sup><a href="#refer-1">[1]</a></sup>。</p><p>  辛亥革命之后，以孙中山为代表的部分人努力实现“耕者有其田”的目标，但是由于官僚主义、帝国主义、封建主义这三座大山的压迫，广大农民的处境并没有得到改善，土地依然大量掌握在军阀、权贵手中，“富者阡陌连田，穷者无立锥之地”的情形时有发生。</p><p>  中国共产党成立之后，以马克思主义为指导思想，结合实际情况摸索实践，建立了一个适合中国国情的、与时俱进、不断迭代优化的土地政策，实现了千百年来中华民族关于土地的愿望。本文以我党上世纪的土地政策为例，论述我党土地政策的内容和思想，探讨其中蕴含的马克思主义思想和中国特色。</p>        <h2 id="我国土地政策的变化"   >          <a href="#我国土地政策的变化" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#我国土地政策的变化"></a> 我国土地政策的变化</h2>      <p>  从土地革命战争到家庭联产承包制，再到土地使用权流转，中国共产党的土地政策上世纪中不断变化着。我党的土地政策阶段，主要可以分为三个阶段，分别是建党后至建国前，建国后至改革开放前和改革开放后。</p>        <h3 id="建国前耕者有其田的伟大目标"   >          <a href="#建国前耕者有其田的伟大目标" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#建国前耕者有其田的伟大目标"></a> 建国前：耕者有其田的伟大目标</h3>              <h4 id="土地革命战争破除封建土地所有制"   >          <a href="#土地革命战争破除封建土地所有制" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#土地革命战争破除封建土地所有制"></a> 土地革命战争：破除封建土地所有制</h4>      <p>  1921年至1937年被称为土地革命战争时期，这一时期社会的主要矛盾是代表广大人民利益的中国共产党和代表地主、资本家、军阀、买办利益的国民党反动派之间的矛盾，我党在广大的苏区农村地区展开了大规模的土地革命。最初党提出了“限租限地”的政策，保护佃农的权益，打击土地兼并。随着根据地的不断扩大和革命的深入，党逐渐意识到“中国革命的根本问题是土地问题”，而要解决土地问题，关键就在于土地所有权<sup><a href="#refer-2">[2]</a></sup>，于是党提出要没收大地主、军阀、劣绅和宗祠的土地，主张“耕地农有”，即谁耕种的土地归谁所有，将大量土地分给农民，切实解决农民土地所有权问题。</p><p>  1928年，我党第一部土地法《井冈山土地法》颁布，规定“没收农村一切土地”，然而这一过程却损害了所有农民的利益，而不仅仅是大地主和富农<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup>。于是在1929年的《兴国县土地法》中做出了更正：“没收一切公共土地及地主阶级的土地”<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup>，毛泽东称其为“一个原则的改正”<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup><sup><a href="#refer-3">[3]</a></sup>。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/20210515115650.png"  alt="" />      </p><div style="margin: 0 auto;text-align: center;"><b>图 1 井冈山土地法</b></div><p>  在这一时期，我党土地改革所参考的形式是苏联斯大林模式的农村集体化道路，认为“广大农民得到解放的必由之路是由土地国有过渡到大规模的社会主义生产”<sup class="footnote-ref"><a href="#fn4" id="fnref4">4</a></sup>“没收一切土地,客观上是实行土地的国有”，最终目标是要“实现集体的社会主义的土地生产道路”<sup class="footnote-ref"><a href="#fn5" id="fnref5">5</a></sup>，这些举措是我党土地政策的创新与实践，赢得了广大群众的支持，帮助我党在国民党反动派的打压下，不断扩大并巩固了革命根据地。</p>        <h4 id="抗日战争减租减息巩固民族统一战线"   >          <a href="#抗日战争减租减息巩固民族统一战线" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#抗日战争减租减息巩固民族统一战线"></a> 抗日战争：减租减息巩固民族统一战线</h4>      <p>  抗日战争中，中日民族矛盾取代土地革命战争时期的人民与国民党反动派的矛盾，成为了社会主要矛盾。为了建立巩固民族统一战线，在1937年六届中央政治局于陕北召开洛川会议，决定将“减租减息”作为抗战期间的土地政策，列入《抗日救国十大纲领》之中<sup><a href="#refer-4">[4]</a></sup>。“地主减租减息，农民交租交息”，通过这一方式，我党调节了农民和和地主富农之间的矛盾，将他们一同纳入抗日民族统一战线之中。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/05/20210515140446.png"  alt="" />      </p><div style="margin: 0 auto;text-align: center;"><b>图 2 中国共产党抗日救国十大纲领</b></div><p>  在这一特殊时期，我党推行的“减租减息”政策暂缓了土地改革的进程，但是起到了团结社会各阶级的作用，不仅壮大了抗日力量，而且还巩固了革命根据地的统治<sup class="footnote-ref"><a href="#fn6" id="fnref6">6</a></sup>。</p>        <h4 id="解放战争耕者有其田目标的实现"   >          <a href="#解放战争耕者有其田目标的实现" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#解放战争耕者有其田目标的实现"></a> 解放战争：耕者有其田目标的实现</h4>      <p>  随着抗日战争的结束，中日民族矛盾基本得到了解决，国共两党曾试图通过和平方式协商统一，于是在抗战后的一段时间内，我党沿用了抗战时期的土地政策，毛泽东在1945年11月指出：“目前我党的方针，仍然是减租而不是没收土地”<sup class="footnote-ref"><a href="#fn7" id="fnref7">7</a></sup><sup><a href="#refer-4">[4]</a></sup>。</p><p>  随着蒋介石政府发动内战的迹象越来越明显，而人民群众希望废除封建土地制度，解决土地问题的呼声越来越大，我党土地政策的核心内容从“减租减息”变为“没收地主土地，彻底废除封建土地制度”。1947年，中共中央颁布了《中国土地法大纲》，明确了“土地均分给农民这一原则”<sup class="footnote-ref"><a href="#fn8" id="fnref8">8</a></sup>。土地改革从根本上改变了土地所有制，实现了中国百姓几千年来“耕者有其田”的梦想。</p><p>  建国前，我党的土地政策经过了没收土地、耕地农有、减租减息、土地革命等多个阶段，这些政策是根据社会主要矛盾的演变而与时俱进的。通过近30年的努力，我党完全废除了封建土地所有制，实现了中国百姓的夙愿，巩固了农村基层组织，让我党获得了广大群众的拥护和支持。这一时期的土地政策，为建国后的土地政策和土地立法提供了丰富的经验。</p>        <h3 id="改开前土地公有制的伟大尝试"   >          <a href="#改开前土地公有制的伟大尝试" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#改开前土地公有制的伟大尝试"></a> 改开前：土地公有制的伟大尝试</h3>              <h4 id="改造集体土地所有制"   >          <a href="#改造集体土地所有制" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#改造集体土地所有制"></a> 改造：集体土地所有制</h4>      <p>  建国后并没有停下土地改革的进程。农民经过土地革命，虽然分到了土地，但是由于自然经济生产经营分散，技术地下，抗风险能力弱，所以我国农业在经过短暂的快速发展后，又陷入了瓶颈。</p><p>  毛泽东从马克思主义的角度出发，思考了中国历朝历代的土地政策，认为只有实现土地公有制度，才能从根本上解决土地问题。于是我国仿照苏联进行农业集体化的方式，针对中国地少人多的实际情况，开始了新的土地制度改革路程<sup><a href="#refer-5">[5]</a></sup>。</p><p>  1953年开始的农业合作化，是社会主义三大改造的一部分。农业合作化的实质是通过互助合作的形式将生产资料私有制为基础的小私有经济改造成生产资料公有为基础的合作经济的过程。农业合作化先后经历了具有社会主义萌芽的互助组、土地入股统一经营的初级阶段和土地、耕畜、农具等折价归集体所有的高级阶段。到1956年已经基本完成农业社会主义改造，初步建立了农村土地集体所有制。</p>        <h4 id="推进合作社与人民公社"   >          <a href="#推进合作社与人民公社" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#推进合作社与人民公社"></a> 推进：合作社与人民公社</h4>      <p>  1958年3月中共中央通过了《关于把小型的农业合作社适当地合并为大社的意见》<sup class="footnote-ref"><a href="#fn9" id="fnref9">9</a></sup>，鼓励“有条件的地方，把小型的农业合作社有计划地适当地合并为大型的合作社“，这是人民公社化的前奏。同年8月，中共中央通过了《关于在农村建立人民公社问题的决议》，提出要通过建立人民公社“加快社会主义建设的速度”，其本质特征是规模“巨型化”和实行“政社合一”的管理体制<sup class="footnote-ref"><a href="#fn10" id="fnref10">10</a></sup>。</p><p>  总的来说，农业的社会主义改造和人民公社化解决了农村贫富分化现象重新出现、个体农业不能满足工业需求、自然经济抗风险能力差等问题。人民公社20年，全国人口增长近2.8亿，为工业化、现代化提供了8000多亿的资金，修建了价值约180万亿的水利工程，功在当代，利在千秋。但是在这个过程也出现了浮夸风、共产风、一刀切和平均主义的隐患，为后来人民公社的取缔埋下了伏笔。</p>        <h3 id="改开后土地生产力的蓬勃发展"   >          <a href="#改开后土地生产力的蓬勃发展" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#改开后土地生产力的蓬勃发展"></a> 改开后：土地生产力的蓬勃发展</h3>              <h4 id="改革农村土地承包与城市土地流转"   >          <a href="#改革农村土地承包与城市土地流转" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#改革农村土地承包与城市土地流转"></a> 改革：农村土地承包与城市土地流转</h4>      <p>  文革后的短时间内，全国经济不振，长期的平均主义政策抑制了农民的劳动积极性，致使农业生产长期停滞不前，农民生活质量得不到明显改善，再加上天灾不断，迫使我党对土地政策做出了调整。</p><p>  1978年12月，十三届三中全会的召开拉开了改革开放的序幕。同时期，关于建立具有中国特色的土地政策的改革也在农村和城市地区引起了广泛讨论。</p><p>  以安徽凤阳小岗村为代表的包产到户掀起了农村土地政策变革的大幕。1980年9月，中央下发《关于进一步加强和完善农业生产责任制的几个问题的通知》<sup class="footnote-ref"><a href="#fn11" id="fnref11">11</a></sup>的文件，明确在坚持土地集体所有的前提下，“可以包产到户，也可以包干到户”，在1982年颁布的中央1号文件中，中央强调，“包产到户”“包干到户”“都是建立在土地公有制基础上的，是社会主义农业经济的组成部分”<sup class="footnote-ref"><a href="#fn12" id="fnref12">12</a></sup>。</p><p>  家庭联产承包责任制总体上而言，改变了我国农村旧的经营管理体制，解放了农村生产力，调动了广大农民的生产经营积极性。但是家庭分散经营，经营规模小、风险大，抗风险能力差，难以形成规模经济效益，而且农民不能自由处置土地，限制了农民的择业自由，另外分散化也导致农村基础设施难以建设，农业生产长期高成本。</p>        <h4 id="发展解决问题细化管理"   >          <a href="#发展解决问题细化管理" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#发展解决问题细化管理"></a> 发展：解决问题，细化管理</h4>      <p>  为了解决农业发展的问题，推动农业发展走向规模化、现代化，提升农业的市场竞争力，中央在各地进行了积极探索，尝试了多种土地流转形式。</p><p>  1992年邓小平南巡讲话后, 国家确立了建设社会主义市场经济的改革方针, 农业与农村经济发展掀起了新浪潮。1993年全国人大修正了宪法，从根本大法上确立了家庭联产承包责任制的法律地位，终止了多年来对家庭联产承包责任制的非议与争论，推动农业发展。</p><p>  我国经济在改革开放后进入高速发展期，这对土地管理制度提出了更高的要求。完善土地管理制度成为了这一时期的当务之急。由于在很长的一段时间内，我国的农村地区占据主要地位，农村土地也是土地的主要部分，所以在1982年之前，我国的土地管理制度主要是农村土地管理。但是伴随着城市的发展，土地管理制度也做出了重大改变。</p><p>  1982年至1986年期间，我国的实行城乡土地分割管理的制度，农村用地由农业部负责，城市用地由建设部管理，但是这一制度不能适应我国耕地不足的情况，所以在1986年我国决定建立城乡土地统一管理制度。特别是针对耕地管理，我国在1997年发布了《关于进一步加强土地管理切实保护耕地的通知》提出要加强土地宏观管理，特别是加强土地管理的执法监督检查<sup class="footnote-ref"><a href="#fn13" id="fnref13">13</a></sup>；在1998年通过了《土地管理法》，确立了保护耕地的基本国策<sup><a href="#refer-6">[6]</a></sup>。</p><p>  改革开放以来的土地政策相较于之前发生了巨大的改变，也取得了很大的成效。我党在这一时期的土地政策，充满了创新、探索，特别是发挥了试点作用，在一项政策取得成功后不断推广，有很好的反响。我国的土地政策不断完善，对解放土地生产力发挥了重要作用。</p>        <h2 id="土地政策马克思主义中国化的产物"   >          <a href="#土地政策马克思主义中国化的产物" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#土地政策马克思主义中国化的产物"></a> 土地政策：马克思主义中国化的产物</h2>      <p>  马克思从未明确提出过 “土地产权” 这一概念，但是我们依然可以在他的著作中提取到他的土地产权理论，这一套理论包括了土地产权制度及其变迁、 土地产权权能、 土地产权结合与分离、土地产权商品化及配置市场化等诸多部分，对我党土地制度的建立与改革产生了深远影响<sup><a href="#refer-7">[7]</a></sup>。</p><p>  几十年来，中国共产党始终以马克思主义作为指导思想，把“以人民为中心”作为政策主线，从无到有建立了符合实际，切合国情的中国特色社会主义土地制度，并且随着社会主要矛盾的改变不断完善土地政策和基于土地集体所有的生产关系。从思想特质上来所，我党的的土地政策是马克思主义中国化的产物。</p><p>  在土地革命战争时期，以毛泽东为核心的第一代党中央领导集体把马克思列宁主义的基本原理同中国的国情相结合，制定了具有中国特色的土地路线、方针和政策，是毛泽东思想的重要组成部分。在这一思想的指导下，我党将这一时期的工作重心放在农村，深入基层，发动农民进行抗争，一起废除腐朽的封建土地制度，并且在实践中不断探索、创新，制定出符合中国实际情况的土地改革制度<sup><a href="#refer-8">[8]</a></sup>。这一过程充分体现了毛泽东思想中“结合实际，实事求是”的基本点，邓小平同志腾说：“毛泽东同志所以伟大，能把中国革命引导到胜利，归根到底，这是靠这个”<sup class="footnote-ref"><a href="#fn14" id="fnref14">14</a></sup>。</p><p>  改革开放后至今的土地政策，与建立社会主义市场经济体制的改革总目标保持紧密结合。社会主义市场经济体制不是资本主义，它是与中国特色社会主义的基本制度结合在一起的，目标是使市场在国家宏观调控下对资源配置起到基础性作用。在全球化日益加深和改革开放不断深入、扩大的背景下，土地政策要在坚持土地公有制的前提下，发挥市场对土地资源配置的基础作用，但也要处理好土地管理中国家计划与资本市场之间的关系，发挥制度优势<sup><a href="#refer-8">[8]</a></sup>。</p><div style="max-width: 900px;margin: 0 auto;">    <div id="food_container" style="max-width: 900px;height:400px;"></div></div><script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script><script type="text/javascript">    var food = echarts.init(document.getElementById('food_container'));    var base = new Date(), date = [];var data = [395.95, 395.95, 395.95, 395.95, 395.95, 443.93, 443.93, 443.93, 443.93, 443.93, 494.65, 494.65, 494.65, 684.31, 684.31, 684.31, 684.31, 684.31, 838.44, 838.44, 838.44, 838.44, 838.44, 1020.46, 1020.46, 1020.46, 1117.50, 1325.30, 1454.10, 1635.87, 1865.30, 2074.47, 2380.15, 2506.40, 2771.75, 3160.49, 3666.89, 4100.58, 4954.30, 5146.43, 5588.02, 6605.14, 9169.22, 11884.60, 13539.80, 13852.50, 14241.90, 14106.20, 13873.60, 14462.79, 14931.50, 14870.11, 18138.36, 19613.37, 21522.28, 24444.68, 27679.94, 29938.81, 35909.07, 40339.62, 44845.72, 48943.94, 51851.12, 54205.34, 55659.89, 58059.76, 61452.60, 66066.45];    var dyear = base.getFullYear(), dmonth = base.getMonth()+1;    var year = 1952;    while ( year<dyear ) {        date.push([year].join('/'));        year += 1;    }    var food_option = {        title: { text: '我国农业总产值', subtext: '自1952年起，数据来源国家统计局' },        tooltip: { trigger: 'axis' },        xAxis: { type: 'category', data: date },        yAxis: { type: 'value' },        dataZoom: [{}],        series: [{            type: 'line',            data: data        }]    };food.setOption(food_option);</script><div style="margin: 0 auto;text-align: center;"><b>图 3 1952年以来我国农业生产总产值</b></div><p>  事实也证明，我党的土地政策是有利于农业发展，提高农民生活水平的。从图 3可以看出，每当农业发展到瓶颈时，我党总是能够适时的完善、改革土地政策：1978年改革开放，随后开始了家庭联产承包责任制，我国农业迅速从文革中恢复，开始增长；1992年，邓小平南巡讲话，1993年宪法确立了联产承包的法律地位，我国农业顿时跃上了一个新台阶；世纪之交，我国经济形势发生了重大变化，为了适应新世纪的需要，2002年党的十六大正式提出允许土地使用权流转，农业生产总产值再次迅速增加，至今我国农业已经连续二十多年取得丰收，农民的生活也获得了巨大改善。</p><div style="margin: 0 auto;text-align: center;"><b>表 1 农村发展数据</b></div><div class="table-container"><table><thead><tr><th style="text-align:center">年份</th><th style="text-align:center">粮食产量（万吨）</th><th style="text-align:center">农村居民人均纯收入（元）</th></tr></thead><tbody><tr><td style="text-align:center">1980年</td><td style="text-align:center">32055.50</td><td style="text-align:center">191.3</td></tr><tr><td style="text-align:center">2000年</td><td style="text-align:center">46217.52</td><td style="text-align:center">2253.4</td></tr><tr><td style="text-align:center">2020年</td><td style="text-align:center">66949.00</td><td style="text-align:center">14617.0（2018）</td></tr></tbody></table></div>        <h2 id="总结"   >          <a href="#总结" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#总结"></a> 总结</h2>      <p>  回顾土地政策的发展演变历史，土地政策的变革是毛泽东思想和中国特色社会主义的实践与证明。毛泽东指出：“当革命的形势己经改变的时候，革命的策略、革命的领导方式，也必须跟着改变。”<sup class="footnote-ref"><a href="#fn15" id="fnref15">15</a></sup>而随着主要矛盾的改变，我们的土地政策也必须要做出相应的改变。</p><p>  邓小平思想中关于三个有利于的说法，也可以延伸出一个标准：是否有利于解放和发展生产力是衡量中国一切政党政策及其实践的根本标准。三个代表重要思想也提出“中国共产党始终代表中国先进生产力的发展要求，就是要不断地解放和发展生产力”。</p><p>  土地政策的变革证明，我党的土地政策，极具中国特色，而且切实解决了千百年来的土地问题；我党的土地政策，既是中国人民智慧的结晶，又是马克思主义指导的成果；我党的土地政策，不仅没有背离马克思主义的指导，更是拓宽了马克思主义关于土地问题的思考与探索<sup><a href="#refer-9">[9]</a></sup>。总而言之，我党的土地政策，是马克思主义中国化的代表与证明。</p>        <h2 id="参考文献"   >          <a href="#参考文献" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#参考文献"></a> 参考文献</h2>      <p><span id="refer-1">1. 党的以人民为中心的土地政策_百年沿革与发展_俞明轩[J].</span><br /><span id="refer-2">2. 俞明轩, 谷雨佳, 李睿哲. 党的以人民为中心的土地政策：百年沿革与发展[J]. 管理世界, 2021,37(04): 24-35.</span><br /><span id="refer-3">3. 温锐, 杨丽琼. 中央苏区平分土地政策与农民权益保障的再认识[J]. 中共党史研究, 2010(05): 64-70.</span><br /><span id="refer-4">4. 阎庆生, 黄正林. 论陕甘宁边区的土地政策和土地立法[J]. 西北师大学报(社会科学版), 2001(06): 54-59.</span><br /><span id="refer-5">5. 郑品芳, 李佑新. 中国共产党百年农村土地政策制度改革研究[J]. 湖南大学学报(社会科学版), 2021,35(02): 9-16.</span><br /><span id="refer-6">6. 姜爱林. 改革开放以来中国土地政策的发展变迁[J]. 中州学刊, 2003(05): 48-53.</span><br /><span id="refer-7">7. 洪名勇. 论马克思的土地产权理论[J]. 经济学家, 1998(01): 28-33.</span><br /><span id="refer-8">8. 张永泉. 毛泽东在解决农民土地问题上的重大贡献[J]. 浙江学刊, 1994(01): 21-24.</span><br /><span id="refer-9">9. 姜炳三. 中国农村土地制度建设的理论指南──学习建设中国特色社会主义理论的几点体会[J]. 浙江社会科学, 1995(01): 36-42.</span></p><hr class="footnotes-sep" /><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>《中央通讯二十八号——农民运动的策略(一)(1929年2月3日),《第一、二次国内革命战争时期土地斗争史料选编》,人民出版社,1981年,第 272 页 <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>《建党以来重要文献选编（1921—1949）》（第 6 册）,中国文献出版社,2011 年版,第 184 页 <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p>《毛泽东农村调查文集》,人民出版社,1982年,第 40 页 <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p>《江西省致湘江赣边特委(综合)指示》(1929年9月6日),《第一、二次国内革命战争时期土地斗争史料选编》,第 320 页 <a href="#fnref4" class="footnote-backref">↩︎</a></p></li><li id="fn5" class="footnote-item"><p>《土地问题与反富农策略》(1931年2月8日),苏区中央局,《第一、二次国内革命战争时期土地斗争史料选编》,第 492 页 <a href="#fnref5" class="footnote-backref">↩︎</a></p></li><li id="fn6" class="footnote-item"><p>《中国共产党历史第一卷（1921-1949）》（下册）,中共党史出版社,2002 年版,第 596~597 页 <a href="#fnref6" class="footnote-backref">↩︎</a></p></li><li id="fn7" class="footnote-item"><p>《减租和生产是保卫解放区的两件大事》,《毛泽东选集》第4卷,人民出版社1991年版,第 1173 页 <a href="#fnref7" class="footnote-backref">↩︎</a></p></li><li id="fn8" class="footnote-item"><p>《中央关于土地问题的指示》,《中国中央文件选集》第16册,人民出版社1992年版,第 528~530 页 <a href="#fnref8" class="footnote-backref">↩︎</a></p></li><li id="fn9" class="footnote-item"><p>《建国以来重要文献选编》（第 11 册）,中央文献出版社,2011 年版,第 209~211 页 <a href="#fnref9" class="footnote-backref">↩︎</a></p></li><li id="fn10" class="footnote-item"><p>《建国以来重要文献选编》（第 11 册）,中央文献出版社,2011 年版,第 446~451页 <a href="#fnref10" class="footnote-backref">↩︎</a></p></li><li id="fn11" class="footnote-item"><p>《新时期农业和农村工作重要文献选编》,中央文献出版社,1992 年版,第 60 页 <a href="#fnref11" class="footnote-backref">↩︎</a></p></li><li id="fn12" class="footnote-item"><p>《全国农村工作会议纪要》,《新时期重要文献选编》（三中全会以来重要文件选编下）,人民数据 <a href="#fnref12" class="footnote-backref">↩︎</a></p></li><li id="fn13" class="footnote-item"><p>《中共中央、国务院关于进一步加强土地管理切实保护耕地的通知》,《新时期重要文献选编》（十四大以来重要文件选编下）,人民数据 <a href="#fnref13" class="footnote-backref">↩︎</a></p></li><li id="fn14" class="footnote-item"><p>《邓小平文选》第2卷,人民出版社,1993年,第121页 <a href="#fnref14" class="footnote-backref">↩︎</a></p></li><li id="fn15" class="footnote-item"><p>《论反对日本帝国主义的策略》,《毛泽东选集》第1卷,人民出版社1991年版,第 142-169 页 <a href="#fnref15" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h2&gt;
      
&lt;p&gt;  我国在相当长的时间内是一个传统的农业国，哪怕工业化之后，农民仍然占据人口的大多数，土地依旧是百姓关注的焦点，“耕者有其田”是自古以来百姓所渴望实现的目标。而且土地还关系到粮食生产的多少，直接影响国家的安危。&lt;/p&gt;</summary>
    
    
    
    <category term="随记" scheme="https://foolishfox.cn/categories/%E9%9A%8F%E8%AE%B0/"/>
    
    
    <category term="马列毛邓" scheme="https://foolishfox.cn/tags/%E9%A9%AC%E5%88%97%E6%AF%9B%E9%82%93/"/>
    
  </entry>
  
  <entry>
    <title>宝塔Nginx反向代理导致css/js/png等重定向过多</title>
    <link href="https://foolishfox.cn/posts/202104-redirect.html"/>
    <id>https://foolishfox.cn/posts/202104-redirect.html</id>
    <published>2021-04-11T01:48:38.000Z</published>
    <updated>2021-06-22T15:49:17.058Z</updated>
    
    <content type="html"><![CDATA[        <h2 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2>      <p>  在之前的文章<a href="/posts/move.html">博客服务器迁移过程</a>中介绍了<code>footprint</code>打造旅行地图，然后使用Nginx反向代理，将<code>ff.cn/travel</code>指向<code>127.0.0.1:886</code>，原本访问一切正常，但是昨天碰到了一个新的问题：css/js/png等文件请求301重定向过多，花了蛮久才解决问题，所以记下来提醒自己。</p><span id="more"></span>        <h2 id="复现"   >          <a href="#复现" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#复现"></a> 复现</h2>      <p>  在网站<code>/travel/</code>目录下创建<code>hello.js</code>文件，请求<code>ff.cn/travel/hello.js</code>，显示<code>ff.cn 将您重定向的次数过多</code>。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/04/20210412203604.png"  alt="" />      <br />  在开发者模式下查看网络请求，发现服务器将<code>ff.cn/travel/hello.js</code>重定向给自身，导致出现死循环。<br />        <img   class="lazyload lazyload-gif"          src="/images/loading.svg" data-src="https://asset.foolishfox.cn/images/2021/04/20210412203648.png"  alt="" />      </p>        <h2 id="解决"   >          <a href="#解决" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#解决"></a> 解决</h2>      <ol><li>浏览器提示清除cookie：</li></ol><blockquote><p>当相应网页尝试对您进行重定向的次数过多时，您就会看到这条错误消息。<br />有时，网页打不开是因为 Cookie 出问题了。要修正该错误，请尝试清除 Cookie。</p></blockquote>    <div class="note-plugin danger">      <span class="note-plugin__icon note-plugin__icon--danger">              <i class="fas fa-minus-circle"></i>            </span>      <p>无作用</p>    </div>  <ol start="2"><li>刷新DNS/更换DNS<br />  重定向过多可能发生了DNS劫持，可以刷新DNS或者换一个DNS地址。</li></ol>    <div class="note-plugin danger">      <span class="note-plugin__icon note-plugin__icon--danger">              <i class="fas fa-minus-circle"></i>            </span>      <p>无作用</p>    </div>  <ol start="3"><li>SSL证书问题<br />  如果开启了强制访问HTTPS或者SSL证书更换，可能导致前后端接口不一致，陷入反复跳转，造成重定向过多，可以重置SSL证书或者重启强制访问HTTPS。</li></ol>    <div class="note-plugin danger">      <span class="note-plugin__icon note-plugin__icon--danger">              <i class="fas fa-minus-circle"></i>            </span>      <p>无作用</p>    </div>          <h2 id="分析"   >          <a href="#分析" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#分析"></a> 分析</h2>      <p>  查看Nginx日志，发现浏览器发出请求<code>ff.cn/travel/hello.js</code>时，本应该转给<code>127.0.0.1:886/hello.js</code>，然而日志中显示回应请求的链接是<code>127.0.0.1:80/travel/hello.js</code>，怀疑是代理设置出现问题。<br />  查看<code>ff.cn</code>的配置文件如下：</p><figure class="highlight nginx"><figcaption><span>configuration</span></figcaption><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span> ff.cn;</span><br><span class="line">    <span class="attribute">index</span> index.php index.html index.htm default.php default.htm default.html;</span><br><span class="line">    <span class="attribute">root</span> /ff.cn;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#SSL-START SSL相关配置，请勿删除或修改下一行带注释的404规则</span></span><br><span class="line">    <span class="comment">#error_page 404/404.html;</span></span><br><span class="line">    <span class="comment">#HTTP_TO_HTTPS_START</span></span><br><span class="line">    <span class="attribute">if</span> ($server_port !<span class="regexp">~ 443)</span>&#123;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^(/.*)$</span> https://$host<span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#SSL-END</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#ERROR-PAGE-START  错误页配置，可以注释、删除或修改</span></span><br><span class="line">    <span class="comment">#error_page 404 /404.html;</span></span><br><span class="line">    <span class="comment">#error_page 502 /502.html;</span></span><br><span class="line">    <span class="comment">#ERROR-PAGE-END</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#PHP-INFO-START  PHP引用配置，可以注释或修改</span></span><br><span class="line">    <span class="comment">#清理缓存规则</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ /purge(/.*)</span> &#123;</span><br><span class="line">        <span class="attribute">proxy_cache_purge</span> cache_one $host<span class="variable">$1</span>$is_args$args;</span><br><span class="line">        <span class="comment">#access_log  /www/wwwlogs/ff.cn_purge_cache.log;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#引用反向代理规则，注释后配置的反向代理将无效</span></span><br><span class="line">    <span class="attribute">include</span> /www/server/panel/vhost/nginx/proxy/ff.cn/<span class="regexp">*.conf</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">include</span> enable-php-<span class="number">00</span>.conf;</span><br><span class="line">    <span class="comment">#PHP-INFO-END</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#REWRITE-START URL重写规则引用,修改后将导致面板设置的伪静态规则失效</span></span><br><span class="line">    <span class="attribute">include</span> /www/server/panel/vhost/rewrite/ff.cn.conf;</span><br><span class="line">    <span class="comment">#REWRITE-END</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#禁止访问的文件或目录</span></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ ^/(\.user.ini|\.htaccess|\.git|\.svn|\.project|LICENSE|README.md)</span></span><br><span class="line"><span class="regexp"></span>    &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#一键申请SSL证书验证目录相关设置</span></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ \.well-known</span>&#123;</span><br><span class="line">        <span class="attribute">allow</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">access_log</span>  /www/wwwlogs/ff.cn.log;</span><br><span class="line">    <span class="attribute">error_log</span>  /www/wwwlogs/ff.cn.<span class="literal">error</span>.log;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight nginx"><figcaption><span>configuration</span></figcaption><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#PROXY-START/travel/</span></span><br><span class="line"><span class="attribute">location</span>  <span class="regexp">~* \.(php|jsp|js|css|png|cgi|asp|aspx)$</span></span><br><span class="line"><span class="regexp"></span>&#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host $host;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP $remote_addr;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> REMOTE-HOST $remote_addr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /travel/</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:886/;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host $host;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP $remote_addr;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> REMOTE-HOST $remote_addr;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">add_header</span> X-Cache $upstream_cache_status;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#Set Nginx Cache</span></span><br><span class="line">    <span class="attribute">add_header</span> Cache-Control <span class="literal">no</span>-cache;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#PROXY-END/travel/</span></span><br></pre></td></tr></table></div></figure><p>  可以发现，问题出现在了代理配置中的<code>location ~* \.(php|jsp|js|css|png|cgi|asp|aspx)$</code>这一块。当接受到<code>ff.cn/travel/hello.js</code>请求时，根据代理配置进行转发，js/css/png等文件匹配上了第一条规则，于是请求被发往<code>127.0.0.1:80/travel/hello.js</code>，也就刚好是<code>ff.cn/travel/hello.js</code>自身，造成了死循环。将这一片段或者<code>js|css|png</code>删除即可解决</p>        <h2 id="后记"   >          <a href="#后记" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#后记"></a> 后记</h2>      <p>  宝塔确实有点诡异，上一秒还好好访问的，结果突然就重定向了。以后碰到问题多看日志，更容易发现问题所在的地方。</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h2&gt;
      
&lt;p&gt;  在之前的文章&lt;a href=&quot;/posts/move.html&quot;&gt;博客服务器迁移过程&lt;/a&gt;中介绍了&lt;code&gt;footprint&lt;/code&gt;打造旅行地图，然后使用Nginx反向代理，将&lt;code&gt;ff.cn/travel&lt;/code&gt;指向&lt;code&gt;127.0.0.1:886&lt;/code&gt;，原本访问一切正常，但是昨天碰到了一个新的问题：css/js/png等文件请求301重定向过多，花了蛮久才解决问题，所以记下来提醒自己。&lt;/p&gt;</summary>
    
    
    
    <category term="软件/程序" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/"/>
    
    
    <category term="反向代理" scheme="https://foolishfox.cn/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"/>
    
    <category term="Nginx" scheme="https://foolishfox.cn/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>使用Echarts绘制名侦探柯南人物关系图</title>
    <link href="https://foolishfox.cn/posts/202104-conan.html"/>
    <id>https://foolishfox.cn/posts/202104-conan.html</id>
    <published>2021-04-09T04:24:55.000Z</published>
    <updated>2021-05-15T03:24:48.315Z</updated>
    
    <content type="html"><![CDATA[        <h2 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2>      <p>  《名侦探柯南绯色的子弹》就要上映了，npy想要和我一起去看，但是她又搞不懂人物关系，所以就用<code>Echarts</code>做一个柯南的人物关系表了解一下。<br />  <code>ECharts</code>是使用<code>JavaScript</code>实现的开源可视化库，可以做出很多精巧的图片，最初由百度团队开源，后于2018年初捐赠给Apache基金会，成为ASF孵化级项目。</p><span id="more"></span>        <h2 id="步骤"   >          <a href="#步骤" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#步骤"></a> 步骤</h2>      <ol><li>引入<code>jquery</code>和<code>echarts</code>的js文件</li></ol><figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/echarts/5.0.2/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></div></figure><ol start="2"><li>获取<span class="exturl"><a class="exturl__link"   href="https://cdn.jsdelivr.net/gh/YiHui-Liu/Fox-Home-CDN/Detective-Conan.json" >人物关系json文件</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br />  json文件中主要分为3部分，分别是<code>nodes</code>表示人物，<code>links</code>表示关系连接，<code>categories</code>表示阵营/类别。</li></ol><ul><li>nodes</li></ul><figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 必填，二选一</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;0&quot;</span>,   <span class="comment">// 人物id</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;柯南&quot;</span>,   <span class="comment">// 人物名称</span></span><br><span class="line">    <span class="comment">// 选填</span></span><br><span class="line">    <span class="attr">&quot;symbolSize&quot;</span>: <span class="number">50</span>,   <span class="comment">// 点的大小</span></span><br><span class="line">    <span class="attr">&quot;value&quot;</span>: <span class="number">100</span>,   <span class="comment">// 力引导布局(force)中连线长度</span></span><br><span class="line">    <span class="attr">&quot;category&quot;</span>: <span class="number">0</span>,   <span class="comment">// 人物类别</span></span><br><span class="line">    <span class="attr">&quot;itemStyle&quot;</span>: &#123;   <span class="comment">// 自定义样式</span></span><br><span class="line">        <span class="attr">&quot;normal&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;color&quot;</span>: <span class="string">&quot;blue&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ul><li>links</li></ul><figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 必填</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span>: <span class="string">&quot;1&quot;</span>,   <span class="comment">// 源节点名称或者id</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;0&quot;</span>,   <span class="comment">// 目标节点名称或者id</span></span><br><span class="line">    <span class="comment">// 选填</span></span><br><span class="line">    <span class="attr">&quot;value&quot;</span>: <span class="number">100</span>,   <span class="comment">// 力引导布局(force)中连线长度</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;伙伴&quot;</span>   <span class="comment">// 关系名称</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ul><li>categories</li></ul><figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 必填</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;黑衣组织&quot;</span>,   <span class="comment">// 类别名称</span></span><br><span class="line">    <span class="comment">// 选填</span></span><br><span class="line">    <span class="attr">&quot;symbol&quot;</span>: <span class="string">&quot;circle&quot;</span>,   <span class="comment">// 类目节点标记的图形</span></span><br><span class="line">    <span class="attr">&quot;symbolSize&quot;</span>: <span class="number">10</span>,   <span class="comment">// 类目节点的默认大小</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ol start="3"><li>配置前端</li></ol><figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;conan_container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></div></figure><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> conan = echarts.init(<span class="built_in">document</span>.getElementById(<span class="string">&quot;conan_container&quot;</span>));</span><br><span class="line">    <span class="keyword">var</span> option;</span><br><span class="line">    conan.showLoading();</span><br><span class="line">    $.getJSON(<span class="string">&#x27;https://cdn.jsdelivr.net/gh/YiHui-Liu/Fox-Home-CDN/Detective-Conan.json&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">graph</span>) </span>&#123;</span><br><span class="line">        conan.hideLoading();</span><br><span class="line">        option = &#123;</span><br><span class="line">            <span class="comment">// 图表标题与位置</span></span><br><span class="line">            title: &#123;</span><br><span class="line">                text: <span class="string">&#x27;Detective Conan&#x27;</span>,</span><br><span class="line">                top: <span class="string">&#x27;bottom&#x27;</span>,</span><br><span class="line">                left: <span class="string">&#x27;right&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            tooltip: &#123;&#125;,</span><br><span class="line">            legend: [&#123;</span><br><span class="line">                <span class="comment">// selectedMode: &#x27;single&#x27;,</span></span><br><span class="line">                data: graph.categories.map(<span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> a.name;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;],</span><br><span class="line">            animationDuration: <span class="number">1500</span>,</span><br><span class="line">            animationEasingUpdate: <span class="string">&#x27;quinticInOut&#x27;</span>,</span><br><span class="line">            series: [</span><br><span class="line">                &#123;</span><br><span class="line">                    name: <span class="string">&#x27;Detective Conan&#x27;</span>,</span><br><span class="line">                    type: <span class="string">&#x27;graph&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 布局，none使用节点中提供的x、y作为节点的位置；circular采用环形布局；force采用力引导布局</span></span><br><span class="line">                    layout: <span class="string">&#x27;circular&#x27;</span>,</span><br><span class="line">                    data: graph.nodes,</span><br><span class="line">                    links: graph.links,</span><br><span class="line">                    categories: graph.categories,</span><br><span class="line">                    symbolSize: <span class="number">15</span>,</span><br><span class="line">                    value: <span class="number">30</span>,</span><br><span class="line">                    roam: <span class="literal">true</span>,</span><br><span class="line">                    label: &#123;</span><br><span class="line">                        show: <span class="literal">true</span>,</span><br><span class="line">                        position: <span class="string">&#x27;right&#x27;</span>,</span><br><span class="line">                        formatter: <span class="string">&#x27;&#123;b&#125;&#x27;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    labelLayout: &#123;</span><br><span class="line">                        hideOverlap: <span class="literal">true</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    lineStyle: &#123;</span><br><span class="line">                        color: <span class="string">&#x27;source&#x27;</span>,</span><br><span class="line">                        curveness: <span class="number">0.3</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 突出显示有连接的人物</span></span><br><span class="line">                    emphasis: &#123;</span><br><span class="line">                        focus: <span class="string">&#x27;adjacency&#x27;</span>,</span><br><span class="line">                        lineStyle: &#123;</span><br><span class="line">                            width: <span class="number">10</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 缩放限制</span></span><br><span class="line">                    scaleLimit: &#123;</span><br><span class="line">                        min: <span class="number">0.6</span>,</span><br><span class="line">                        max: <span class="number">3</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 显示links的名称</span></span><br><span class="line">                    <span class="comment">// edgeSymbolSize: [4, 10],</span></span><br><span class="line">                    <span class="comment">// edgeLabel: &#123;</span></span><br><span class="line">                    <span class="comment">//     show: true,</span></span><br><span class="line">                    <span class="comment">//     formatter: function (x) &#123;</span></span><br><span class="line">                    <span class="comment">//         return x.data.name;</span></span><br><span class="line">                    <span class="comment">//     &#125;,</span></span><br><span class="line">                    <span class="comment">//     textStyle: &#123;</span></span><br><span class="line">                    <span class="comment">//         fontSize: 20</span></span><br><span class="line">                    <span class="comment">//     &#125;</span></span><br><span class="line">                    <span class="comment">// &#125;,</span></span><br><span class="line">                    <span class="comment">// 力引导布局的设置</span></span><br><span class="line">                    <span class="comment">// force: &#123;</span></span><br><span class="line">                    <span class="comment">//     repulsion: 2500,</span></span><br><span class="line">                    <span class="comment">//     edgeLength: [10, 50]</span></span><br><span class="line">                    <span class="comment">// &#125;,</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;;</span><br><span class="line">        conan.setOption(option);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (option &amp;&amp; <span class="keyword">typeof</span> option === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">        conan.setOption(option);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>        <h2 id="效果展示"   >          <a href="#效果展示" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#效果展示"></a> 效果展示</h2>      <script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script><script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/echarts/5.0.2/echarts.min.js"></script><div id="conan_container" style="max-width: 900px;height: 600px;"></div><script type="text/javascript">    var conan = echarts.init(document.getElementById("conan_container"));    var option;    conan.showLoading();    $.getJSON('https://cdn.jsdelivr.net/gh/YiHui-Liu/Fox-Home-CDN/Detective-Conan.json', function (graph) {        conan.hideLoading();        option = {            title: {                text: 'Detective Conan',                top: 'bottom',                left: 'right'            },            tooltip: {                formatter: function (x) {                    return x.data.des;                }            },            legend: [{                // selectedMode: 'single',                data: graph.categories.map(function (a) {                    return a.name;                })            }],            animationDuration: 1500,            animationEasingUpdate: 'quinticInOut',            series: [                {                    name: 'Detective Conan',                    type: 'graph',                    layout: 'circular',                    data: graph.nodes,                    links: graph.links,                    categories: graph.categories,                    symbolSize: 15,                    value: 30,                    roam: true,                    label: {                        show: true,                        position: 'right',                        formatter: '{b}'                    },                    labelLayout: {                        hideOverlap: true                    },                    lineStyle: {                        color: 'source',                        curveness: 0.3                    },                    emphasis: {                        focus: 'adjacency',                        lineStyle: {                            width: 10                        }                    },                    scaleLimit: {                        min: 0.6,                        max: 3                    }                }            ]        };        conan.setOption(option);    });    if (option && typeof option === 'object') {        conan.setOption(option);    }</script>        <h2 id="参考资料"   >          <a href="#参考资料" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h2>      <ol><li><span class="exturl"><a class="exturl__link"   href="https://blog.csdn.net/weixin_38409915/article/details/114369054" >人物关系图谱:ECharts 实现</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link"   href="https://echarts.apache.org/examples/zh/index.html" >Echarts文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link"   href="https://echarts.apache.org/zh/option.html" >Echarts示例</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h2&gt;
      
&lt;p&gt;  《名侦探柯南绯色的子弹》就要上映了，npy想要和我一起去看，但是她又搞不懂人物关系，所以就用&lt;code&gt;Echarts&lt;/code&gt;做一个柯南的人物关系表了解一下。&lt;br /&gt;
  &lt;code&gt;ECharts&lt;/code&gt;是使用&lt;code&gt;JavaScript&lt;/code&gt;实现的开源可视化库，可以做出很多精巧的图片，最初由百度团队开源，后于2018年初捐赠给Apache基金会，成为ASF孵化级项目。&lt;/p&gt;</summary>
    
    
    
    <category term="软件/程序" scheme="https://foolishfox.cn/categories/%E8%BD%AF%E4%BB%B6-%E7%A8%8B%E5%BA%8F/"/>
    
    
    <category term="Echarts" scheme="https://foolishfox.cn/tags/Echarts/"/>
    
    <category term="名侦探柯南" scheme="https://foolishfox.cn/tags/%E5%90%8D%E4%BE%A6%E6%8E%A2%E6%9F%AF%E5%8D%97/"/>
    
    <category term="Javascript" scheme="https://foolishfox.cn/tags/Javascript/"/>
    
  </entry>
  
  <entry>
    <title>博客成长日志 | 评论系统Waline</title>
    <link href="https://foolishfox.cn/posts/202104-waline.html"/>
    <id>https://foolishfox.cn/posts/202104-waline.html</id>
    <published>2021-04-07T14:21:46.000Z</published>
    <updated>2021-05-28T09:25:13.718Z</updated>
    
    <content type="html"><![CDATA[        <h2 id="前言"   >          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2>      <p>  <span class="exturl"><a class="exturl__link"   href="https://waline.js.org/" >waline</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>是由<span class="exturl"><a class="exturl__link"   href="https://github.com/lizheming" >lizheming</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>开发的博客评论系统，从<span class="exturl"><a class="exturl__link"   href="https://valine.js.org/" >Valine</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>衍生的带后端评论系统。可以将<code>Waline</code>等价成<code>With backend Valine</code>。<br />  Waline的服务端可以部署在<span class="exturl"><a class="exturl__link"   href="https://vercel.com/" >Vercel</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、<span class="exturl"><a class="exturl__link"   href="https://www.cloudbase.net" >CloudBase</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>或者服务器上，数据库可以使用<span class="exturl"><a class="exturl__link"   href="https://www.leancloud.cn/" >LeanCloud</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>、MySQL等，总计有多达48钟部署方式。在官方教程中，使用云服务部署都介绍的比较详细，下面介绍两种本地部署方式，可以自定义端口，配合多种数据库使用。</p><span id="more"></span>        <h2 id="docker"   >          <a href="#docker" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#docker"></a> Docker</h2>      <p>  在Docker容器内运行<code>vanilla.js</code>文件。</p><ol><li>修改<code>Node.js</code>淘宝源</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单次使用</span></span><br><span class="line">npm install module_name --registry=https://registry.npm.taobao.org</span><br><span class="line"><span class="comment"># 永久修改</span></span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br><span class="line"><span class="comment"># 使用cnpm，安装了cnpm之后，npm install 都可以换成cnpm install</span></span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></div></figure><ol start="2"><li>构建镜像</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/lizheming/waline.git</span><br><span class="line"><span class="built_in">cd</span> waline</span><br><span class="line">docker build -t image_name -f packages/server/Dockerfile .</span><br></pre></td></tr></table></div></figure><ol start="3"><li>修改配置<code>packages/client/.env</code>，参考文档中所需环境变量配置即可</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">SKIP_PREFLIGHT_CHECK=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库配置，参考https://waline.js.org/server/databases.html</span></span><br><span class="line">MYSQL_HOST=127.0.0.1</span><br><span class="line">MYSQL_DB=db_name</span><br><span class="line">MYSQL_USER=db_user</span><br><span class="line">MYSQL_PASSWORD=password</span><br><span class="line"></span><br><span class="line">AKISMET_KEY=guess</span><br><span class="line"></span><br><span class="line">SITE_NAME=Fox Home</span><br><span class="line">SITE_URL=https://foolishfox.cn</span><br><span class="line">AUTHOR_EMAIL=fox@foolishfox.cn</span><br><span class="line"></span><br><span class="line">SC_KEY=SCK232027Td54bfab83cfabf0aereq2c31b6552cd35fe1a43720074</span><br><span class="line"></span><br><span class="line">SMTP_HOST=smtp.ym.163.com</span><br><span class="line">SMTP_PORT=465</span><br><span class="line">SMTP_USER=fox@foolishfox.cn</span><br><span class="line">SMTP_PASS=password</span><br><span class="line">SENDER_NAME=fox</span><br><span class="line">SENDER_EMAIL=fox@foolishfox.cn</span><br></pre></td></tr></table></div></figure><ol start="4"><li>运行镜像</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --env-file ./packages/client/.env -p 8360:8360 -d image_name</span><br></pre></td></tr></table></div></figure><ol start="5"><li>设置反向目录代理，将<code>api.foolishfox.cn/waline</code>指向<code>127.0.0.1:8360</code></li><li>进入容器</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看容器id</span></span><br><span class="line">root@iZ2ze8k2vy63cz277rsw8zZ:$ docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE              COMMAND                  CREATED          STATUS          PORTS                    NAMES</span><br><span class="line">cebd15a83483   lizheming/waline   <span class="string">&quot;docker-entrypoint.s…&quot;</span>   44 seconds ago   Up 42 seconds   0.0.0.0:8360-&gt;8360/tcp   admiring_noether</span><br><span class="line"><span class="comment"># 进入容器</span></span><br><span class="line">root@iZ2ze8k2vy63cz277rsw8zZ:$ docker <span class="built_in">exec</span> -it cebd15a83483 /bin/bash</span><br></pre></td></tr></table></div></figure><ol start="7"><li>安装<code>vim</code>（可跳过）与验证组件</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install vim</span><br><span class="line">apt install apt-transport-https ca-certificates</span><br></pre></td></tr></table></div></figure><ol start="8"><li>更新软件源（使用<span class="exturl"><a class="exturl__link"   href="https://mirrors.tuna.tsinghua.edu.cn/help/debian/" >清华源</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>）</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份</span></span><br><span class="line">mv /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line"><span class="comment"># vim修改</span></span><br><span class="line">vim /etc/apt/sources.list</span><br><span class="line"><span class="comment"># echo修改</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free&quot;</span> &gt;/etc/apt/sources.list</span><br><span class="line"><span class="comment"># 更新</span></span><br><span class="line">apt update</span><br><span class="line">...</span><br></pre></td></tr></table></div></figure><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster main contrib non-free</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster main contrib non-free</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster-updates main contrib non-free</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster-updates main contrib non-free</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster-backports main contrib non-free</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian&#x2F; buster-backports main contrib non-free</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian-security buster&#x2F;updates main contrib non-free</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;debian-security buster&#x2F;updates main contrib non-free</span><br></pre></td></tr></table></div></figure><ol start="9"><li>配置<code>config.js</code>，路径为：<code>node_modules/@waline/vercel/config.js</code>，参考<span class="exturl"><a class="exturl__link"   href="https://waline.js.org/server/basic.html#%E4%BB%A3%E7%A0%81%E9%85%8D%E7%BD%AE" >服务端配置</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    secureDomains: [</span><br><span class="line">        <span class="string">&#x27;foolishfox.cn&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;api.foolishfox.cn&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    forbiddenWords: [</span><br><span class="line">        <span class="string">&#x27;空包&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;快递&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;下单&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    disallowIPList: [</span><br><span class="line">        <span class="string">&#x27;8.8.8.8&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><ol start="10"><li>修改主程序<code>vanilla.js</code>，导入自定义配置</li></ol><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> Application = <span class="built_in">require</span>(<span class="string">&#x27;thinkjs&#x27;</span>);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">let</span> config = &#123;&#125;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    config = <span class="built_in">require</span>(<span class="string">&#x27;./config.js&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(e) &#123;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></div></figure>        <h2 id="直接部署"   >          <a href="#直接部署" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#直接部署"></a> 直接部署</h2>      <p>  直接部署方便对配置进行修改，不需要更新镜像，安装好模块后使用<code>Node.js</code>运行模块内的<code>vanilla.js</code>文件即可。</p><ol><li>安装waline</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir walinejs &amp;&amp; <span class="built_in">cd</span> walinejs</span><br><span class="line">cnpm install @waline/vercel --save</span><br></pre></td></tr></table></div></figure><ol start="2"><li>编辑<code>.bashrc</code>，添加环境变量，最好将字符串用<code>&quot;</code>或者<code>'</code>包起来，避免<code>$</code>、<code>&amp;</code>等字符的影响</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MYSQL_HOST=<span class="string">&#x27;rm-*.mysql.rds.aliyuncs.com&#x27;</span></span><br><span class="line">...</span><br><span class="line">SENDER_EMAIL=<span class="string">&#x27;fox@foolishfox.cn&#x27;</span></span><br></pre></td></tr></table></div></figure><ol start="3"><li>创建软链接，方便后续操作</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s node_modules/@waline/vercel ./waline</span><br><span class="line"><span class="built_in">cd</span> waline</span><br></pre></td></tr></table></div></figure><ol start="4"><li>配置服务端<code>vim config.js</code>，见上</li><li>修改主程序<code>vanilla.js</code>，见上</li><li>使用pm2运行程序</li></ol><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g pm2</span><br><span class="line">pm2 start vanilla.js --name waline</span><br></pre></td></tr></table></div></figure><ol start="7"><li>设置反向目录代理，将<code>api.foolishfox.cn/waline</code>指向<code>127.0.0.1:8360</code></li></ol>        <h2 id="前端配置"   >          <a href="#前端配置" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#前端配置"></a> 前端配置</h2>      <p>  参考<span class="exturl"><a class="exturl__link"   href="https://waline.js.org/client/basic.html" >文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，需要注意的有：</p><ol><li>本地(localhost)访问不增加计数（以<code>hexo</code>为例）</li></ol><figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Waline(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#waline&#x27;</span>,</span><br><span class="line">    path: location.pathname,</span><br><span class="line">    serverURL: <span class="string">&#x27;https://your-serverURL.domain.com&#x27;</span>,</span><br><span class="line">    visitor: location.hostname!==<span class="string">&#x27;localhost&#x27;</span> &amp;&amp; !&#123; theme.waline.visitor &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>        <h2 id="参考资料"   >          <a href="#参考资料" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h2>      <ol><li><span class="exturl"><a class="exturl__link"   href="https://waline.js.org/" >waline</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><a href="/posts/move.html">博客服务器迁移过程</a></li><li><span class="exturl"><a class="exturl__link"   href="https://www.e-learn.cn/content/qita/2389149" >pm2入门</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;   &gt;
          &lt;a href=&quot;#前言&quot; class=&quot;heading-link&quot;&gt;&lt;i class=&quot;fas fa-link&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#前言&quot;&gt;&lt;/a&gt; 前言&lt;/h2&gt;
      
&lt;p&gt;  &lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://waline.js.org/&quot; &gt;waline&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;是由&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://github.com/lizheming&quot; &gt;lizheming&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;开发的博客评论系统，从&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://valine.js.org/&quot; &gt;Valine&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;衍生的带后端评论系统。可以将&lt;code&gt;Waline&lt;/code&gt;等价成&lt;code&gt;With backend Valine&lt;/code&gt;。&lt;br /&gt;
  Waline的服务端可以部署在&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://vercel.com/&quot; &gt;Vercel&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;、&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://www.cloudbase.net&quot; &gt;CloudBase&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;或者服务器上，数据库可以使用&lt;span class=&quot;exturl&quot;&gt;&lt;a class=&quot;exturl__link&quot;   href=&quot;https://www.leancloud.cn/&quot; &gt;LeanCloud&lt;/a&gt;&lt;span class=&quot;exturl__icon&quot;&gt;&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;、MySQL等，总计有多达48钟部署方式。在官方教程中，使用云服务部署都介绍的比较详细，下面介绍两种本地部署方式，可以自定义端口，配合多种数据库使用。&lt;/p&gt;</summary>
    
    
    
    <category term="博客成长日志" scheme="https://foolishfox.cn/categories/%E5%8D%9A%E5%AE%A2%E6%88%90%E9%95%BF%E6%97%A5%E5%BF%97/"/>
    
    
    <category term="安装" scheme="https://foolishfox.cn/tags/%E5%AE%89%E8%A3%85/"/>
    
    <category term="反向代理" scheme="https://foolishfox.cn/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"/>
    
    <category term="Waline" scheme="https://foolishfox.cn/tags/Waline/"/>
    
  </entry>
  
</feed>
